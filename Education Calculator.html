<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="author" content="Jeff Bogart, CO1/D18 Longmont TC">
<meta name="viewport" content="width=device-width">
<title>Education Calculator</title>
<style>
	abbr { text-decoration: underline }
	body { background-color: #ccccff; font-family: sans-serif; font-size: 11pt; } 
	table {background-color: #ccccff; border-collapse:collapse;width:100%;}
	table tr:nth-child(even) { background-color: #c7c7f0; }
	td { vertical-align:top; }
	#InstructionsDiv { display: none; max-width: 75em; margin: auto; }
	#FilingDiv { display: none; max-width: 75em; margin: auto; }
	#ScholarshipDiv { display: none; max-width: 75em; margin: auto; }
	#ExpenseDiv { display: none; max-width: 75em; margin: auto; }
	#ManualDiv { display: none; max-width: 75em; margin: auto; }
	#OptimizeDiv { display: none; max-width: 75em; margin: auto; }
	tr { vertical-align:top; }
	th { text-align:center; font-weight:bold; vertical-align:bottom; }
	table input[type="number"] { font-size: 11pt; width: 6em; }
	input[type="button"] { cursor: pointer; }
	input[type="number"] { text-align: right; }
	button { cursor: pointer; }
	.left { text-align: left; }
	.right { text-align: right; }
	.center { margin: auto; }
	.bold { font-weight: bold; }
	.italic { text-decoration: italic; }
	.ul { text-decoration: underline; }
	.circle { list-style-type: circle; }
	.appHeader { text-align: center; }
	.calcHeader { text-align: center; background-color: #bbeecc; padding: 3px; height: 3.5em; }
	.calculatedEntry { text-align: right; }
	.LLCClass,
	.AOCClass { padding-right: 1em; }
	.qexpense { color: green; }
	.nqexpense { color: red; }
	.example { border: 1px solid; margin: 3px; }
	.note { font-style: italic; color: red; }
	.help { background-color: lightgreen; border: 1px solid black; border-radius: 0.5em;
		width: 2em; cursor: pointer; }
	.helpText { font-style: italic; display: none; background-color: lightgreen;
		border: 1px solid black; padding: 3px; }
	.tblHeader { font-size: 110%; font-weight:bold; text-decoration:underline; }
	.appTitle { font-size:125%; font-weight:bold; }
	.tabSpacer { background-color: none; width: 2%; background-color: #cceecc;
		border: solid black; border-color: transparent black black; }
	.optResult { width: 70% }
	.warning { font-weight: bold; color: red; margin-left: 12px; text-align: left; }
	#ButtonBox { zindex: 1; position: absolute; right: 3%; top: 1.5em;
		font-size: 70%; text-align: center; }
	#VideoBox { zindex: 1; position: absolute; left: 3%; top: 1.5em; text-align: center; }
	#exampleGraph { text-align:center; display:none; }
	#Refund65Warning { color: red; }
	#FItable tr td:first-child { width: 30%; }
	#FItable tr td:nth-child(2) { width: 20%; }
	#FItable tr td:nth-child(3) { width: 15%; }
	#FItable tr td:nth-child(4) { width: 40%; }
	#TPName { width: 20em; }
	#Dependents,
	#Dependents0,
	#EICDependents,
	#CTCDependents { width: 3em; }
	#SItable tr td:first-child { width: 50%; }
	#SItable tr td:nth-child(2) { width:50%; }
	.SQindent { text-indent: 5em; }
	#SQdiv { width:35em; border: 3px black solid; padding: 5px; margin:auto; }
	.FSindent { text-indent: 2em; }
	.FSindentw2 { text-align: right; position:relative; right:5em; }
	#FStable tr td:first-child { width:75%; }
	#FStable tr td:nth-child(2) { width:12%; }
	#FStable tr td:nth-child(3) { width:13%; }
	#EItable tr { text-align: right; }
	#EItable tr td {border-bottom: 1px dashed skyblue;}
	#EItable tr td:first-child { width: 1%; }
	#EItable tr td:nth-child(2) { width: 56%; text-align: left; }
	#EItable tr td:nth-child(3) { width: 11%; }
	#EItable tr td:nth-child(4) { width: 10%; }
	#EItable tr td:nth-child(5) { width: 10%; }
	#EItable tr td:nth-child(6) { width:  2%; }
	#MCtable tr th { text-align: left; }
	#MCtable tr td:first-child { width: 28%; font-weight: bold; }
	#MCtable tr td:nth-child(2) { width: 18%; }
	#MCtable tr td:nth-child(3) { width: 18%; }
	#MCtable tr td:nth-child(4) { width: 18%; }
	#AGIdiv { width: 33em; border: 3px black solid; padding: 3px; }
	#AGItable { text-align: right; }
	#AGItable tr td:first-child { width: 50%; text-align: left; }
	#AGItable tr td:nth-child(2) { width: 6%; text-align: right; }
	#AGItable tr td:nth-child(3) { width: 1%; }
	#AGItable tr td:nth-child(4) { width: 6%; }
	#AGItable tr td:nth-child(5) { width: 36%; }
	.TaxReturnHeader { width: 99%; padding: 5px; border: 2px solid blue;
		background-color: lightblue; font-size: 150%; }
	#EarnedRow { display: none;}
	#StudEarnedRow { display: none;}
	#TPTaxForm tr,
	#StudentTaxForm tr,
	#TaxFormResults tr { text-align: right; height: 1.5em;}
	#TPTaxForm tr td:first-child,
	#StudentTaxForm tr td:first-child,
	#TaxFormResults tr td:first-child { text-align: left; }
	#TPTaxForm tr td:nth-child(2),
	#StudentTaxForm tr td:nth-child(2),
	#TaxFormResults tr td:nth-child(2) { width: 12em; }
	#TPTaxForm tr td:nth-child(3),
	#StudentTaxForm tr td:nth-child(3),
	#TaxFormResults tr td:nth-child(3) { width: 5em; }
	#TPTaxForm tr td:nth-child(4),
	#StudentTaxForm tr td:nth-child(4),
	#TaxFormResults tr td:nth-child(4) { width: 5em; text-align: right; }
	#TPTaxForm tr td:nth-child(5),
	#StudentTaxForm tr td:nth-child(5),
	#TaxFormResults tr td:nth-child(5) { width: 5em; text-align: right; }
	#TPTaxForm tr td:nth-child(6),
	#StudentTaxForm tr td:nth-child(6),
	#TaxFormResults tr td:nth-child(6) { width: 5em; text-align: right; }
	#OptimizeButtons {display: none; }
	#OptimizeButtons tr {width: 100%;}
	#OptimizeButtons tr td:nth-child(2) { width: 10%; }
	#OptimizeButtons input { width: 9em; }
	#optDiv { width:34em; padding: 3px; }
	#optDiv table { width: 100%; border: 2px solid black; }
	#optDiv th, #optDiv td:first-child { text-align: left; }
	#optDiv td:nth-child(2) { text-align: right; }
	#testPrint {color: red; font-size: 60%; float: right; cursor: none; }
	#messageNoUnqualified,
	#NoOptimize1,
	#NoOptimize2,
	#NoOptimize3,
	#NoOptimize4 { font-style: italic; font-size: 150%; color: red; text-align: center;}
	#resultsBox { border: solid black; font-size: 36pt; z-index: 1;
		position:absolute; left:45%; top: 45%; width: 25%;
		display:none; background-color: lightgreen; }
	.STRefund0,
	.STRefund1 { font-style: italic; }
	.STRefund1 { border-top: 1px solid black; }
	.tabSet {
		height: 3.2em;
		background-color: none;
		text-align: center;
		margins: auto;
	}
	.tabReal {
		font-size: 1.25em; font-weight: bold; border: 3px solid black; text-align: center;
		vertical-align: middle; width: calc((100% - 36px) / 6); height: 2.5em;
		-moz-border-top-left-radius: 15px; -moz-border-top-right-radius: 15px;
		-webkit-border-top-left-radius: 15px; -webkit-border-top-right-radius: 15px;
		border-top-left-radius: 15px; border-top-right-radius: 15px;
		display: inline; float: left; cursor: pointer;
	}
	@media print {
		html { background-color: white; }
		body { font-size: 70%; background-color: white; padding: 0; border: 0; }
		table tr { border-bottom: 1px solid black; !important}
		table,
		table tr,
		table tr td,
		table tr td span { background-color: white; !important }
		select,
		input { font-size: 100% }
		table tr td select,
		table input[type="number"] { font-size: 70%; }
		.noPrint { display: none; !important }
		.doPrint { display: inline; !important }
		.help { display: none; }
	       }
</style>

<script src="Common_Routines.js"></script>
<script type="text/javascript">
	//----------------------------------------------------------------------------------------
	// CHANGE HISTORY:
	var VERSION = "Version 3.45, 5/17/2024";
	//	Changed to JSON IRS data files
	//var VERSION = "Version 3.44a, 2/18/2024";
	//	Clarified data entry for student on optimization tab
	//var VERSION = "Version 3.44, 12/24/2023";
	//	Maximum expenses still not working correctly
	//var VERSION = "Version 3.43, 12/22/2023";
	//	Corrected too much restricted scholarship used for nonqualified expenses
	//	Changed titles of expense options to Use all & Maximize expenses
	//	Unset Use all option if taxed amount is not 0 so it can be clicked to set to 0
	//	Corrected Maximize expenses not finding correct distribution of funds
	//	Added OOS message if kiddie tax cannot be avoided after adjusting for same
	//var VERSION = "Version 3.42, 12/8/2023";
	//	Added footnotes to TS entry lines
	//	Corrected calculation of education expenses
	//var VERSION = "Version 3.41a, 11/29/2023";
	//	Added TS entry link to taxable scholarship income for student
	//	Hid TS entry block if not optimizing
	//var VERSION = "Version 3.41, 10/26/2023";
	//	Made changes due to TaxSlayer input form for 2022
	//	Hide kiddie tax message on TP information tab if not applicable
	//var VERSION = "Version 3.40, 8/17/2023";
	//	Removed T&S column
	//	Removed Kiddie tax option available for 2018-2019
	//	hide circled question marks (help comments) on print
	//var VERSION = "Version 3.39, 3/11/2023";
	//	Corrected premature end of optimization when refund change is negative
	//var VERSION = "Version 3.38, 2/24/2023";
	//	Corrected expenses for federal limits
	//var VERSION = "Version 3.37, 1/27/2023";
	//	Added lines for nonqualifed nontaxable amounts
	//var VERSION = "Version 3.36, 12/7/2022";
	//	Fill the Gap option not working properly
	//var VERSION = "Version 3.35, 12/7/2022";
	//	Optimize button not showing for dependent student
	//var VERSION = "Version 3.34b, 11/23/2022";
	//	Changed dependent earned income increment
	//var VERSION = "Version 3.34a, 10/4/2022";
	//	Changed filing status option to QSS for 2022
	//var VERSION = "Version 3.34, 9/8/2022";
	//	More related corrections
	//var VERSION = "Version 3.33, 9/5/2022";
	//	Corrected calcs involved with supplimentary funding
	//	Corrected LLC expenses and taxable amounts again
	//var VERSION = "Version 3.32, 9/2/2022";
	//	Corrected LLC expenses and taxable amounts
	//var VERSION = "Version 3.31, 8/29/2022";
	//	Corrected another problem with kiddie tax
	//var VERSION = "Version 3.30, 8/27/2022";
	//	Corrected a problem with kiddie tax
	//var VERSION = "Version 3.29, 7/24/2022";
	//	Changes due to _TaxLookup return being an array
	//var VERSION = "Version 3.28, 2/26/2022";
	//	Corrected how refundable ACTC is displayed
	//	Added refundable Child Care Credit
	//var VERSION = "Version 3.27a, 12/27/2021";
	//	Clarification of instructions on optimizer tab
	//var VERSION = "Version 3.27, 11/28/2021";
	//	Fixed hang problem due to ACA 0 rate change
	//	Added tests to prevent negative dependent entries
	//var VERSION = "Version 3.26, 10/7/2021";
	//	Modified CTC age limits of 19 - no upper for 2021
	//	Defaulted to MFJ
	//var VERSION = "Version 3.25, 8/13/2021";
	//	Modified calc of retirement savings credit
	//var VERSION = "Version 3.24 draft, 7/5/2021";
	//	Modified for new Chld Tax Credit for 2021
	//	Added NoEIC checked for TP is the student, age under 25 for 2020.
	//var VERSION = "Version 3.23, 3/15/2021";
	//	Added test for 2020 to not pay back APTC excess
	//var VERSION = "Version 3.22a, 10/26/2020";
	//	Removed another link to extinct Education Cookbook
	//var VERSION = "Version 3.22, 8/8/2020";
	//	Modified optimizer to use adj to income amounts to increase taxable scholarships
	//		before invoking the kiddie tax
	//var VERSION = "Version 3.21a, 2/20/2020";
	//	Removed links to extinct Education Cookbook
	//var VERSION = "Version 3.21, 2/7/2020";
	//	Fixed retirement credit not carrying to LLC column
	//var VERSION = "Version 3.20b, 1/20/2020";
	//	Added pink to AGI if income but AGI is blank
	//var VERSION = "Version 3.20a, 1/16/2020";
	//	Added kiddie tax option wording due to trust method reversion
	//var VERSION = "Version 3.20, 12/15/2019";
	//	Corrected calc of dependent standard deduction
	//var VERSION = "Version 3.19, 12/5/2019";
	//	Corrected calc of Kiddie tax when unearned income is from capital gains
	//	Fixed checkmark not showing on Special Needs box for IRAs etc.
	//var VERSION = "Version 3.18, 11/10/2019";
	//	Checked options should not be taxable income
	//var VERSION = "Version 3.17, 10/31/2019";
	//	Corrected case where dependent student was not subject to kiddie tax
	//	Removed AllowKiddie option when dependent student was not subject to kiddie tax
	//var VERSION = "Version 3.16, 9/14/2019";
	//	More expense granularity
	//	Added checkboxes if scholarship can be used for an expense group
	//	Some code changes, variable name changes for consistency, etc
	//var VERSION = "Version 3.15, 8/19/2019";
	//	Changed kiddie tax for first $2100 to use 10% vs tax tables to match TS
	//var VERSION = "Version 3.14, 4/6/2019";
	//	Tax not calculating for 2015-2017
	//var VERSION = "Version 3.13, 4/5/2019";
	//	Correct line number for QDCG worksheet
	//	Input line rearrangment
	//var VERSION = "Version 3.12, 3/22/2019";
	//	Reset optimized value found after reducing the scan range to find earlier max
	//var VERSION = "Version 3.11, 3/4/2019";
	//	Added check to insure that disabled student income question is marked Yes
	//	Corrected kiddie tax calculation so not done if so indicated by test questions
	//	Hide AOC parent alive question if already asked
	//var VERSION = "Version 3.10, 2/23/2019";
	//	Split earned income into Salary and Business income lines
	//	Corrected QBI calculations when limited by taxable income
	//	Hide QBI line when no business income
	//	Added SEHI for QBI calculation
	//	Changed EIC from input value to calculated
	//var VERSION = "Version 3.09, 12/29/2018";
	//	Tax computation in final result was showing wrong choice (LLC vs AOC)
	//var VERSION = "Version 3.08, 12/19/2018";
	//	Added QBI lines to TP and Student returns
	//	Corrected line numbers to match new forms
	//var VERSION = "Version 3.07, 11/28/2018";
	//	Added Allow Kiddie Tax option for states that did not change rules
	//var VERSION = "Version 3.06a, 10/23/2018";
	//	Strange server substitution for html page closure in plot function
	//var VERSION = "Version 3.06, 8/1/2018";
	//	New form line numbers for 2018 required some changes
	//var VERSION = "Version 3.05a, 8/1/2018";
	//	Year list stops early due to non-numeric
	//var VERSION = "Version 3.05, 6/18/2018";
	//	Prevented negative numbers in kiddie tax info listing
	//	Removal of some commented out lines
	//var VERSION = "Version 3.05, 6/18/2018";
	//	Added Cap Gains calculation to kiddie tax based on NTTC information
	//var VERSION = "Version 3.04, 6/16/2018";
	//	Corrected kiddie tax where dependent foreign tax and change in tax was not calculating
	//var VERSION = "Version 3.03, 6/15/2018";
	//	Modified kiddie tax calculations to simplify (and correct)
	//	Added display of standard and trust calculations when kiddie tax applies
	//	Added "Refundable credits" line to returns
	//	Italicised return results lines and added lines above totals on those lines
	//var VERSION = "Version 3.02, 6/11/2018";
	//	Added 2018 income limit for relative as dependent
	//	Corrected kiddie tax calculation to add taxable scholarship as unearned income
	//	Corrected some calculations from conversion to new student form format
	//var VERSION = "Version 3.01, 6/4/2018";
	//	Changes for 2018 new tax rules
	//	Added kiddie tax for 2018
	//	Moved some functions to CommonRoutines.js
	//	Changed reset button so it would work with Firefox
	//	Show both TP and student returns without toggling
	//----------------------------------------------------------------------------------------

	//----------------------------------------------------------------------------------------
	// Contributors:
	//	Sue Alza		Dana Bell		Bob Brooks		
	//	Steve Conary		Deb Fisher		Kenny Hayes
	//	Gina Kritchevsky	Hans Jahns		Betsy Robertson
	//	Dick Sramek		Bob Wells		Jay Wiedwald
	//	Edie Loughmiller	Harold Rowe		Brad Kirby
	//	Stephen Enk		Roger Metzler		Arlene Green
	//	Joanne Hill		Fred Lamberth		Rob Schussman
	//	Bud Ward
	//----------------------------------------------------------------------------------------

	//----------------------------------------------------------------------------------------
	// Global variables
	//----------------------------------------------------------------------------------------
	var CurrentTab = "";
	var TabDiv = [];
		TabDiv["InstructionsTab"] = "InstructionsDiv";
		TabDiv["InformationTab"] = "FilingDiv";
		TabDiv["ScholarshipTab"] = "ScholarshipDiv";
		TabDiv["ExpenseTab"] = "ExpenseDiv";
		TabDiv["ManualTab"] = "ManualDiv";
		TabDiv["OptimizeTab"] = "OptimizeDiv";
	var QualExpenses = []; // qualified for the program
	var QualColor = "green";
	var NonqualExpenses = []; // not qualified for the program
	var NonqualColor = "red";
	var AllowedExpenses = []; // allowed by the funding source
	var NQExpenses = []; // allowed by the funding source but not qualified for credit
	var Exemptions = 0;
	var CTCTotal = 0;
	var RelativeViolation = false; // test for age 24 and too high AGI
	var ExcessAPTC = [];
	var FedPovertyLine = 0;
	var KiddieTaxApplies = false; // test for Kiddie Tax on info tab
	var KiddieTaxFlag = false; // display Allow kiddie tax option on optimizer
	var KiddieTaxThreshold = 0;
	var KiddieFileMargin = -1;
	var StudentFileMargin = -1;
	var ExtraNRC = 0;
	var Tax = [];
	var Care = [];
	var MaxRefund = 0;
	var MaxRefundAGI = 0;
	var MaxRefundTaxable = 0;
	var Optimizing = false;
	var Optimized = false;
	var OptimizedTaxableFound = 0;
	var PlotCanv;
	var Plotview;
	var PlotHeight = 600;
	var PlotMarginT = 50; // margin above plot
	var PlotMarginB = 80; // margin below plot
	var PlotWidth = 800;
	var PlotMarginR = 50; // margin right of plot
	var OptMarginL = 50;
	var PlotMarginL = 150; // margin left of plot
	var PlotMaxRefund = 0;
	var PlotMinRefund = 0;
	var PlotDiffRefund = 0;
	var PlotLowSch = 0;
	var PlotHighSch = 0;
	var Program = ["AOC","LLC"];
	var ScholarAvailable = 0;
	var ScholarIncome = 0;
	var ScholarNQMax = 0;
	var ScholarSupplemental = 0;
	var CurrentReturn = "taxpayer";
	var ResultingProgram = "";
	var ResultingIncome = 0;
	var ResultingExpense = 0;
	var UnusedCTC = 0;
	var WarningMessage = "";
	var BusinessSETax = 0;
	var StudBusinessSETax = 0;
	var StudKiddieTax = [];
	var StudKiddieAOC = [];
	var StudKiddieLLC = [];
	var ScholarReduction = 0;
	var ScholarReductionMax = 0;

	//----------------------------------------------------------------------------------------
	// This function initializes options when the application is first loaded
	function Main() {	
	//----------------------------------------------------------------------------------------

		// Add tax year list to the drop-down
		TaxYear.length = 0;
		var tyOptIndex = 0;

		// Add the years
		for (var ty = _StartYear; ty <= _StopYear; ty++) {
			var tyopti = document.createElement("option");
			tyopti.text = tyopti.value = ty;
			TaxYear.add(tyopti,tyOptIndex++);
		}

		// Set the default to the last tax year
		TaxYear.value = TY = +_DefaultYear;

		// Read any cookies
		switch (test = _Read_Cookie("Region")) {
			case "US"    : RegionUS.checked = true; break;
			case "AK":
			case "Alaska": RegionAK.checked = true; break;
			case "HI":
			case "Hawaii": RegionHI.checked = true; break;
			default: RegionUS.checked = true;
		}

		// Define specific tax return storage variables
		// This allows switching between taxpayer and student returns
		var tagList = document.getElementsByClassName("taxreturn");
		for (var tli=0; tli < tagList.length; tli++) { tagList[tli].value = ""; }

		// Start with the Taxpayer Information tab
		ChangeTab("InformationTab");
		if (! DependentNo.checked) DependentYes.checked = true;

		// Start with essentially no input information
		ChangeInfo("TaxYear");
	}

	//----------------------------------------------------------------------------------------
	// This function displays the page corresponding to the clicked tab and hides all others
	function ChangeTab(
		newTab		// the id of the tab that was clicked
		) {	
	//----------------------------------------------------------------------------------------

		if (CurrentTab == "") CurrentTab = "InformationTab";
		if (CurrentTab == "InformationTab") ChangeInfo(); // Assures internal consistency
		// Check for data inconsistencies
		if ((newTab != "InformationTab") && (newTab != "InstructionsTab")) {
			if (DependentYes.checked) {
				var message = "";

				if (+Dependents.value == 0) {
					message += "\x0DThe taxpayer has not claimed any dependents but the student is marked as a dependent.";
					message += "\x0D\x0DYou must claim the student as a dependent to qualify for education credits.";
				}
		       
				else {
					if ((! StudentAge16.checked) && (Dependents.value <= CTCDependents.value)) {
						if (message != "") message += "\x0D";
						message += "\x0DThe student is over the age of 16 and is not eligible for the Child Tax Credit.";
						message += " But the number of dependents indicated as claimed for CTC is the same as";
						message += " (or more than) the number of dependents you are claiming for exemptions.";
					}
					if ((StudentAge19.checked) && (Dependents.value <= EICDependents.value) && (! TimeFull.checked)) {
						if (message != "") message += "\x0D";
						message += "\x0DThe student is over the age of 18 and is not a full time student thus";
						message += " is not an elegible child for EIC.";
						message += " But the number of dependents indicated as claimed for EIC is the same as";
						message += " (or more than) the number of dependents you are claiming for exemptions.";
					}
					if ((StudentAge24.checked) && (Dependents.value <= EICDependents.value)) {
						if (message != "") message += "\x0D";
						message += "\x0DThe student is over the age of 23 and is not eligible for the Earned Income Credit.";
						message += " But the number of dependents indicated as claimed for EIC is the same as";
						message += " (or more than) the number of dependents you are claiming for exemptions.";
					}
				}

				if (message != "") {
					if (! Optimizing) {
						alert(message);
						ChangeTab("InformationTab");
						return;
					}
				}
			}
		}

		// No inconsistencies, go to the new tab
		document.getElementById(CurrentTab).style.borderColor = "black black black black";
		document.getElementById(newTab).style.borderColor = "black black transparent black";
		document.getElementById(TabDiv[CurrentTab]).style.display = "none";
		document.getElementById(TabDiv[newTab]).style.display = "inline";
		CurrentTab = newTab;
	}

	//----------------------------------------------------------------------------------------
	// This function readjusts settings when the taxpayer information is changed
	function ChangeInfo(
		whatChanged	// the id of the field that changed
		) {
	//----------------------------------------------------------------------------------------
		// Change filing status options
		if (whatChanged == "TaxYear") {
			optionLabel = (+TaxYear.value < 2022) ? "Widow(er)" : "QSS" ;
			FilingStatus.lastElementChild.innerHTML = optionLabel;
			TY = +TaxYear.value;
		}

		// Show controls related to the chosen filing status for the taxpayer
		AGIdiv.style.display = "block";
		MedicalSpouse.style.display = "none";
		FS = FilingStatus.value;
		switch (FS) {
			case "MFJ":
				SP65.disabled = false;
				SPBlind.disabled = false;
				SPNRA.disabled = false;
				Exemptions = 2;
				MFJRefundShow.style.display = "inline";
				break;
			case "MFS":
				AGIdiv.style.display = "none"
			case "HOH":
				MedicalSpouse.style.display = "inline";
			case "SNG":
			case "WID":
				SP65.disabled = true;
				SP65.checked = false;
				SPBlind.disabled = true;
				SPBlind.checked = false;
				SPNRA.disabled = true;
				SPNRA.checked = false;
				Exemptions = 1;
				MFJRefundShow.style.display = "none";
		}

		// Show controls related to the chosen filing status for the student
		switch (StudentFilingStatus.value) {
			case "MFJ":
				StudentMFSItemizeShow.style.display = "none";
				StudentSP65.disabled = false;
				StudentSPBlind.disabled = false;
				StudentSPNRA.disabled = false;
				StudentMFJRefundShow.style.display = "inline";
				break;
			case "MFS":
				StudentMFSItemizeShow.style.display = "inline";
				StudentSP65.disabled = true;
				StudentSP65.checked = false;
				StudentSPBlind.disabled = true;
				StudentSPBlind.checked = false;
				StudentSPNRA.disabled = true;
				StudentSPNRA.checked = false;
				StudentMFJRefundShow.style.display = "none";
				break;
			case "SNG":
			case "HOH":
			case "WID":
				StudentMFSItemizeShow.style.display = "none";
				StudentSP65.disabled = true;
				StudentSP65.checked = false;
				StudentSPBlind.disabled = true;
				StudentSPBlind.checked = false;
				StudentSPNRA.disabled = true;
				StudentSPNRA.checked = false;
				StudentMFJRefundShow.style.display = "none";
		}

		// Show line numbers for the selected tax year in the Optimizer tab
		CapGainsLineNoA.innerHTML = CapGainsLineNoB.innerHTML =
		StudCapGainsLineNoA.innerHTML = StudCapGainsLineNoB.innerHTML = _IRSValue("LineNo.QDCG");
		AGILineNoA.innerHTML = AGILineNoB.innerHTML = _IRSValue("LineNo.AGI");
		QBILineNoA.innerHTML = QBILineNoB.innerHTML = _IRSValue("LineNo.QBI");
		SalaryLineNoA.innerHTML = SalaryLineNoB.innerHTML = _IRSValue("LineNo.Wages");
		BusinessLineNoA.innerHTML = BusinessLineNoB.innerHTML = _IRSValue("LineNo.Business");
		SEHILineNoA.innerHTML = SEHILineNoB.innerHTML = _IRSValue("LineNo.SEHI");
		ItemDedLineNoA.innerHTML = ItemDedLineNoB.innerHTML = _IRSValue("LineNo.ItemDed");
		DeductionsLineNoA.innerHTML = DeductionsLineNoB.innerHTML = _IRSValue("LineNo.Deductions");
		TaxAmountLineNoA.innerHTML = TaxAmountLineNoB.innerHTML = _IRSValue("LineNo.TaxAmount");
		ExcessAPTCLineNoB.innerHTML = _IRSValue("LineNo.ExcessAPTC");
		CareLineNoB.innerHTML = _IRSValue("LineNo.Care");
		LLCLineNoB.innerHTML = _IRSValue("LineNo.LLC");
		RetireLineNoB.innerHTML = _IRSValue("LineNo.Retire");
		CTCLineNoB.innerHTML = _IRSValue("LineNo.CTC");
		StudNRCreditLineNoB.innerHTML =
		NRCreditLineNoB.innerHTML = _IRSValue("LineNo.NRCredit");
		//IRPLineNoB.innerHTML = _IRSValue("LineNo.IRP");
		EICLineNoB.innerHTML = _IRSValue("LineNo.EIC");
		ACTCLineNoB.innerHTML = _IRSValue("LineNo.ACTC");
		AOCLineNoB.innerHTML = _IRSValue("LineNo.AOC");
		NetPTCLineNoB.innerHTML = _IRSValue("LineNo.NetPTC");
		F8962ALineNoA.innerHTML = F8962ALineNoB.innerHTML = _IRSValue("LineNo.F8962A");
		F8962BLineNoA.innerHTML = F8962BLineNoB.innerHTML = _IRSValue("LineNo.F8962B");
		F8962FLineNoA.innerHTML = F8962FLineNoB.innerHTML = _IRSValue("LineNo.F8962F");
		//F8962MAGILineNoB.innerHTML = _IRSValue("LineNo.F8962MAGI");

		// Child Tax Credit and Refundable Care change in 2021
		RefCareLineNoB.innerHTML = "S3-13g"; // 2021 only
		RefCareLine.style.display = Dependents0Row.style.display = (TY == 2021) ?  "table-row" : "none";
		ACTCLabel.innerHTML = (TY == 2021) ? "Refundable Child Tax Credit" : "Additional Child Tax Credit" ;

		// Change to TaxSlayer input form in 2022
		TaxpayerResultTuitionRow.style.display = (TY > 2021) ? "table-row" : "none" ;
		TaxpayerResultScholarRow.style.display = (TY > 2021) ? "table-row" : "none" ;
		
		// Calculate Fed Poverty Line for the given year
		RegionList = document.getElementsByName("Region");
		for (i = 0; i < RegionList.length; i++){
			if (RegionList[i].checked) ThisRegion = RegionList[i].value;
		}
		_Write_Cookie("Region", ThisRegion);
		FedPovertyLine = +_IRSValue("ACA.PYFPL.Rate") + (+Dependents.value * +_IRSValue("ACA.FPL.Inc"));
		if (FS == "MFJ") FedPovertyLine += (+_IRSValue("ACA.FPL.Inc"));

		// Check dependent entries
		if (Dependents.value < 0) Dependents.value = 0;
		if (EICDependents.value < 0) EICDependents.value = 0;
		if (CTCDependents.value < 0) CTCDependents.value = 0;
		if (Dependents0.value < 0) Dependents0.value = 0;

		// Assume all dependents are claimed for EIC until changed, prior to 2018
		Dependents.value = Math.max(EICDependents.value, CTCDependents.value, Dependents.value, Dependents0.value);
		// Student filing MFJ not for return of withholding consistency check
		if ((StudentFilingStatus.value == "MFJ") && (! StudentMFJRefund.checked)) {
			if (! Optimizing) {
				message = "Student is filing MFJ for reason other than to receive a refund";
				message += " of withholding or estimated tax payments.\n\n";
				message += "In this circumstance, the student cannot be a dependent of another taxpayer.";
				alert(message);
			}
			StudentMFJRefund.checked = true;
		}

		// Set defaults depending if the student is a dependent or the taxpayer
		ClaimedYes.disabled = ClaimedNo.disabled = false;
		if (DependentNo.checked) { // Student is the taxpayer
			if ((FS == "MFJ") && (! MFJRefund.checked)) {
				ClaimedNo.checked = true;
				ClaimedYes.disabled = ClaimedNo.disabled = true;
			}
			if (ClaimedYes.checked) Exemptions = 0;
			KiddieWarn.style.display = "none";

			// Clear the student tax return
			StudSalaryTax.value =
			StudBusinessTax.value =
			StudSEHITax.value =
			StudEarnedTax.value =
			StudAGITax.value =
			StudItemizedTax.value =
			StudCapGainsTax.value = 
			StudFTCTax.value =
			StudNRCreditTax.value = "";
		}
		else { // Student is a dependent
			KiddieWarn.style.display = "list-item";
		}
		Exemptions += +Dependents.value;

		// Show Claimed questions if not a dependent
		StudentIsAdult = StudentAge24.checked || StudentAge25.checked;
		if (whatChanged == "DependentYes") StudentAge19.checked = true;
		if (whatChanged == "DependentNo") {
			StudentAge24.checked = true;
			ClaimedNo.checked = true;
		}
		F8962ATax.disabled = F8962BTax.disabled =
			F8962FTax.disabled = ACAMonths.disabled = DependentNo.checked && ClaimedYes.checked;

		IncomeLessYes.disabled =
		IncomeLessNo.disabled = StudentAge16.checked || StudentAge17.checked || StudentIsAdult;
		if (IncomeLessYes.disabled) IncomeLessYes.checked = true;
		ParentAliveYes.disabled = ParentAliveNo.disabled = StudentIsAdult;

		var cqlist = document.getElementsByClassName("ClaimedQuestion");
		for (var cqi = 0; cqi < cqlist.length; cqi++) {
			cqlist[cqi].style.display = (DependentNo.checked) ? "inline" : "none";
		}
		var cqlist = document.getElementsByClassName("liClaimedQuestion");
		for (var cqi = 0; cqi < cqlist.length; cqi++) {
			cqlist[cqi].style.display = (DependentNo.checked) ? "list-item" : "none";
		}

		// Show extra dependent questions if a dependent
		var sqlist = document.getElementsByClassName("DependentQuestion");
		for (var sqi = 0; sqi < sqlist.length; sqi++) {
			sqlist[sqi].style.display = (DependentYes.checked) ? "inline" : "none";
		}

		// Show dependent parent alive question if TP/SP not a parent
		var sqlist = document.getElementsByClassName("NoParentQuestion");
		for (var sqi = 0; sqi < sqlist.length; sqi++) {
			sqlist[sqi].style.display = (TPisParentNo.checked && DependentYes.checked) ? "inline" : "none";
		}
		if ((TPisParentRow.style.display == "inline") && TPisParentYes.checked) ParentAliveYes.checked = ParentAlive2Yes.checked = true;

		// Age and relationship tests for AOC refundable and kiddie tax
		// Get the dependent's current AGI

		KTui.innerHTML = KiddieTaxThreshold = 0;

		KiddieTaxApplies = false;
		if      (( StudentAge16.checked
			|| StudentAge17.checked
			|| (StudentAge18.checked && IncomeLessYes.checked)
			|| (StudentAge19.checked && IncomeLessYes.checked && TimeFull.checked))

			&& (! ((ParentAliveNo.checked && DependentNo.checked)
				|| (ParentAlive2No.checked && DependentYes.checked)))

			&& ((((FS != "MFJ") || MFJRefund.checked) && DependentNo.checked)
				|| ((StudentFilingStatus.value != "MFJ") && DependentYes.checked))) {
			
			KiddieTaxApplies = true;
			KTui.innerHTML = 
			KiddieTaxThreshold = +_IRSValue("Kiddie");
		}
		KTdiv.style.display = (KiddieTaxApplies) ? "inline-block" : "none" ;
		
		// Hide tax return results line if student not a dependent
		StudentInput.style.display = (DependentNo.checked) ? "none" : "inline";

		// Hide taxpayer/student return lines if not a dependent
		var strlist = document.getElementsByClassName("STRefund");
		for (var stri = 0; stri < strlist.length; stri++) {
			strlist[stri].style.display = (DependentYes.checked) ? "inline" : "none";
		}

		// Show AOC Refund questions if not claimed
		var aocqlist = document.getElementsByClassName("AOCRefundQuestions");
		for (var aocqi = 0; aocqi < aocqlist.length; aocqi++) {
			aocqlist[aocqi].style.display = (ClaimedYes.checked || StudentIsAdult) ? "none" : "inline";
		}
		// Suppress the same question asked earlier (if it was) and copy the response
		if (ParentAlive2Row.style.display == "inline") {
			ParentAliveYes.checked = ParentAlive2Yes.checked;
			ParentAliveNo.checked = ParentAlive2No.checked;
			ParentAliveRow.style.display = "none";
		}
		else ParentAliveRow.style.display = "table-row";

		// Show Job Skill question if not a half-time student
		var jsqlist = document.getElementsByClassName("JobSkills");
		for (var jsqi = 0; jsqi < jsqlist.length; jsqi++) {
			jsqlist[jsqi].style.display = (DegreeNo.checked && TimePart.checked) ? "inline" : "none";
		}

		// Deactivate supplementary inputs if half-time student
		ScholarESA.disabled = TimePart.checked;
		ScholarQTP.disabled = TimePart.checked;
		ScholarIRA.disabled = TimePart.checked;
		ScholarSAV.disabled = TimePart.checked;

		// Calculate maximum allowable deduction amounts
		MaxAOC.innerHTML = _IRSValue("Education.AOC.MAX0");
		if ((DependentNo.checked && ClaimedYes.checked)
		    || FelonyYes.checked
		    || FourYearsAOCYes.checked
		    || FourYearsYes.checked
		    || DegreeNo.checked
		    || TimePart.checked
		    || (FS == "MFS"))
		    MaxAOC.innerHTML = 0;

		MaxLLC.innerHTML = _IRSValue("Education.LLC.MAX0");
		if ((DependentNo.checked && ClaimedYes.checked)
		    || TPNRA.checked
		    || SPNRA.checked
		    || (FS == "MFS"))
		    MaxLLC.innerHTML = 0;
		if (DegreeNo.checked && SkillsNo.checked) MaxLLC.innerHTML = 0;

		// Show qualification status on the Taxpayer Information tab
		StudentAOC.innerHTML = (+MaxAOC.innerHTML == 0) ? "No" : "Yes";
		StudentLLC.innerHTML = (+MaxLLC.innerHTML == 0) ? "No" : "Yes";
		StudentAOCR.innerHTML = ((DependentNo.checked && ClaimedNo.checked && KiddieTaxApplies) 
				|| (+MaxAOC.innerHTML == 0)) ? "No" : "Yes";

		// Update figures in the Manual Comparison page CreditLimitTable
		amount = _IRSValue("Education.AOC." + FS + "1");
		LimitTableAOC1b.innerHTML = Comma(amount);
		LimitTableAOC2a.innerHTML = Comma(+amount + 1);
		amount = _IRSValue("Education.AOC." + FS + "2");
		LimitTableAOC2b.innerHTML = Comma(amount);
		LimitTableAOC3a.innerHTML = Comma(+amount + 1);
		amount = _IRSValue("Education.LLC." + FS + "1");
		LimitTableLLC1b.innerHTML = Comma(amount);
		LimitTableLLC2a.innerHTML = Comma(+amount + 1);
		amount = _IRSValue("Education.LLC." + FS + "2");
		LimitTableLLC2b.innerHTML = Comma(amount);
		LimitTableLLC3a.innerHTML = Comma(+amount + 1);
		var vEIC_FS = (FS == "MFJ") ? "MFJ" : "SNG" ;
		var vEICDependents = Math.min(3, +EICDependents.value);
		var vEICLookupMax = _IRSValue("EIC." + vEIC_FS)[vEICDependents];
		var vEICRateUp = _IRSValue("EIC.RateUp")[vEICDependents];
		var vEICMax = _IRSValue("EIC.Maximum")[vEICDependents];
		var vEICRateDown = _IRSValue("EIC.RateDown")[vEICDependents];
		amount = Math.round(vEICMax / vEICRateUp);
		LimitTableEIC1b.innerHTML = Comma(amount);
		LimitTableEIC1c.innerHTML = Comma(vEICMax);
		LimitTableEIC2a.innerHTML = Comma(+amount + 1);
		amount = Math.round(vEICLookupMax  - (vEICMax / vEICRateDown));
		LimitTableEIC2b.innerHTML = Comma(amount);
		LimitTableEIC2c.innerHTML = Comma(vEICMax);
		LimitTableEIC3a.innerHTML = Comma(+amount + 1);
		LimitTableEIC3b.innerHTML = Comma(vEICLookupMax);
		LimitTableEIC4a.innerHTML = Comma(+vEICLookupMax + 1);

		// Show/hide the student tax return
		StudentTaxFormDiv.style.display = (DependentYes.checked) ? "block" : "none";

		// Show/hide the taxable scholarship line in the taxpayer return
		TPScholarIncome.style.display = (DependentNo.checked) ? "table-row" : "none";

		// Refresh the expense section
		BudgetChange(whatChanged);
	}

	//----------------------------------------------------------------------------------------
	// This function inserts a comma at the 1,000 position for display.
	function Comma(
		amount	// the text string for the amount to have the comma inserted
		) {
	// returns the text string with the (1) comma inserted
	//----------------------------------------------------------------------------------------
		amount += ""; // force to be a string
		return amount.replace(/(\d{1,3})(\d{3})/,'$1,$2');
	}

	//----------------------------------------------------------------------------------------
	// This function readjusts calculations when scholarship or education expense amounts are changed
	function BudgetChange(
		whatChanged	// the id of the element that changed
		) {
	//----------------------------------------------------------------------------------------

		Optimized = false;

		// Displayed line adjustments

		if (+ScholarTaxable.value) {
			GapAll.checked = false;
			GapGap.checked = false;
		}

		if (BusinessTax.value > 0) {
			SEHIRow.style.display =
			QBIRow.style.display = "table-row";
			BusinessSETax = _SETax(TY, BusinessTax.value)[1];
		}
		else {
			SEHIRow.style.display =
			QBIRow.style.display = "none";
			QBITax.value = BusinessSETax = SEHITax.innerHTML = 0;
		}

		if (StudBusinessTax.value > 0) {
			StudSEHIRow.style.display =
			StudQBIRow.style.display = "table-row";
			StudBusinessSETax = _SETax(TY, StudBusinessTax.value)[1];
		}
		else {
			StudSEHIRow.style.display =
			StudQBIRow.style.display = "none";
			StudQBITax.innerHTML = StudBusinessSETax = StudSEHITax.value = 0;
		}

		needAGI = (((SalaryTax.value > 0) || (BusinessTax.value > 0)) && (AGITax.value == ""))
		AGITax.style.backgroundColor = (needAGI) ? "pink" : "";
		needAGI = (((StudSalaryTax.value > 0) || (StudBusinessTax.value > 0)) && (StudAGITax.value == ""))
		StudAGITax.style.backgroundColor = (needAGI) ? "pink" : "";


		//-----------------------Scholarship calculations --------------------------------

		// Determine how much of the scholarship is available for expenses
		if (whatChanged == "Nonrestricted") ScholarTaxable.value = "";
		if (+ScholarTaxable.value) GapAll.checked = false;
		var ScholarIncome = +ScholarTeaching.value;
		var allScholarships = +Nonrestricted.value + +Restricted.value;

		ScholarAvailable = allScholarships - ScholarIncome - +ScholarRestricted.value;
		if (ScholarAvailable < 0) { // Data consistency check
			if (! Optimizing) {
				alert("Designated use of scholarship amounts cannot be greater than the scholarship itself.");
				document.getElementById(whatChanged).value = ""; // clear the offending entry
				ScholarTaxable.value = 0;
				return;
			}
		}

		// Adjust scholarship if lack of a W2 needs to be accounted for
		ScholarW2Yes.disabled = ScholarW2No.disabled = ! (ScholarIncome > 0);

		if (ScholarW2Yes.disabled) { // already accounted for
			ScholarW2Yes.checked = false;
			ScholarW2No.checked = false;
		}

		if (ScholarW2No.checked) {
			// add the W-2 equivalant amount to the student's return income line
			if (StudSalaryTax.value == "") { // If there was a W-2, probably would be entered
				if (DependentYes.checked) {
					StudSalaryTax.value = ScholarIncome;
					StudAGITax.value = +StudAGITax.value + +ScholarIncome; // don't use +=
				}
				else {
					SalaryTax.value = ScholarIncome;
					AGITax.value = +AGITax.value + +ScholarIncome; // don't use +=
				}
			}
			else {
				ScholarIncome = 0; // A W-2 already accounts for teaching salary part of scholarship
			}
		}

		// Calculate the amount of the scholarship that can be made taxable
		var taxableLimit = Math.min(+Nonrestricted.value, ScholarAvailable);

		// Limit taxable to dependent child to avoid the kiddie tax
		if (KiddieTaxApplies) {
			// Get the student's current unearned income amount and determine if must file

			// Taxable scholarship is earned income for this test
			var deductionAmount = +_StandardDeduction(TY, StudentFilingStatus.value,
				StudentTP65.checked, StudentTPBlind.checked, StudentSP65.checked, StudentSPBlind.checked,
				false, 0);
			var fileMinimum = +_IRSValue("DependMin");

			taxableLimit = Math.min(deductionAmount, taxableLimit);

			// Set default filing margins (-1 means not yet calculated)
			if (KiddieFileMargin == -1) {
				KiddieFileMargin = KiddieTaxThreshold;
				StudentFileMargin = deductionAmount;
			}

			// Get the student's current unearned income
			// (StudEarnedTax.value is stored in a hidden row in the student's table)
			var studentUnearned = +StudAGITax.value - +StudEarnedTax.value;
			if (studentUnearned > KiddieTaxThreshold) { // Kiddie tax already applies
				if (! Optimizing) {
					alert("CAUTION!\x0DKiddie tax already applies to this student, which is out of scope.");
					NoOptimize4.style.display = "block";
					KiddieTaxFlag = true;
				}
			}
			else {
				NoOptimize4.style.display = "none";
				KiddieTaxFlag = false;
			}
			KiddieFileMargin = Math.max(0, (KiddieTaxThreshold - studentUnearned) ); // Taxable scholarship is not included

			// grossMargin is the amount that can be added without having to file
			var earnedIncrement = +_IRSValue("DependInc");
			var maxStudentDeduction = Math.min(+StudEarnedTax.value + taxableLimit + earnedIncrement, deductionAmount);
			var grossMargin = maxStudentDeduction - StudAGITax.value;

			switch (true) {
				case (+StudTaxTax.innerHTML > 0): // currently must file
					grossLimit = KiddieFileMargin;
					break;
				case (grossMargin > taxableLimit): // will not have to file
					grossLimit = taxableLimit;
					break;
				default: // may have to file if grossMargin is exceeded
					grossLimit = Math.max(grossMargin, KiddieFileMargin);
			}

			// Limit to the amount actually available
			taxableLimit = Math.min(grossLimit, taxableLimit); // Exceeding this will trigger kiddie tax

			if (ScholarTaxable.value > taxableLimit) {
				if (! Optimizing) alert("CAUTION!\x0DYou are exceeding the taxable amount to your dependent child that makes the taxpayer \"kiddie tax\" come into effect for the taxpayer. You don't want to do that.");
				ScholarTaxable.value = "";
			}
		}

		// Limit taxable to dependent relative to prevent a filing requirement (thus no longer dependent)
		RelativeViolation = false;
		if (DependentYes.checked && StudentIsAdult && (! Disabled.checked)) { // dependent relative limit
			// Get the student's current AGI (not quite accurate - should be total income)
			// taxableLimit = +StudAGITax.value; // rmv in v4.6
			taxableLimit = Math.min(+StudAGITax.value, taxableLimit); // added in v4.6
			var exemptionLimit = _IRSValue("DepAsRel");
			if (taxableLimit > exemptionLimit) {
				message = "The student you are designating as a dependant has an AGI";
				message += " that is too high for the student to be a qualified dependent.";
				alert(message);
				RelativeViolation = true;
			}
			taxableLimit = Math.max(0, exemptionLimit - taxableLimit);
			if (ScholarTaxable.value > taxableLimit) {
				if (! Optimizing) {
					message = "CAUTION!\x0DYou are exceeding the taxable amount";
					message += " to your dependent relative that makes the student";
					message += " ineligible to be your dependent. You don't want to do that.";
					alert(message);
				}
				ScholarTaxable.value = "";
			}
		}

		// Show taxable limits on the funding sources tab
		ScholarTaxableMax.innerHTML = taxableLimit;
		ScholarTaxableLimit.disabled = ! ScholarTaxableLimitYes.checked;
		var STLval = ScholarTaxableLimit.value;
		if (ScholarTaxableLimitYes.checked) {
			if (STLval === "") STLval = taxableLimit;
			else STLval = Math.min(STLval, taxableLimit);
		}
		else STLval = "";
		ScholarTaxableLimit.value = STLval;

		// Check taxable amount specifed
		if (ScholarTaxable.value > taxableLimit) {
			ScholarTaxable.value = taxableLimit = Math.max(0, taxableLimit);
			if ((! Optimizing) && (taxableLimit > 0)) {
				alert("Taxable amount cannot be more than " + taxableLimit);
			}
		}

		// Calculate the amount of scholarship available to cover the expenses
		ScholarTaxable.disabled = false;
		ScholarshipTaxableMsg.style.display = "none";
		if (DegreeNo.checked) {
			ScholarshipTaxableMsg.style.display = (ScholarAvailable > 0) ? "inline" : "none";
			ScholarTaxable.value = 0;
			ScholarTaxable.disabled = true;
			ScholarAvailable = 0;
		}
		ScholarTaxFree.innerHTML = Math.max(0, (ScholarAvailable -= +ScholarTaxable.value));

		// Add other supplemental funding
		ScholarSupplemental = +ScholarESA.value + +ScholarQTP.value;
		SupplementalTaxable.style.display = (DegreeNo.checked & (ScholarSupplemental > 0)) ? "inline" : "none";
		ScholarNQMax = ScholarSupplemental + +Nonrestricted.value;

		ScholarAvailableTotal.innerHTML = ScholarAvailable = +ScholarTaxFree.innerHTML + ScholarSupplemental;
		var scholarAvailableAOC = ScholarAvailable;
		var scholarAvailableLLC = ScholarAvailable;
		//ExpenseAllowedFlag.style.display = (ScholarAvailable > 0) ?  "inline" : "none";

		//-----------------------Expense calculations --------------------------------

		// Calculate qualified expenses for each category and set tax-free amount flags
		QualExpenses["AOC"] = QualExpenses["LLC"] = 0;
		NonqualExpenses["AOC"] = NonqualExpenses["LLC"] = 0;
		AllowedExpenses["AOC"] = AllowedExpenses["LLC"] = 0;

		// Must be at least half time to apply funds to living expenses
		var livingAvailable = (! TimePart.checked) ? (+ScholarNQMax + +ScholarIRA.value) : 0;
		var servicesAvailable = +ScholarESA.value + +ScholarQTP.value + +ScholarIRA.value;
		ScholarReduction = 0;
		ScholarReductionMax = ScholarAvailable;

		// VerifyExpense(Category,   AOC,   LLC,   LIMIT
		VerifyExpense("Tuition",     true,  true,  ScholarAvailable);
		VerifyExpense("Fees",	     true,  true,  ScholarAvailable);
		VerifyExpense("InstBooks",   true,  true,  ScholarAvailable);
		VerifyExpense("SecondBooks", true,  false, ScholarAvailable);
		VerifyExpense("Supplies",    true,  true,  ScholarAvailable);
		VerifyExpense("OtherStuff",  true,  false, ScholarAvailable);
		VerifyExpense("Living",      false, false, livingAvailable);
		VerifyExpense("Insurance",   false, false, 0);
		VerifyExpense("Services",    false, false, servicesAvailable);
		VerifyExpense("Transport",   false, false, 0);
		VerifyExpense("Sports",      false, false, 0);
		VerifyExpense("NonCredit",   false, false, 0);
		VerifyExpense("Clerical",    false, false, 0);

		// show the expense totals
		NQTotalAOC.innerHTML = NonqualExpenses["AOC"];
		NQTotalLLC.innerHTML = NonqualExpenses["LLC"];
		NQAvailAOC.innerHTML = Math.min(ScholarNQMax, (DegreeNo.checked) ? 0 : NonqualExpenses["AOC"]);
		NQAvailLLC.innerHTML = Math.min(ScholarNQMax, (DegreeNo.checked) ? (NonqualExpenses["AOC"] - NonqualExpenses["LLC"]) : NonqualExpenses["LLC"]);
		ExpensesAOC.innerHTML = QualExpenses["AOC"];
		ExpensesLLC.innerHTML = QualExpenses["LLC"];

		// Allocate funds available

		WarningMessage = "";

		// Use as much as possible to pay nonqualified expenses

		// Adjust scholarship total for "manually checked" expenses
		ScholarAvailable -= ScholarReduction;

		NQExpenses["AOC"] = NQExpenses["LLC"] = 0;
		NQExpense("Tuition");
		NQExpense("Fees");
		NQExpense("InstBooks");
		NQExpense("SecondBooks");
		NQExpense("Supplies");
		NQExpense("OtherStuff");
		NQExpense("Living");
		NQExpense("Insurance");
		NQExpense("Services");
		NQExpense("Transport");
		NQExpense("Sports");
		NQExpense("NonCredit");
		NQExpense("Clerical");

		NQAvailAOC.innerHTML = NQExpenses["AOC"];
		NQAvailLLC.innerHTML = NQExpenses["LLC"];

		// Distribute the scholarship between q and non-q expenses
		Distribute("AOC");
		Distribute("LLC");

		// Warning messages for supplementary funds

		var expensesSupplemental = +ExpensesAOC.innerHTML + +Services.value + +Living.value;
		var CombinedWarning = true;
		if (+ScholarESA.value > expensesSupplemental) {
			WarningMessage += "<br />The amount used from your Coverdel ESA exceeds";
			WarningMessage += " your allowed expenses for that source.";
			WarningMessage += " You will have to include the investment gain on the";
			WarningMessage += " unused funds on your tax return.";
			CombinedWarning = false;
		}
		if (+ScholarQTP.value > expensesSupplemental) {
			WarningMessage += "<br />The amount used from your 529 Plan exceeds";
			WarningMessage += " your allowed expenses for that source.";
			WarningMessage += " You will have to include the investment gain on the";
			WarningMessage += " unused funds on your tax return.";
			CombinedWarning = false;
		}
		if (+ScholarIRA.value > expensesSupplemental) {
			WarningMessage += "<br />The amount used from your IRA exceeds your";
			WarningMessage += " allowed expenses for that source.";
			WarningMessage += " You will have to include a 10% penalty on the";
			WarningMessage += " unused funds on your tax return.";
			CombinedWarning = false;
		}
		if ((ScholarSupplemental > expensesSupplemental) && CombinedWarning){
			WarningMessage += "<br />The combined amount used from your ESA, 529 Plan";
			WarningMessage += " and IRA exceeds your allowed expenses for those sources.";
			WarningMessage += " You will have to include tax penalties on the unused";
			WarningMessage += " funds on your tax return.";
		}
		if (ScholarSAV.value > 0) {
			if ((ScholarSAV.value > QualExpensesAOC.innerHTML) ||
			    (ScholarSAV.value > QualExpensesLLC.innerHTML)) {
				WarningMessage += "<br />The Savings Bond amount exceeds the";
				WarningMessage += " qualified education expenses claimed on the";
				WarningMessage += " TP&apos;s tax return for one or more of the credits above.";
				WarningMessage += " You will have to declare the interest income on some or all";
				WarningMessage += " of the bonds if that option is used."
			}
		}

		// Show optimization situation messages
		var maxedOut = 0; //
		var showPerhaps = true;

		messageOver65.style.display =
		messageAOCMaxedOut.style.display =
		messageLLCMaxedOut.style.display =
		messageAllMaxedOut.style.display =
		messageNoUnqualified.style.display =
		NoOptimize1.style.display =
		NoOptimize2.style.display =
		NoOptimize3.style.display =
		NoOptimize4.style.display = "none";
		OptimizeButtons.style.display = "block";
		optDiv.style.display = "block";
		if (+ScholarTaxableMax.innerHTML > 0) {
			messageNoScholar.style.display = "none";
			OptimizeButtons.style.display = "block";
			if (+NQExpenses["AOC"] + +NQExpenses["LLC"] == 0) {
				messageNoUnqualified.style.display = "list-item";
				optDiv.style.display = 
				OptimizeButtons.style.display = "none";
				NoOptimize1.style.display = "block";
				showPerhaps = false;
			}
		}
		else if (RelativeViolation) {
			messageNoUnqualified.style.display = "list-item";
			optDiv.style.display = 
			OptimizeButtons.style.display = "none";
			NoOptimize3.style.display = "block";
			showPerhaps = false;
		}
		else if (KiddieTaxFlag && (studentUnearned > KiddieTaxThreshold)) {
			messageNoUnqualified.style.display = "list-item";
			optDiv.style.display = 
			OptimizeButtons.style.display = "none";
			NoOptimize4.style.display = "block";
			showPerhaps = false;
		}
		else if (Nonrestricted.value == 0) {
			messageNoScholar.style.display = "list-item";
			optDiv.style.display = 
			OptimizeButtons.style.display = "none";
			NoOptimize2.style.display = "block";
			showPerhaps = false;
		}

		// Age 65 messages
		if (TP65.checked || SP65.checked) {
			messageOver65.style.display = "list-item";
			if (F8962ATax.value > 0)
				Refund65Warning.innerHTML = "<br />TP and/or SP is over 65. The results may not be accurate due to Social Security and PTC interactions.";
			else
				Refund65Warning.innerHTML = "<br />TP and/or SP is over 65. The results may not be accurate.";
		}
		else Refund65Warning.innerHTML = "";

		if (maxedOut == 3) {
			messageAOCMaxedOut.style.display = "none";
			messageLLCMaxedOut.style.display = "none";
			messageAllMaxedOut.style.display = "list-item";
		}
		messagePerhaps.style.display = (showPerhaps) ? "list-item" : "none";
		messageDependent.style.display = (showPerhaps && DependentYes.checked && (TY < 2018)) ? "list-item" : "none";

		// Clear manual calcualations
		ManualTax.style.backgroundColor =
		ManualAOC.style.backgroundColor =
		ManualLLC.style.backgroundColor = "";

		ManualStateTax.style.backgroundColor =
		ManualStateAOC.style.backgroundColor =
		ManualStateLLC.style.backgroundColor = "";

		ManualTax.value = "";
		ManualAOC.value = (ManualAOC.disabled = (+QualExpensesAOC.innerHTML == 0)) ? 0 : "";
		ManualLLC.value = (ManualLLC.disabled = (+QualExpensesLLC.innerHTML == 0)) ? 0 : "";

		ManualStateTax.value = "";
		ManualStateAOC.value = (ManualStateAOC.disabled = (+QualExpensesAOC.innerHTML == 0)) ? 0 : "";
		ManualStateLLC.value = (ManualStateLLC.disabled = (+QualExpensesLLC.innerHTML == 0)) ? 0 : "";

		liClaimedQuestionAOC.innerHTML = 0;
		liClaimedQuestionLLC.innerHTML = 0;

		ManualQETextAOC.innerHTML = QualExpensesAOC.innerHTML;
		ManualQETextLLC.innerHTML = QualExpensesLLC.innerHTML;

		//-----------------------Tax return calculations --------------------------------

		// Disable PTC MAGI entry if not needed
		//F8962MAGITax.disabled = (F8962ATax.value > 0) ? false : true;

		// Taxable scholarship lines
		ScholarAOC.innerHTML = +((DependentNo.checked) ? +IncomeAOC.innerHTML : 0);
		ScholarLLC.innerHTML = +((DependentNo.checked) ? +IncomeLLC.innerHTML : 0);
		liClaimedQuestionAOC.innerHTML = 
			StudScholarAOC.innerHTML = +IncomeAOC.innerHTML;
		liClaimedQuestionLLC.innerHTML = 
			StudScholarLLC.innerHTML = +IncomeLLC.innerHTML;

		// Earned income lines
		if (isNaN(SalaryTax.value)) SalaryTax.value = "";
		if (isNaN(BusinessTax.value)) BusinessTax.value = "";
		SEHIAOC.innerHTML = SEHILLC.innerHTML = SEHITax.value;
		BusinessAOC.innerHTML = BusinessLLC.innerHTML = BusinessTax.value;
		EarnedTax.value = +SalaryTax.value + +BusinessTax.value;
		SalaryAOC.innerHTML = +SalaryTax.value + +ScholarAOC.innerHTML;
		EarnedAOC.innerHTML = +EarnedTax.value + +ScholarAOC.innerHTML;
		SalaryLLC.innerHTML = +SalaryTax.value + +ScholarLLC.innerHTML;
		EarnedLLC.innerHTML = +EarnedTax.value + +ScholarLLC.innerHTML;
		if (DependentYes.checked) {
			if (isNaN(StudSalaryTax.value)) StudSalaryTax.value = "";
			if (isNaN(StudBusinessTax.value)) StudBusinessTax.value = "";
			StudSEHIAOC.innerHTML = StudSEHILLC.innerHTML = StudSEHITax.value;
			StudBusinessAOC.innerHTML = StudBusinessLLC.innerHTML = StudBusinessTax.value;
			StudEarnedTax.value = +StudSalaryTax.value + +StudBusinessTax.value;
			StudSalaryAOC.innerHTML = +StudSalaryTax.value + +StudScholarAOC.innerHTML;
			StudEarnedAOC.innerHTML = +StudEarnedTax.value + +StudScholarAOC.innerHTML;
			StudSalaryLLC.innerHTML = +StudSalaryTax.value + +StudScholarLLC.innerHTML;
			StudEarnedLLC.innerHTML = +StudEarnedTax.value + +StudScholarLLC.innerHTML;
		}

		// AGI lines
		if (isNaN(AGITax.value)) AGITax.value = "";
		AGIAOC.innerHTML = +AGITax.value + +ScholarAOC.innerHTML;
		AGILLC.innerHTML = +AGITax.value + +ScholarLLC.innerHTML;
		if (DependentYes.checked) {
			if (isNaN(StudAGITax.value)) StudAGITax.value = "";
			StudAGIAOC.innerHTML = +StudAGITax.value + +IncomeAOC.innerHTML;
			StudAGILLC.innerHTML = +StudAGITax.value + +IncomeLLC.innerHTML;
		}

		// Capital Gains lines
		if (isNaN(CapGainsTax.value)) CapGainsTax.value = "";
		CapGainsAOC.innerHTML =
		CapGainsLLC.innerHTML = CapGainsTax.value;
		if (DependentYes.checked) {
			if (isNaN(StudCapGainsTax.value)) StudCapGainsTax.value = "";
			StudCapGainsAOC.innerHTML =
			StudCapGainsLLC.innerHTML = StudCapGainsTax.value;
		}

		// Deduction and Tax lines
		if (isNaN(MedicalTax.value)) MedicalTax.value = "";
		if (isNaN(ItemizedTax.value)) ItemizedTax.value = "";
		result = CalculateTax(AGITax.value, EarnedTax.value, 0, CapGainsTax.value, ClaimedYes.checked);
			DeductionTax.innerHTML = result.deduction;
			TaxTax.innerHTML = result.tax;
			QBITax.innerHTML = result.qbi;
		result = CalculateTax(AGIAOC.innerHTML, EarnedAOC.innerHTML, ScholarAOC.innerHTML, CapGainsAOC.innerHTML, false);
			DeductionAOC.innerHTML = result.deduction;
			TaxAOC.innerHTML = result.tax;
			QBIAOC.innerHTML = result.qbi;
		result = CalculateTax(AGILLC.innerHTML, EarnedLLC.innerHTML, ScholarLLC.innerHTML, CapGainsLLC.innerHTML, false);
			DeductionLLC.innerHTML = result.deduction;
			TaxLLC.innerHTML = result.tax;
			QBILLC.innerHTML = result.qbi;
		if (DependentYes.checked) {
			if (isNaN(StudItemizedTax.value)) StudItemizedTax.value = "";
			result = CalculateTax(StudAGITax.value, StudEarnedTax.value, 0, StudCapGainsTax.value, true);
				StudDeductionTax.innerHTML = result.deduction;
				StudTaxTax.innerHTML = result.tax;
				StudKiddieTax = result;
				StudQBITax.innerHTML = result.qbi;
			result = CalculateTax(StudAGIAOC.innerHTML, StudEarnedAOC.innerHTML, StudScholarAOC.innerHTML, StudCapGainsAOC.innerHTML, true);
				StudDeductionAOC.innerHTML = result.deduction;
				StudTaxAOC.innerHTML = result.tax;
				StudKiddieAOC = result;
				StudQBIAOC.innerHTML = result.qbi;
			result = CalculateTax(StudAGILLC.innerHTML, StudEarnedLLC.innerHTML, StudScholarLLC.innerHTML, StudCapGainsLLC.innerHTML, true);
				StudDeductionLLC.innerHTML = result.deduction;
				StudTaxLLC.innerHTML = result.tax;
				StudKiddieLLC = result;
				StudQBILLC.innerHTML = result.qbi;
		}

		// Determine new APTC and Net PTC amounts
		if ((whatChanged == "ACAMonths") &&(+ACAMonths.value != 12)) {
			alert("For coverage for less than 12 months, enter the total of the amounts in lines 12 through 23.\nEstimates may be off slightly due to rounding issues or if the monthy amounts differ.");
		}

		// APTC and PTC lines - primary taxpayer only
		if (ClaimedYes.checked) {
				F8962ATax.value = F8962BTax.value = F8962FTax.value = ACAMonths.value = "";
		}
		else {
			if (isNaN(F8962ATax.value)) F8962ATax.value = "";
			if (isNaN(F8962BTax.value)) F8962BTax.value = "";
			if (isNaN(F8962FTax.value)) F8962FTax.value = "";
			result = CalculateAPTC(+AGITax.value + +((+StudTaxTax.innerHTML) ? StudAGITax.value : 0),
				F8962ATax.value, F8962BTax.value, F8962FTax.value, ACAMonths.value);
			ExcessAPTCTax.innerHTML = +result.APTC;
			NetPTCTax.innerHTML = +result.PTCNet;
			result = CalculateAPTC(+AGIAOC.innerHTML + +((+StudTaxAOC.innerHTML) ? StudAGIAOC.innerHTML : 0),
				F8962ATax.value, F8962BTax.value, F8962FTax.value, ACAMonths.value);
			ExcessAPTCAOC.innerHTML = +result.APTC;
			NetPTCAOC.innerHTML = +result.PTCNet;
			result = CalculateAPTC(+AGILLC.innerHTML + +((+StudTaxLLC.innerHTML) ? StudAGILLC.innerHTML : 0),
				F8962ATax.value, F8962BTax.value, F8962FTax.value, ACAMonths.value);
			ExcessAPTCLLC.innerHTML = +result.APTC;
			NetPTCLLC.innerHTML = +result.PTCNet;
			}

		// Determine how much of the credits can be used and adjust Nonrefundable credits
		// ExtraNRC is the nonrefundable credits other than those that are being examined
		if (isNaN(FTCTax.value)) FTCTax.value = "";
		if (isNaN(StudFTCTax.value)) StudFTCTax.value = "";
		if (isNaN(AllowedCareTax.value)) AllowedCareTax.value = "";
		if (isNaN(LLCTax.value)) LLCTax.value = "";
		if (isNaN(MaxRetireTax.value)) MaxRetireTax.value = "";
		if (isNaN(NRCreditTax.value)) NRCreditTax.value = "";
		result = CalculateNonrefundable("TAX", +LLCTax.value, +AGITax.value);
			ForeignTax.innerHTML = result.Foreign;
			CareTax.innerHTML = result.Care;
			RefCareTax.innerHTML = result.RefCare;
			LLCTax.value = result.Ed;
			RetireTax.innerHTML = result.Retire;
			CTCTax.innerHTML = +result.CTC + +result.FTC;
			ACTCTax.innerHTML = result.ACTC;

		// Calculate Education and AOC nonrefundable credits for the taxpayer
		if (isNaN(AOCTax.value)) AOCTax.value = "";
		CalculateAOC();
		CalculateLLC();

		// Calculate nonrefundable credits for the student
		if (DependentYes.checked) {
			StudFTCAOC.innerHTML =
			StudFTCLLC.innerHTML = StudFTCTax.value;
			StudNRCreditTax.innerHTML =
			StudForeignTax.innerHTML = Math.min(+StudFTCTax.value, +StudTaxTax.innerHTML);
			StudNRCreditAOC.innerHTML =
			StudForeignAOC.innerHTML = Math.min(+StudFTCTax.value, +StudTaxAOC.innerHTML);
			StudNRCreditLLC.innerHTML =
			StudForeignLLC.innerHTML = Math.min(+StudFTCTax.value, +StudTaxLLC.innerHTML);
		}

		// Calculate Earned Income Credits
		switch (TY) { // Age 65 give wrong answer but unlikely to be a student anyway
		case 2020: // Age 25 - 65
			EICLower.innerHTML = 25;
			EICUpper.innerHTML = "or greater than 64";
			NoDepAge = ((! StudentAge25.checked) || TP65.checked);
			break;
		case 2021: // Age 19 - 99
			EICLower.innerHTML = 19;
			EICUpper.innerHTML = "";
			NoDepAge = (StudentAge16.checked || StudentAge17.checked || StudentAge18.checked);
			break;
		default: // Age 24 - 65
			EICLower.innerHTML = 24;
			EICUpper.innerHTML = "or greater than 64";
			NoDepAge = ((! (StudentAge25.checked || StudentAge24.checked)) || TP65.checked);
		}
		if ( DependentNo.checked && (EICDependents.value == 0) && NoDepAge ) NoEIC.checked = true;

		if ((NoEIC.checked) || (ClaimedYes.checked)) {
			// Probable high investment income, NR Alien, underage, retired, or dependent
			EICTax.innerHTML = "";
			EICAOC.innerHTML =
			EICLLC.innerHTML = "";
		}
		else {
			EICInvest.innerHTML = _IRSValue("EIC.InvestMax");
			EICTax.innerHTML = _EICLookup(TY, FS, EICDependents.value,
				(+EarnedTax.value - BusinessSETax),
				CapGainsTax.value, AGITax.value, TP65.checked, SP65.checked);
			EICAOC.innerHTML = _EICLookup(TY, FS, EICDependents.value,
				+EarnedAOC.innerHTML - +ScholarAOC.innerHTML - BusinessSETax,
				CapGainsAOC.innerHTML, AGIAOC.innerHTML, TP65.checked, SP65.checked);
			EICLLC.innerHTML = _EICLookup(TY, FS, EICDependents.value,
				+EarnedLLC.innerHTML - +ScholarLLC.innerHTML - BusinessSETax,
				CapGainsLLC.innerHTML, AGILLC.innerHTML, TP65.checked, SP65.checked);
		}

		// Calculate the refund fields
		var BaseRefund = Math.max(0, +TaxTax.innerHTML + +ExcessAPTCTax.innerHTML - +NRCreditTax.value)
			- +ACTCTax.innerHTML - +AOCTax.value - +EICTax.innerHTML - +NetPTCTax.innerHTML;
		TaxpayerRefundAOC0.innerHTML = 
		TaxpayerRefundAOC.innerHTML = BaseRefund - (Math.max(0, +TaxAOC.innerHTML - +NRCreditAOC.innerHTML)
			+ +ExcessAPTCAOC.innerHTML
			- +ACTCAOC.innerHTML - +AOCAOC.innerHTML - +EICAOC.innerHTML - +NetPTCAOC.innerHTML);
		TaxpayerRefundLLC0.innerHTML =
		TaxpayerRefundLLC.innerHTML = BaseRefund - (Math.max(0, +TaxLLC.innerHTML - +NRCreditLLC.innerHTML)
			+ +ExcessAPTCLLC.innerHTML
			- +ACTCLLC.innerHTML - +AOCLLC.innerHTML - +EICLLC.innerHTML - +NetPTCLLC.innerHTML);
		if (DependentNo.checked) {
			StudentRefundAOC.innerHTML = 
			StudentRefundLLC.innerHTML = 0; 
		}
		else {
			BaseRefund = Math.max(0, +StudTaxTax.innerHTML - +StudNRCreditTax.innerHTML) - +AOCTax.value;
			StudentRefundAOC0.innerHTML =
			StudentRefundAOC.innerHTML =
				BaseRefund - (Math.max(0, +StudTaxAOC.innerHTML - +StudNRCreditAOC.innerHTML));
			StudentRefundLLC0.innerHTML =
			StudentRefundLLC.innerHTML =
				BaseRefund - (Math.max(0, +StudTaxLLC.innerHTML - +StudNRCreditLLC.innerHTML));
		}

		RefundAOC.innerHTML = Math.round(+TaxpayerRefundAOC.innerHTML + +StudentRefundAOC.innerHTML);
		RefundLLC.innerHTML = Math.round(+TaxpayerRefundLLC.innerHTML + +StudentRefundLLC.innerHTML);

		// Determine the best choice
		ClearUneligibles();
		MaxRefund = Math.max(
				(StudentAOC.innerHTML == "No") ? -100000 : +RefundAOC.innerHTML,
			       	(StudentLLC.innerHTML == "No") ? -100000 : +RefundLLC.innerHTML); 

		// Highlight fields and show best results in the summary section
		if ((+RefundLLC.innerHTML == MaxRefund)) {
			RefundLLC.style.backgroundColor = "lightgreen";
			ResultingProgram = "LLC";
			ResultingIncome = +IncomeLLC.innerHTML;
			ResultingExpense = +QualExpensesLLC.innerHTML;
			MaxRefundAGI = +AGILLC.innerHTML;
			MaxRefundTaxable = +IncomeLLC.innerHTML;
		}
		else RefundLLC.style.backgroundColor = "hotpink";
			
		if ((+RefundAOC.innerHTML == MaxRefund)) {
			RefundAOC.style.backgroundColor = "lightgreen";
			ResultingProgram = "AOC";
			ResultingIncome = +IncomeAOC.innerHTML;
			ResultingExpense = +QualExpensesAOC.innerHTML;
			MaxRefundAGI = +AGIAOC.innerHTML;
			MaxRefundTaxable = +IncomeAOC.innerHTML;
		}
		else RefundAOC.style.backgroundColor = "hotpink";

		if (ResultingExpense) {
			TaxpayerResultOption.innerHTML = ResultingProgram
			TaxpayerResultIncome.innerHTML = (DependentNo.checked) ? ResultingIncome : 0;
			ScholarResultIncome.innerHTML = (DependentYes.checked) ? ResultingIncome : 0;
			SupTuition.innerHTML = TaxpayerResultTuition.innerHTML = Tuition.value;
			ResultingScholar = Math.max(0, allScholarships - ResultingIncome);
			TaxpayerResultScholar.innerHTML = ResultingScholar;
			if (+TY > 2021) {
				ResultingExpense = Math.max(0, ResultingExpense + ResultingScholar - Tuition.value);
			}
			TaxpayerResultExpense.innerHTML = ResultingExpense;
			//TaxpayerResultExpense.innerHTML = (ResultingProgram == "AOC") ? QualExpensesAOC2.innerHTML : QualExpensesLLC2.innerHTML ;   
			SupResultExpenses.innerHTML = (ResultingProgram == "AOC") ? ExpensesAOC.innerHTML : ExpensesLLC.innerHTML ;   
		}
		else {
			TaxpayerResultOption.innerHTML = "None";
			TaxpayerResultIncome.innerHTML = (DependentNo.checked) ? 0 : 0;
			ScholarResultIncome.innerHTML = (DependentYes.checked) ? 0 : 0;
			TaxpayerResultTuition.innerHTML = 0;
			TaxpayerResultScholar.innerHTML = 0;
			TaxpayerResultExpense.innerHTML = 0;
		}

		// Warning messages
		if (ScholarSAV.value > 0) {
			var AGISAVLimit = _IRSValue("Education.Savings." + FS + "0");
			if ((+AGIAOC.innerHTML > AGISAVLimit) ||
					(+AGIAOC.innerHTML > AGISAVLimit) ||
					(+AGIAOC.innerHTML > AGISAVLimit)) {
				WarningMessage += "<br />The AGI for one or more of the above credit calculations exceeds that allowable for interest-free savings bond use.  You will have to declare the interest income on some or all of the bonds."
			}
		}

	// Display the warning messages
	ExpensesWarning.innerHTML = (WarningMessage == "") ? "" : WarningMessage;
	OptimizerWarning.innerHTML = (WarningMessage == "") ? "" : WarningMessage;
	}

	//----------------------------------------------------------------------------------------
	function ClearScholarTaxable () {
	//----------------------------------------------------------------------------------------
		ScholarTaxable.value = 0;
	}

	//----------------------------------------------------------------------------------------
	// This function distributes the scholarship to qualified and non-qualified expenses
	function Distribute(
		type	// AOC or LLC
		) {
	// returns true if kiddie tax was encountered
	//----------------------------------------------------------------------------------------
		// saRemaining is the amount of ScholarAvailable that remains to be distributed
		// Does not include restricted scholarships
		var saRemaining = ScholarAvailable;
		var saRestricted = +Restricted.value;

		// qTaxLimit is the tax law limit for the type of credit
		switch (type) {
			case "AOC": var qTaxLimit = +MaxAOC.innerHTML; break;
			case "LLC": var qTaxLimit = +MaxLLC.innerHTML; break;
		}

		// nqntExpensesLeft is the non-qualified amount that is not taxable
		var nqntExpensesLeft = Math.max(0, QualExpenses["AOC"] - QualExpenses[type]);
		var nqntExpensesLeft0 = Math.min(nqntExpensesLeft, NonqualExpenses[type]);
		
		// Supplemental resources are not eligible for taxing due to penalties
		var taxExpenseLimit = Math.max(0, NQExpenses[type] - ScholarSupplemental);
		// Taxable amount may be limited manually
		var taxLimit = Math.min(+ScholarTaxableMax.innerHTML, taxExpenseLimit);
		var taxRequested = +ScholarTaxable.value;
		var incomeAmount = taxRequested + ScholarIncome;

		// suppnqAmountPaid is the non-qualified amount that is taxable if used
		var suppnqAmountPaid = nqExpensesLeft = NQExpenses["AOC"];

		// Amount distributed for expenses
		var nqAmountPaid = 0; // nonqualified
		var qAmountPaid =  0;  // qualified
		var qExpensesLeft = QualExpenses[type];

		// Use Supplemental sources for supplemental non-qualified first
		var suppRemainder = ScholarSupplemental;
		var suppPay = Math.min(suppRemainder, suppnqAmountPaid);
		nqAmountPaid += suppPay;
		nqExpensesLeft -= suppPay;
		saRemaining -= suppPay;
		suppRemainder -= suppPay;

		// Use remaining supplemental sources to pay qualified expenses
		suppPay = Math.min(suppRemainder, QualExpenses[type]);
		qAmountPaid += suppPay;
		qExpensesLeft -= suppPay;
		saRemaining -= suppPay;
		suppRemainder -= suppPay;

		// Use remaining supplemental sources for nontaxable non-qualified
		suppPay = Math.min(suppRemainder, nqntExpensesLeft);
		nqntExpensesLeft -= suppPay;
		nqAmountPaid += suppPay;
		nqExpensesLeft -= suppPay;
		saRemaining -= suppPay;
		suppRemainder -= suppPay; // hopefully will be 0

		// Use restricted scholarships for qualified expenses
		qAmountPaid += saRestricted;
		qExpensesLeft -= saRestricted;
		saRemaining -= saRestricted;

		if (GapGap.checked) {
			// Determine the limiting amounts
			gapAmount = Math.min(qExpensesLeft, nqExpensesLeft, qTaxLimit, saRemaining);

			// Amount to pay to qualified amounts to maximize expenses
			var qPay = Math.max(0, qExpensesLeft - gapAmount);
			qAmountPaid += qPay;
			qExpensesLeft -= qPay;
			saRemaining -= qPay;
			gapAmount -= qPay;

			// If there's any non-taxable nonqualified amount left, pay it next
			nqntPay = Math.min(nqntExpensesLeft, gapAmount);
			nqAmountPaid += nqntPay;
			nqExpensesLeft -= nqntPay;
			saRemaining -= nqntPay;
			gapAmount -= nqntPay;
		}

		else { 
			// Pay qualified next
			var qePayLimit = Math.max(0, QualExpenses[type] - qAmountPaid);
			var qPaid = Math.min(saRemaining, qePayLimit);
			qAmountPaid += qPaid;
			qExpensesLeft -= qPaid;
			saRemaining -= qPaid;

			// If there's any non-taxable nonqualified amount left, pay it next
			nqntPay = Math.min(nqntExpensesLeft, saRemaining);
			nqntExpensesLeft -= nqntPay;
			nqAmountPaid += nqntPay;
			nqExpensesLeft -= nqntPay;
			saRemaining -= nqntPay;
		}

		// remainder is taxable, show it as paying nonqualified expenses
		incomeAmount = Math.max(0, incomeAmount + saRemaining - nqntExpensesLeft);
		nqAmountPaid += (Math.min(incomeAmount, NQExpenses["AOC"]));

		// adjust for kiddie tax avoidance
		if (KiddieTaxApplies) {
			if (DependentYes.checked && (incomeAmount > StudentFileMargin) && (incomeAmount > KiddieFileMargin)) {
				var kiddieAdjust = Math.min(incomeAmount - KiddieFileMargin, incomeAmount - StudentFileMargin);
				var nqKiddieLimit = NQExpenses[type];
				var qKiddieLimit = QualExpenses[type] - qAmountPaid;
				kiddieAdjust = Math.min(incomeAmount, kiddieAdjust, nqKiddieLimit, qKiddieLimit);
				nqAmountPaid -= kiddieAdjust;
				qAmountPaid += kiddieAdjust;
				incomeAmount -= kiddieAdjust;
			}
			var studUnearned = +StudAGITax.value - +StudSalaryTax.value - +StudBusinessTax.value - +StudSEHITax.value;
			if (studUnearned && (incomeAmount > KiddieFileMargin)) {
				alert ("The student is subject to kiddie tax, which is out of scope");
			}
		}

		// Save the results
		qExpensesLeft = Math.max(0, QualExpenses[type] - qAmountPaid);
		switch (type) {
			case "AOC":
				NQAvailAOC.innerHTML = +NQAvailAOC.innerHTML + ScholarReduction; // v3.1
				NQNTAOC.innerHTML = nqntExpensesLeft0; // v3.37
				QUsedAOC.innerHTML = qAmountPaid;
				NQUsedAOC.innerHTML = nqAmountPaid; // v3.37
				NontaxableAOC.innerHTML = nqntPay; // v3.37
				QualExpensesAOC.innerHTML =
				QualExpensesAOC2.innerHTML = Math.min(qExpensesLeft, qTaxLimit);
				IncomeAOC.innerHTML = IncomeAOC2.innerHTML = incomeAmount;
				break;

			case "LLC":
				NQAvailLLC.innerHTML = +NQAvailLLC.innerHTML + ScholarReduction; // v3.1
				NQNTLLC.innerHTML = nqntExpensesLeft0; // v3.37
				QUsedLLC.innerHTML = qAmountPaid;
				NQUsedLLC.innerHTML = nqAmountPaid; // v3.37
				NontaxableLLC.innerHTML = nqntPay; // v3.37
				QualExpensesLLC.innerHTML =
				QualExpensesLLC2.innerHTML = Math.min(qExpensesLeft, qTaxLimit);
				IncomeLLC.innerHTML = IncomeLLC2.innerHTML = incomeAmount; // v3.33
				break;
		}
		// return true if kiddie tax was encountered
		return (DependentYes.checked
				&& (incomeAmount > StudentFileMargin)
				&& (incomeAmount > KiddieFileMargin)); 
	}

	//----------------------------------------------------------------------------------------
	// This function determines the best choice of manually entered amounts after all are entered
	function ManualChange() {
	//----------------------------------------------------------------------------------------
		var changeAOC = changeLLC = ""; // null, not 0

		// Calculate changes
		var originalRefund = +ManualTax.value + +ManualStateTax.value;
		if (ManualTax != "") ManualDiffTax.innerHTML = 0;
		if (! ManualAOC.disabled)
			changeAOC = +ManualAOC.value + +ManualStateAOC.value - originalRefund;
			if (ManualAOC != "") ManualDiffAOC.innerHTML = changeAOC;
		if (! ManualLLC.disabled)
			changeLLC = +ManualLLC.value + +ManualStateLLC.value - originalRefund;
			if (ManualLLC != "") ManualDiffLLC.innerHTML = changeLLC;

		// Don't display colors until all applicable fields are filled in
		if (ManualTax.value == "") return;
		if (ManualAOC.value == "") return;
		if (ManualLLC.value == "") return;

		if (ManualStateTax.value != "") {
			if (ManualStateAOC.value == "") return;
			if (ManualStateLLC.value == "") return;
		}

		// Determine the best choice
		var MaxRefund = Math.max(changeAOC,changeLLC,0);

		// Highlight the choice totals
		ManualDiffTax.style.backgroundColor = (MaxRefund == 0) ? "lightgreen" : "";
		if (! ManualAOC.disabled)
			ManualDiffAOC.style.backgroundColor =
				((changeAOC < MaxRefund) || (changeAOC == 0)) ? "hotpink" : "lightgreen";
		if (! ManualLLC.disabled)
			ManualDiffLLC.style.backgroundColor =
				((changeLLC < MaxRefund) || (changeLLC == 0)) ? "hotpink" : "lightgreen";
	}

	//----------------------------------------------------------------------------------------
	// This function readjusts amounts when education expenses are changed
	function VerifyExpense(
		category,	// the expense category
		valAOC,		// qualified expense (true/false)
		valLLC,		// qualified expense (true/false)
		limit) {
	//----------------------------------------------------------------------------------------
		ExpenseCategoryAmount = document.getElementById(category);
		ExpenseOption = document.getElementById(category + "Option");
		qualifiedScholarshipExpense = (ExpenseOption === null); // no option checkbox
		ExpenseAllowedColumn = document.getElementById(category + "Allowed");

		// Add a check mark if funds are available for the category
		ExpenseAmount = 0;
		if (qualifiedScholarshipExpense) { // show fixed checkmark
			ExpenseAllowedColumn.innerHTML = "&#x2714;";
			ExpenseAmount = Math.round(Math.max(0,+(ExpenseCategoryAmount.value)));
		}
		else { // show optional checkbox on non-qualified funds
			// show fixed checkmark if there is an unrestricted scholarship
			AllowedElement = document.getElementById(category + "Allowed");
			if (AllowedElement != undefined) {
				if (+limit > 0) {
					AllowedElement.innerHTML = "&#x2714;";
					ExpenseOption.style.display = "none";
					//ExpenseAmount = Math.round(Math.min(+ExpenseCategoryAmount.value, +limit)); // v 3.37
					ExpenseAmount = Math.round(+ExpenseCategoryAmount.value); // v 3.37
				}
				else {
					AllowedElement.innerHTML = "";
					ExpenseOption.style.display = "inline";
				}
			}
			if (ExpenseOption.checked) {
				// Checked options only reduce the scholarship amount
				// We keep track of the amount and correct the display later by showing it available and used
				ExpenseAmount = Math.round(Math.min(+ExpenseCategoryAmount.value, ScholarReductionMax));
				ScholarReduction += Math.min(ExpenseAmount, ScholarReductionMax);
				ScholarReductionMax -= ExpenseAmount;
			}
		}


		// For each category column, include as qualified or non-qualified expense
		for (var eni=1; eni < arguments.length-1; eni++) {
			ProgramElement = document.getElementById(category + Program[eni-1]);
			AllowedAmount = document.getElementById(category + "SCH");
			if (arguments[eni]) {
				// This is a qualified deduction expense
				QualExpenses[Program[eni-1]] += ExpenseAmount;
				AllowedAmount.value = +limit;
				ProgramElement.style.color = QualColor;
			}
			else {
				// This is a non-qualified deduction expense
				NonqualExpenses[Program[eni-1]] += ExpenseAmount;
				AllowedAmount.value = Math.min(ExpenseAmount, +limit);
				AllowedExpenses[Program[eni-1]] += AllowedAmount.value;
				ProgramElement.style.color = NonqualColor;
			}
			ProgramElement.innerHTML = ExpenseAmount;
		}
	}

	//----------------------------------------------------------------------------------------
	// This function calculates amounts of nonqualified expenses than can be paid with funding sources
	function NQExpense(
		category) {	// the expense category
	//----------------------------------------------------------------------------------------
		ExpenseAllowedColumn = document.getElementById(category + "Allowed")
		ExpenseOption = document.getElementById(category + "Option");
		qualifiedExpense = (ExpenseOption === null); // no optional checkbox
		if (qualifiedExpense) {
			if (ExpenseAllowedColumn.innerHTML === "") return;
		}
		else {
			if ((! ExpenseOption.checked) && (LivingAllowed.innerHTML === "")) return;
		}

		for (var eni=0; eni < 2; eni++) {
			ProgramElement = document.getElementById(category + Program[eni]);
			AllowedAmount = document.getElementById(category + "SCH");
			if (ProgramElement.style.color == NonqualColor) {
				var amount = NQExpenses[Program[eni]] + AllowedAmount.value;
				NQExpenses[Program[eni]] = Math.min(amount, ScholarNQMax);
			}
		}
	}

	//----------------------------------------------------------------------------------------
	// This function calculates the tax benefit for the Lifetime Learning credit
	function CalculateLLC() {
	//----------------------------------------------------------------------------------------
		var testAGI = +AGILLC.innerHTML;
		var expenses = +QualExpensesLLC.innerHTML + (5 * +LLCTax.value);
		var limit0 = _IRSValue("Education.LLC.MAX0");
		var limit = 0.2 * Math.min(limit0, expenses);
		var factor = 1;
		switch (FS) {
		case "MFJ":
			limit1 = _IRSValue("Education.LLC.MFJ1");
			limit2 = _IRSValue("Education.LLC.MFJ2");
			if (testAGI >= limit1) factor = Math.max(0,(limit2 - testAGI) / (limit2 - limit1));
			break;
		case "MFS":
			factor = 0;
			break;
		default:
			limit1 = _IRSValue("Education.LLC.SNG1");
			limit2 = _IRSValue("Education.LLC.SNG2");
			if (testAGI >= limit1) factor = Math.max(0,(limit2 - testAGI) / (limit2 - limit1));
		}
		if (DependentNo.checked && ClaimedYes.checked) factor = 0;

		var nonrefundable = Math.round(factor*limit);

		result = CalculateNonrefundable("LLC", nonrefundable, AGILLC.innerHTML)
			ForeignLLC.innerHTML = result.Foreign;
			CareLLC.innerHTML = result.Care;
			RefCareLLC.innerHTML = result.RefCare;
			LLCLLC.innerHTML = result.Ed;
			RetireLLC.innerHTML = result.Retire;
			CTCLLC.innerHTML = result.CTC + result.FTC;
			NRCreditLLC.innerHTML = result.NRC;
			ACTCLLC.innerHTML = result.ACTC;
			return;
	}

	//----------------------------------------------------------------------------------------
	// This function calculates the tax benefit for the American Opportunity credit
	function CalculateAOC() {
	//----------------------------------------------------------------------------------------
		var testAGI = +AGIAOC.innerHTML;
		var expenses = +QualExpensesAOC.innerHTML;
		if (expenses > 2000) expenses = 2000 + ((expenses-2000) * 0.25);
		var limit0 = _IRSValue("Education.AOC.MAX0");
		var limit = Math.min(limit0, expenses);
		var factor = 1;
		switch (FS) {
			case "MFJ":
				limit1 = _IRSValue("Education.AOC.MFJ1");
				limit2 = _IRSValue("Education.AOC.MFJ2");
				if (testAGI >= limit1) factor = Math.max(0,(limit2 - testAGI) / (limit2 - limit1));
				break;
			case "MFS":
				factor = 0;
				break;
			default:
				limit1 = _IRSValue("Education.AOC.SNG1");
				limit2 = _IRSValue("Education.AOC.SNG2");
				if (testAGI >= limit1) factor = Math.max(0,(limit2 - testAGI) / (limit2 - limit1));
		}
		if (DependentNo.checked && ClaimedYes.checked) factor = 0;

		var available = Math.round(factor*limit);

		// Determine refundable vs nonrefundable amounts
		var AOCRefundable = Math.round(0.4 * available);
		if (StudentAOCR.innerHTML == "No") AOCRefundable = 0;
		if (DependentNo.checked && ClaimedNo.checked && KiddieTaxApplies) AOCRefundable = 0;
		var nonrefundable = available - AOCRefundable + +LLCTax.value;
		AOCAOC.innerHTML = AOCRefundable + +AOCTax.value;
		AOCLLC.innerHTML = +AOCTax.value;

		result = CalculateNonrefundable("AOC", nonrefundable, +AGIAOC.innerHTML)
			ForeignAOC.innerHTML = result.Foreign;
			CareAOC.innerHTML = result.Care;
			RefCareAOC.innerHTML = result.RefCare;
			LLCAOC.innerHTML = result.Ed;
			RetireAOC.innerHTML = result.Retire;
			CTCAOC.innerHTML = result.CTC + result.FTC;
			NRCreditAOC.innerHTML = result.NRC;
			ACTCAOC.innerHTML = result.ACTC;
			return;
	}

	//----------------------------------------------------------------------------------------
	// This function calculates the tax given the AGI and filing status
	function CalculateTax(
			ctAGI,		// AGI
			ctEarned,	// Earned income (including taxable scholarships)
			ctScholar,	// Scholarship amount
			ctCG,		// Captial gains
			isStudent	// true/false if this is a student
			) {
	//returns:
	//	result.deduction
	//	result.tax
	//	result.qbi
	//if student:
	//	result.kiddieIncomeStandard
	//	result.kiddieResultStandard
	//	result.kiddieIncomeTrust
	//	result.kiddieResultTrust
	//----------------------------------------------------------------------------------------

		var result = {};

		// Get the exemption
		var taxExemptions = Exemptions; // Taxpayer's exemptions
		// Is this a dependent?
		if (isStudent) taxExemptions = 0;

		// Get the exemption amount
		var exemptionAmount = 0;
		if (taxExemptions > 0) {
			var exemptionAmount = taxExemptions * _IRSValue("Exemption");
		}

		// Get the standard deduction amount
		var fsv = (isStudent) ? StudentFilingStatus.value : FS;
		//var cte = (isStudent) ? (+ctEarned - +ctScholar) : ctEarned; // removed 3.20
		result.deduction = _StandardDeduction(TaxYear.value, fsv,
				TP65.checked, TPBlind.checked, SP65.checked, SPBlind.checked, isStudent, ctEarned);

		// Calculate the itemized deduction base without the medical
		if (isStudent) {
			var itemizedDeduction = StudItemizedTax.value;
		}
		else {
			var medicalRate = _IRSValue("MedExclusion");
			var medicalDeduction = Math.max(0, +MedicalTax.value - (AGITax.value * medicalRate));
			var itemizedBase = +ItemizedTax.value - medicalDeduction;

			// Figure the itemized deduction amount (add the medical back in based on the AGI)
			var itemizedDeduction = itemizedBase + Math.max(0, +MedicalTax.value - (+ctAGI * medicalRate));
		}

		// Take the largest deduction
		result.deduction = Math.max(result.deduction, itemizedDeduction);
		var taxable = Math.max(0, ctAGI - exemptionAmount - (result.deduction));

		// Add QBI if present
		QBIAmount = 0;
		result.qbi = 0;
		if (_IRSValue("LineNo.QBI")) {
			SEIncome = (isStudent) ? (+StudBusinessTax.value - StudBusinessSETax - +StudSEHITax.value) :
				(+BusinessTax.value - BusinessSETax - +SEHITax.value);
			result.qbi = _QBICalc(TY, FS, +SEIncome, 0, 0, taxable);
			//_QBICalc (	// Qualified Business Income deduction
			//taxYear,	// tax year tables to use
			//filingStatus,	// SNG, MFJ, WID, MFS, HOH
			//SEIncome,	// Self-employment income less s-e adjustments
			//nonTaxCG,	// Qualified dividends + capital gains
			//QBIDividends,	// Section 199A dividend
			//income)	// Taxable income amount (before QBI deduction)
		}
		taxable = Math.max(0, taxable - +result.qbi);

		// Look up the tax
		result.tax = _TaxLookup(TY, FS, taxable, ctCG, true)["tax"];

		return(result);
	}

	//----------------------------------------------------------------------------------------
	// This function calculates the Premium Tax Credits
	function CalculateAPTC(
		testAGI,	// AGI
		PTCPremium,	// F8962ATax.value
		PTC_SLCSP,	// F8962BTax.value
		PTCAdvance,	// F8962FTax.value
		PTCMonths	// +ACAMonths.value
			) {
	// returns an object:
	//	result.PTCNet
	//	result.APTC
	//----------------------------------------------------------------------------------------
		var result = []; result.APTC = result.PTCNet = 0;

		// Adjust entered values for less than a full year
		if (PTCMonths != 12) {
			PTCPremium = 12 * PTCPremium / PTCMonths;
			PTC_SLCSP = 12 * PTC_SLCSP / PTCMonths;
		}

		// Calculate the Federal Poverty Line percentage
		var FPLPercent = 100 * testAGI/FedPovertyLine;

		// Special rounding rules for PTC
		if (FPLPercent < 100) FPLPercent = Math.floor(FPLPercent);
		if (FPLPercent > 399 && FPLPercent < 400) FPLPercent = 399;
		if (FPLPercent > 400 && FPLPercent < 999) FPLPercent = Math.ceil(FPLPercent);
		if (FPLPercent > 999) FPLPercent = 999;
		FPLPercent = Math.floor(FPLPercent); // truncate rather than round since 2015

		if (FPLPercent < 133) { result.APTC = +PTCAdvance; return (result) } // not eligible for PTC
		if (FPLPercent > 400) { result.APTC = +PTCAdvance; return (result) } // must pay it all back

		var PTCFactor = 0;
		var PTCRange = 0;
		var PTCData = [];
		while (PTCRange < 400) {
			PTCData = _IRSValue("ACA.PTC" + PTCRange);
			if (PTCData[0] > FPLPercent) { // found it
				PTCFactor = +PTCData[1];
				break;
			}
			else PTCRange = +PTCData[0]; // keep looking
		}
		if (PTCRange == 400) {
			PTCFactor = +PTCData[2];
		}
		else {
			PTCFactor = (+PTCData[1] + ((FPLPercent - PTCRange) *
				(+PTCData[2] - +PTCData[1]) / (+PTCData[0] - PTCRange)))/100;
		}
		PTCFactor = Math.round(10000 * PTCFactor) / 10000; // round to 4 decimal places

		var PTCContribution = testAGI * PTCFactor;
		var PTCMaximum = Math.round(Math.min(+PTCPremium, Math.max(0, (+PTC_SLCSP - PTCContribution))));
		if (PTCMonths != 12) {
			PTCMaximum = PTCMonths * Math.round(PTCMaximum / 12);
		}
		result.PTCNet = Math.max(0,(PTCMaximum - PTCAdvance));
		var PTCExcessMax = PTCData[3] * ((FS == "MFS") ? 1 : 2);
		result.APTC = Math.round(Math.min(PTCExcessMax, Math.max(0, (PTCAdvance - PTCMaximum))));

		return (result);
	}

	//----------------------------------------------------------------------------------------
	// This function calculates the Child Care Credit
	function CalculateCareCredit(
		testAGI	//AGI
		) {
	// returns: credit amount
	//----------------------------------------------------------------------------------------
		var allowed = AllowedCareTax.value;
		return Math.round(_ChildCare(TY, FS, testAGI, allowed, allowed, allowed));

		//var Carefactor = Math.max(0.2, 0.35 - Math.max(0, Math.floor((+testAGI-13001)/2000)/100));
		//return Math.round(AllowedCareTax.value * Carefactor);
	}

	//----------------------------------------------------------------------------------------
	// This function adjusts the nonrefundable amounts
	function CalculateNonrefundable(
		type,	// AOC/LLC, to get Tax amount
		edNR,	// Amount of nonrefundable education credits
		testAGI	// AGI for this type
		) {
	// Returns array result
	//----------------------------------------------------------------------------------------
		var result = [];
			result.Foreign = 0;
			result.Care = 0;
			result.RefCare = 0;
			result.Ed = 0;
			result.Retire = 0;
			result.CTC = 0;
			result.ACTC = 0;
			result.NRC = 0;

		// Set amount of non-refundable credits that can be used
		switch (type) {
			case "TAX": availableNRC = TaxTax.innerHTML; break;
			case "AOC": availableNRC = TaxAOC.innerHTML; break;
			case "LLC": availableNRC = TaxLLC.innerHTML; break;
		}

		// Space for foreign tax credits
		result.Foreign = Math.min(+FTCTax.value, availableNRC);
		availableNRC -= result.Foreign;
		result.NRC += result.Foreign;
		
		// Calculate Child Care Credit
		var iCare = 0;
		switch (type) {
		case "TAX": iCare = CalculateCareCredit(+AGITax.value); break;
		case "AOC": iCare = CalculateCareCredit(+AGIAOC.innerHTML); break;
		case "LLC": iCare = CalculateCareCredit(+AGILLC.innerHTML); break;
		}
		if (TY == 2021) {
			result.RefCare = iCare;
			iCare = 0;
		}

		// Space for care credits
		result.Care = Math.min(iCare, availableNRC);
		availableNRC -= result.Care;
		result.NRC += result.Care;

		// Space for education credits
		result.Ed = Math.min(edNR, availableNRC);
		availableNRC -= result.Ed;
		result.NRC += result.Ed;

		// Calculated retirement savings credits
		var rsv = +MaxRetireTax.value;
		// See if increased AGI eliminated the credit
		rsv = _Retirement(TY, FS, testAGI, rsv, 0);

		// Space for retirement savings credit
		result.Retire = Math.min(rsv, availableNRC);
		availableNRC -= result.Retire;
		result.NRC += result.Retire;

		// Calculate CTC
		var earnedCTC = 0;
		switch (type) {
			case "TAX": earnedCTC = EarnedTax.value; break;
			case "AOC": earnedCTC = EarnedAOC.innerHTML - +ScholarAOC.innerHTML; break;
			case "LLC": earnedCTC = EarnedLLC.innerHTML - +ScholarLLC.innerHTML; break;
		}
		CTCAmount = FTCAmount = ACTCAmount = 0;
		CTCresult = _CTCLookup(TY, FS,
			+CTCDependents.value + (+Dependents0.value * 0.01),
			Dependents.value, earnedCTC, testAGI, 0);
		CTCAmount = (TY == "2021") ? 0 : +CTCresult[0] ;
		FTCAmount = +CTCresult[1];
		ACTCAmount = +CTCresult[2];

		// Current assumption is that FTC is used before CTC
		// Space for FTC
		result.FTC = Math.min(FTCAmount, availableNRC);
		availableNRC -= result.FTC;
		result.NRC += result.FTC;

		// Space for CTC
		result.CTC = Math.min(CTCAmount, availableNRC);
		availableNRC -= result.CTC;
		result.NRC += result.CTC;
		result.ACTC = (TY == "2021") ? ACTCAmount : result.ACTC = Math.max(0, Math.min((CTCAmount - result.CTC), ACTCAmount));

		// Space for Energy and Sched R amounts?
		if (type == "TAX") {
			NRval = NRCreditTax.value;
			NRCreditTax.style.backgroundColor =
				((NRval === "") || (NRval < result.NRC)) ? "pink" : "";
			ExtraNRC = Math.max(0, +NRval - result.NRC);
		}
		else {
			result.ExtraNRC = Math.min(ExtraNRC, availableNRC);
			availableNRC -= result.ExtraNRC;
			result.NRC += result.ExtraNRC;
		}

	return (result);
	}

	//----------------------------------------------------------------------------------------
	// This function attempts to bracket the optimum refund to the taxpayer
	function Optimize() {
	//----------------------------------------------------------------------------------------
		DataviewDebug = false;
		if (NRCreditCheck()) {
			Optimizing = false;
			Optimized = false;
			return;
		}
		Optimizing = true;
		GapAll.checked = true;
		ScholarTaxable.value = 0;
		BudgetChange();
		var low = 0;
		var high = (ScholarTaxableLimitYes.checked) ? +ScholarTaxableLimit.value : +ScholarTaxableMax.innerHTML;
		if (high == low) {
			Optimizing = false;
			Optimized = false;
			return;
		}
		if (DataviewDebug) {
			var Dataview = window.open("","","menubar=1, scrollbars=1, resizable=1");
			Dataview.document.writeln("<!DOCTYPE html>");
			Dataview.document.writeln("<html>");
			Dataview.document.writeln("<body>");
		}

		// Start optimizing
		var originalRefund = 0; // was MaxRefund
		var optimizedRefund = -100000;
		var optimizedTaxable = 0;
		var steps = 30;
		var stepsize = Math.min(100,Math.round((high - low) / steps));
		if (DataviewDebug) {
			Dataview.document.writeln("<table><tr><th>low</th><th>high</th><th>stepsize</th><th>refund</th><th>opt refund</th></tr>");
		}
		
		while (stepsize >= 1) {
			if (DataviewDebug) {
				Dataview.document.writeln("<tr><td>" + low + "</td><td>" + high + "</td><td>" + stepsize + "</td><td>" + MaxRefund + "</td><td>" + optimizedRefund + "</tr>");
			}

			for (var Testval = low; Testval <= high; Testval += stepsize) {
				ScholarTaxable.value = Testval; 
				BudgetChange();

				if ((stepsize == 1) && DataviewDebug) {
					Dataview.document.writeln("<tr><td>" + Testval + "</td><td></td><td></td><td>" + MaxRefund + "</td><td>" + optimizedRefund + "</td></tr>");
				}

				if (MaxRefund > optimizedRefund) {
					if (DataviewDebug) {
						Dataview.document.writeln("<tr><td>" + Testval + "</td><td></td><td></td><td>" + MaxRefund + "></td><td>" + optimizedRefund + "</td></tr>");
					}
					optimizedRefund = MaxRefund;
					optimizedTaxable = Testval;
				}
			}

			low = Math.round(Math.max(low, optimizedTaxable - (5 * stepsize)));
			high = Math.round(Math.min(optimizedTaxable + (5 * stepsize), high));
			stepsize = (stepsize > 1 && stepsize < 5) ? 1 : Math.round(stepsize/10);
			optimizedRefund = -1000000;
		}
		if (DataviewDebug) {
			Dataview.document.writeln("<tr><td>" + Testval + "</td><td></td><td></td><td>" + MaxRefund + "</td><td>" + optimizedRefund + "</td></tr>");
			Dataview.document.writeln("</table>");
		}
		ScholarTaxable.value = Math.round(optimizedTaxable);
		BudgetChange();
		Optimizing = false;
		Optimized = true;

		// Remember the optimum for later use by the plotter
		OptimizedTaxableFound = optimizedTaxable;
	}


	//----------------------------------------------------------------------------------------
	// This function clears calculations for credits for which the person is not eligible
	function ClearUneligibles() {
	//----------------------------------------------------------------------------------------
		elist = document.getElementsByClassName("AOCClass");
		for (eli = 0; eli < elist.length; eli++) {
			if (StudentAOC.innerHTML == "No") {
				elist[eli].style.backgroundColor = "#ffcccc";
				if (eli == 0) {
					ManualStateAOC.style.backgroundColor =
					ManualAOC.style.backgroundColor = "#ffcccc";
				}
				elist[eli].innerHTML = "";
			}
			else {
				elist[eli].style.backgroundColor = "#ccccff";
				if (eli == 0) {
					ManualStateAOC.style.backgroundColor =
					ManualAOC.style.backgroundColor = "#ffffff"; // white
				}
				if (elist[eli].innerHTML != "") elist[eli].innerHTML = Math.round(+elist[eli].innerHTML);
			}
		}

		elist = document.getElementsByClassName("LLCClass");
		for (eli = 0; eli < elist.length; eli++) {
			if (StudentLLC.innerHTML == "No") {
				elist[eli].style.backgroundColor = "#ffcccc";
				if (eli == 0) {
					ManualStateLLC.style.backgroundColor =
					ManualLLC.style.backgroundColor = "#ffcccc";
				}
				elist[eli].innerHTML = "";
			}
			else {
				elist[eli].style.backgroundColor = "#ccccff";
				if (eli == 0) {
					ManualStateLLC.style.backgroundColor =
					ManualLLC.style.backgroundColor = "#fff"; // white
				}
				if (elist[eli].innerHTML != "") elist[eli].innerHTML = Math.round(+elist[eli].innerHTML);
			}
		}

	}

	//----------------------------------------------------------------------------------------
	// This function calculates the tax given the AGI and filing status for AOC excel analysis
	function DataPrint() {
	//----------------------------------------------------------------------------------------
		var low = 0;
		var high = +ScholarTaxableMax.innerHTML;
		if (high == low) return;
		Dataview = window.open("","","menubar=1, scrollbars=1, resizable=1");
		Dataview.document.writeln("<table><tr>");
		Dataview.document.writeln("<td>TaxedSchol</td>");
		Dataview.document.writeln("<td>AGIAOC</td>");
		Dataview.document.writeln("<td>TaxAOC</td>");
		Dataview.document.writeln("<td>LLCAOC</td>");
		Dataview.document.writeln("<td>CTCAOC</td>");
		Dataview.document.writeln("<td>EICAOC</td>");
		Dataview.document.writeln("<td>ACTCAOC</td>");
		Dataview.document.writeln("<td>AOC</td>");
		Dataview.document.writeln("<td>LLC</td>");
		Dataview.document.writeln("</tr>");
		Optimizing = true;
		ScholarTaxable.value = 0;
		var originalRefund = MaxRefund;
		var optimizedRefund = originalRefund;
		var optimizedTaxable = 0;
		var stepsize = 10;
		//low = 7730; high = 8000; stepsize = 1; 
		for (var testval = low; testval <= high; testval += stepsize) {
			ScholarTaxable.value = testval; 
			BudgetChange();
			Dataview.document.writeln("<tr>");
			Dataview.document.writeln("<td>",testval,"</td>");
			Dataview.document.writeln("<td>",AGIAOC.innerHTML,"</td>");
			Dataview.document.writeln("<td>",TaxAOC.innerHTML,"</td>");
			Dataview.document.writeln("<td>",LLCAOC.innerHTML,"</td>");
			Dataview.document.writeln("<td>",CTCAOC.innerHTML,"</td>");
			Dataview.document.writeln("<td>",EICAOC.innerHTML,"</td>");
			Dataview.document.writeln("<td>",ACTCAOC.innerHTML,"</td>");
			Dataview.document.writeln("<td>",RefundAOC.innerHTML,"</td>");
			Dataview.document.writeln("<td>",RefundLLC.innerHTML,"</td>");
			Dataview.document.writeln("</tr>");
		}
		Dataview.document.writeln("</table>");
		Optimizing = false;
	}

	//----------------------------------------------------------------------------------------
	// This function plots the data
	function DataPlot() {
	//----------------------------------------------------------------------------------------
		// Optimize if not already done
		if (! Optimized) {
			Optimize(); // Get the optimized value
			if (!Optimized) return;
		}
		Optimizing = true; // (Optimize() turned it off)

		// Set up the plot window
		PlotLowSch = 0;
		PlotHighSch = (ScholarTaxableLimitYes.checked) ? +ScholarTaxableLimit.value : +ScholarTaxableMax.innerHTML;
		if (PlotHighSch == PlotLowSch) return;
		var testmin, testmax;
		var plotProgram = [];
		var Plotview = window.open("","","width=" + (PlotMarginL+PlotWidth+PlotMarginR) +", height=" + (PlotMarginT+PlotHeight+PlotMarginB) + ", resizable=yes");
		Plotview.document.writeln("<!DOCTYPE html>");
		Plotview.document.writeln("<html>");
		Plotview.document.writeln("<body>");

		// Create the canvas
		var PlotCenterH = PlotMarginL + PlotWidth/2;
		var PlotCenterV = PlotMarginT + PlotHeight/2;
		var canvasline ="<canvas id='canvas' width='" + (PlotMarginL+PlotWidth+PlotMarginR) + "px' height='" + (PlotMarginT+PlotHeight+PlotMarginB) + "px'>";
		Plotview.document.writeln(canvasline);
		var canvas = Plotview.document.getElementById('canvas');
		PlotCanv = canvas.getContext('2d');
	
		// Draw a boundary box
		PlotCanv.lineWidth = 3;
		PlotCanv.strokeRect(PlotMarginL, PlotMarginT, PlotWidth, PlotHeight);
		PlotCanv.font = "18pt sans-serif";
		PlotCanv.textAlign = "center";
		PlotCanv.fillText("Optimizing", PlotCenterH, PlotCenterV - 50);
		PlotCanv.lineWidth = 1;

		// Add a progress bar
		var ProgBarWidth = 600;
		var ProgBarHeight = 20;
		var PlotprogH0 = PlotCenterH - ProgBarWidth/2;
		var PlotprogV0 = PlotCenterV - ProgBarHeight/2;
		PlotCanv.fillStyle = "hotpink";
		PlotCanv.fillRect(PlotprogH0,PlotprogV0,ProgBarWidth,ProgBarHeight);

		// Initial plot parameters
		GapAll.checked = true;
		ScholarTaxable.value = 0;
		PlotMinRefund = 1000000;
		PlotMaxRefund = -1000000;

		// Get the data
		PlotCanv.fillStyle = "white";
		PlotCanv.fillRect(PlotMarginL+5, PlotCenterV-75, PlotWidth-10, 50);
		PlotCanv.fillStyle = "black";
		PlotCanv.fillText("Calculating plot data", PlotCenterH, PlotCenterV - 50);
		var optimizedRefund = MaxRefund;
		var optimizedTaxable = MaxRefundTaxable;
		var stepsize = 10;
		for (var testval = PlotLowSch; testval <= PlotHighSch; testval += stepsize) {
			ScholarTaxable.value = testval; 
			BudgetChange();

			// Add data to the matrix
			plotProgram[testval/stepsize] = testval +
				"," + AGIAOC.innerHTML +
				"," + RefundAOC.innerHTML +
				"," + RefundLLC.innerHTML;

			PlotMinRefund = Math.min(PlotMinRefund, 
					(StudentAOC.innerHTML == "Yes") ? RefundAOC.innerHTML : 1000000,
					(StudentLLC.innerHTML == "Yes") ? RefundLLC.innerHTML : 1000000 );
			PlotMaxRefund = Math.max(PlotMaxRefund,
					(StudentAOC.innerHTML == "Yes") ? RefundAOC.innerHTML : -1000000,
					(StudentLLC.innerHTML == "Yes") ? RefundLLC.innerHTML : -1000000 );
			if (PlotMaxRefund > optimizedRefund) {
				optimizedRefund = PlotMaxRefund;
				optimizedTaxable = testval;
			}

			// show the progress bar
			PlotprogLoc = ProgBarWidth * testval / PlotHighSch;
			PlotCanv.fillStyle = "lightgreen";
			PlotCanv.fillRect(PlotprogH0,PlotprogV0,PlotprogLoc,ProgBarHeight);
		}

		// Clear the progress bar
		PlotCanv.fillStyle = "white";
		PlotCanv.fillRect(PlotMarginL, PlotMarginT, PlotWidth, PlotHeight);
		PlotCanv.fillStyle = "black";
		PlotCanv.fillText("Change in refund vs taxed scholarships", PlotCenterH, PlotMarginT/2)

		// make the vertical grid
		GridDivisions = 7;
		PlotCanv.fillStyle = "black";
		var GridInt = GetGridInt(PlotMaxRefund - PlotMinRefund, GridDivisions);
		var tempval = GridInt;
		if (tempval) {
			while (PlotMaxRefund > tempval) {tempval += GridInt};
			PlotMaxRefund = tempval+1;
			while (PlotMinRefund < tempval) {tempval -= GridInt};
			PlotMinRefund = tempval;
			PlotDiffRefund = PlotMaxRefund - PlotMinRefund;
			GridDivisions = (PlotDiffRefund/GridInt) + 1;
		}
		PlotCanv.textAlign = "right";
		for (var iGrid = 0; iGrid < GridDivisions; iGrid++) {
			var iPlot = PlotMinRefund + (iGrid * GridInt);
			PlotCanv.beginPath();
			PlotCanv.strokeStyle = "#E0E0E0";
			AddPlot(PlotLowSch, iPlot, PlotHighSch, iPlot)
			var iNum = PlotMarginT + (PlotHeight * (1 - (iGrid / (GridDivisions-1))));
			PlotCanv.strokeStyle = "black";
			PlotCanv.fillText(iPlot, PlotMarginL - 8, iNum);
		}	

		// make the horizontal grid
		GridDivisions = 8;
		GridInt = GetGridInt(PlotHighSch - PlotLowSch, GridDivisions);
		tempval = GridInt;
		if (tempval) {
			while (PlotLowSch > tempval) {tempval += GridInt};
			var iGridH = tempval;
		}
		PlotCanv.textAlign = "center";
		iLegend = PlotMarginT + PlotHeight + (PlotMarginL / 4);
		iGrid = iPlot = 0;
		for (iGrid = 0; iGrid <= GridDivisions; iGrid++) {
			iPlot = PlotLowSch + (iGrid * GridInt);
			if (iPlot <= PlotHighSch) {
				PlotCanv.beginPath();
				PlotCanv.strokeStyle = "#E0E0E0";
				xLable = AddPlot(iPlot, PlotMaxRefund, iPlot, PlotMinRefund)
				PlotCanv.strokeStyle = "black";
				PlotCanv.fillText(iPlot, xLable, iLegend);
			}
		}	

		// Add the data
		var eligible = [StudentAOC.innerHTML == "Yes", StudentLLC.innerHTML == "Yes"]
		var progColor = ["blue", "orange"];
		var progCode = ["AOC", "LLC"];

		for (var progIdx = 0; progIdx < 3; progIdx++) {
			if (eligible[progIdx]) {
				// nqntExpensesLeft is the non-qualified amount that is not taxable - shift the curve
				var nqntExpensesLeft = Math.max(0, QualExpenses["AOC"] - QualExpenses[progCode[progIdx]]);
				PlotCanv.beginPath();
				PlotCanv.strokeStyle = progColor[progIdx];
				PlotCanv.fillStyle = progColor[progIdx];
				PlotCanv.fillText(Program[progIdx], PlotMarginL + 50, iLegend - 108 + (24 * progIdx));
				for (var iData = 0; iData < plotProgram.length; iData++) {
					xy = plotProgram[iData].split(",");
					x0 = "";
					y0 = (iData == 0) ? xy[progIdx + 2] : "";
					x1 = Math.max(0, xy[0] - nqntExpensesLeft);
					AddPlot(x0, y0, x1, xy[progIdx + 2]);
				}
			}
		}

		// Show the best solution
		PlotCanv.beginPath();
		PlotCanv.strokeStyle = "green";
		PlotCanv.fillStyle = "green";
		AddPlot(optimizedTaxable,PlotMaxRefund,optimizedTaxable,PlotMinRefund);
		iNum = PlotMarginL + (PlotWidth * (optimizedTaxable / PlotHighSch));
		PlotCanv.fillText(optimizedTaxable, iNum, iLegend + 24);
		PlotCanv.beginPath();
		AddPlot(PlotLowSch,optimizedRefund,PlotHighSch,optimizedRefund);
		iNum = PlotMarginT + (PlotHeight * ((PlotMaxRefund - optimizedRefund) / PlotDiffRefund));
		PlotCanv.textAlign = "right";
		PlotCanv.fillText(optimizedRefund,PlotMarginL-75,iNum);

		// Redraw the outer box and 0 point to clean up pixels
		PlotCanv.beginPath();
		PlotCanv.strokeStyle = "black";
		PlotCanv.lineWidth = 3;
		PlotCanv.strokeRect(PlotMarginL, PlotMarginT, PlotWidth, PlotHeight);
		PlotCanv.beginPath();
		AddPlot(PlotLowSch, 0.1, PlotHighSch, 0.1);

		// Close up the html
		// the html closure below needs to be broken into two parts
		Plotview.document.write("</canvas></body></ht");
		Plotview.document.write("ml>");
		
		ScholarTaxable.value = OptimizedTaxableFound;
		BudgetChange();
		Optimizing = false;
	}

	//----------------------------------------------------------------------------------------
	// This function calculates the grid intervals
	function GetGridInt(
		span,	// value range (max - min)
		count	// number of axis intervals preferred
		) {
	// returns: distance between grid lines
	//----------------------------------------------------------------------------------------
		if (span < 1) return (span); // protect against nonsense
		var interval = span/count;
		var mux = 1;
		var base = 1;
		while ((interval < span) && (interval > (base * mux))) { // 1,2,2.5,5,10,20,25,50,etc
			switch (mux) {
				case 1  : mux = 2; break;
				case 2  : mux = 2.5; break;
				case 2.5: mux = 5; break;
				case 5  : base *= 10; mux = 1; break;
			}
		}
		return (base * mux);
	}

	//----------------------------------------------------------------------------------------
	// This function adds a line to the plot
	function AddPlot(
		startSCH,	// x starting point if specified
		startRefund,	// y starting point if specified
		endSCH,		// x ending point
		endRefund	// y ending point
		) {
	//----------------------------------------------------------------------------------------
		// if not specified, begin where the previous line ended
		if ((startSCH + startRefund) != "") {
			var x0 = PlotMarginL + (PlotWidth * (+startSCH - PlotLowSch) / PlotHighSch);
			var y0 = PlotMarginT + (PlotHeight * (PlotMaxRefund - +startRefund) / PlotDiffRefund);
			PlotCanv.moveTo(x0, y0);
		}

		// plot the line
		var x1 = PlotMarginL + (PlotWidth * (+endSCH - PlotLowSch) / PlotHighSch);
		var y1 = PlotMarginT + (PlotHeight * (PlotMaxRefund - +endRefund) / PlotDiffRefund);
		PlotCanv.lineTo(x1, y1);
		PlotCanv.stroke();
		return x1;
	}

	//----------------------------------------------------------------------------------------
	// This function checks for an entry in the NonRefundable credit entry on the optimizer
	function NRCreditCheck() {
	//----------------------------------------------------------------------------------------
		if (NRCreditTax.value === "") {
			alert('Please enter a value in the taxpayer\'s "Total Nonrefundable Credits" line');
			return(1);
		}
		else if (+NRCreditTax.value > +TaxTax.innerHTML) {
			alert('"Taxpayer\'s Total Nonrefundable Credits" cannot be more than the tax amount');
			return(1);
		}
		else return(0);
	}

	//----------------------------------------------------------------------------------------
	// This function prints all the tabs for presentation to the taxpayer
	function PrintAll() {
	//----------------------------------------------------------------------------------------
		FilingDiv.style.display = "inline";
		ScholarshipDiv.style.display = "inline";
		ExpenseDiv.style.display = "inline";
		ManualDiv.style.display = "inline";
		OptimizeDiv.style.display = "inline";
		window.print();
		FilingDiv.style.display = "none";
		ScholarshipDiv.style.display = "none";
		ExpenseDiv.style.display = "none";
		ManualDiv.style.display = "none";
		OptimizeDiv.style.display = "none";

		document.getElementById(TabDiv[CurrentTab]).style.display = "inline";
	}

	//----------------------------------------------------------------------------------------
	// This function shows the example graph in the Instructions tab
	function ShowExample(
		show		// true/false
		) {
	//----------------------------------------------------------------------------------------
		exampleGraph.style.display = (show) ? "block" : "none";
		return;
	}
    </script>
</head>

<!-- *************************************************************************************************** -->
<!-- ******************************* START OF HTML ***************************************************** -->
<!-- *************************************************************************************************** -->

<body>

<div id="Header">

	<div class="calcHeader">
		<span class="appTitle">Education Benefits Calculator</span>
		<br><span id="Version"></span><script>Version.innerHTML = VERSION;</script>
	</div>

	<div class="tabSet noPrint">
		<div class="tabReal" id="InstructionsTab" onclick="ChangeTab(this.id)">Instructions</div>
		<div class="tabReal" id="InformationTab" onclick="ChangeTab(this.id)">Taxpayer<br />Information</div>
		<div class="tabReal" id="ScholarshipTab" onclick="ChangeTab(this.id)">Funding<br />Sources</div>
		<div class="tabReal" id="ExpenseTab" onclick="ChangeTab(this.id)">Expense<br />Information</div>
		<div class="tabReal" id="ManualTab" onclick="ChangeTab(this.id)">Manual<br />Comparison</div>
		<div class="tabReal" id="OptimizeTab" onclick="ChangeTab(this.id)">Optimizer</div>
	</div>

	<br />
</div>

<div id="ButtonBox" class="noPrint">
	<button onclick="window.open(window.location, '_self')">Click to clear and reset calculator</button>
	<br /><button id="Pbutton" onclick="PrintAll()">Print all tabs for taxpayer</button>
</div>

<div id="VideoBox" class="NoPrint">
	<a href="https://youtu.be/9gQJIPBQCPc" target="_blank">
		<button class="noPrint">Click for video tour (22 min)</button></a>
</div>

<div class="noPrint" id="InstructionsDiv">
	<span class="tblHeader">Instructions:</span>
	<br />
	<br />Enter basic filing information and facts about the taxpayer and student in the <b><u>Taxpayer Information</u></b> tab.
	This will help determine eligibility for the various education credit options and information needed
	for calculations in the Optimizer tab.
	<br />
	<br />If the student is receiving scholarship funds or financial help from Coverdell ESA,
	Qualified Tuition Plans (529 Plans), Early IRA distributions or Savings Bonds used for
	tuition and fees, enter the amounts in the <b><u>Funding Sources</u></b> tab.
	One input option allows you to make a part of the scholarship taxable which may increase education
	or other benefits and result in a higher refund (or lower amount owed).
	This field is also used by the Optimizer.
	If a dependent child student falls within the criteria to trigger a kiddie tax, the amount made taxable is limited
	to prevent that.
	Similarly, a dependent relative student&apos;s taxable income is limited to that which would no longer
	allow them to be a dependent.
	If the dependent has any income, enter it in the dependent&apos;s tax form in the Optimizer tab
	so that it will be taken into account for these limits.
	Note that "qualified expenses" for using a funding source tax-free
	may vary with the source and may also be different than the "qualified expenses" for tax credits
	which also differ depending on the credit type.
	Unrestricted scholarships can be used for living expenses if the student is willing to make those amounts taxable.
	<br />
	<br />Then enter education expenses in the <b><u>Expense Information</u></b> tab.
	The columns to the right will show what expenses qualify for the American Opportunity Credit
	or the Lifetime Learning credit.
	A check-mark to the left of each expense catagory indicates funds that can be used for the
	funding amounts in the Funding Sources tab (scholarship amounts used will be taxable).
	An option in the qualified expenses row, allows you to use all available funds to be spent on
	the qualified expenses (often results in no additional taxable income) or to use only the amount
	that covers expenses over that allowed for the particular credit (usually results in additional
	taxable income which may be offset by the use of the credit).
	The bottom two rows show the amounts that can be used in the taxpayer&apos;s return
	and the amount of unused scholarship funds that are taxable.
	<br />
	<br />The <b><u>Manual Comparison</u></b> tab gives instructions on how to conduct a "what if" for each
	of the education options using TaxSlayer and a place to record and compare the results.
	Because it uses TaxSlayer to do the calculations, all the taxpayer&apos;s information is used and the calculation
	is the most accurate.
	Of course, you have to adjust the taxable amount in the Funding Sources tab manually too (ugh).
	<br />
	<br />The <b><u>Optimizer</u></b> tab takes a bit more data entry and shows a detailed comparison for each option
	and its effect on various other credits. To make data entry reasonable, it must be used with
	TaxSlayer and does not account for all factors as the manual comparison does
	(that would require duplicating the entire return).
	Randomly changing the amounts in the entered fields may result in nonsensical results in the other
	columns because the fields used rely on certain TaxSlayer calculations.
	The results are the estimated amount of change to the taxpayer&apos;s refund (or tax owed) for each option
	based on the original return figures.
	<br />For years other than 2018 and 2019, the optimizer prevents activating the &quot;Kiddie Tax&quot;
	due to the complexity and interactions with the parent&apos;s tax return. In 2018, that complexity was
	alleviated by using the Trust tax rates when the Kiddie Tax threshhold was crossed, making the calculation more
	straight-forward but the change was rescinded for tax year 2020.
	2018 and 2019 may be amended to use the original method (but is OUT OF SCOPE).
	<br />
	<br />Clicking the optimize button below the results modifies the amount of scholarship amount to be made taxable,
	seeking a better result.
	<br />
	Optimizer interactions with several items have not (yet) been included - some may never be. Among these are:
	<ul>
		<li>Effect of taxable amount of Social Security due to change in income and its ripple effect with other items.</li>
		<li>Significant 1250 gain and 28% gain dividend income (doesn&apos;t account for different tax rates)</li>
		<li>QBI calculations for 199A dividends
		<li>Significant tax-free interest relative to other investment income</li>
		<li>Education deductible on Schedule C</li>
		<li>Effect of an IRA deduction due to change in income</li>
		<li>Effect of Student loan interest deduction due to change in income</li>
		<li>Education deductible on Schedule A</li>
		<li>Charitable deductions for taxpayers not itemizing</li>
		<li>Employer education assistance benefits</li>
		<li>Reduction of exemption amount for high income taxpayers</li>
		<li>Employer provided child care benefits, carryovers, prior year expenses</li>
		<li>Schedule R reduction of the education credit</li>
		<li>Income deductions on the student&apos;s return when the student is a dependent of the TP</li>
		<li>Unearned income other than that calculated here for a dependent subject to the kiddie tax</li>
		<li>Effect on state returns</li>
	</ul>
	As an example of how the optimizer works, try the following:
	<div class="example">
		<ul class="circle">
			<li>In tax year 2022, George is a 25 year old taxpayer attending
			a school half time that qualifies for the American opportunity credit.
			He and his wife Sally have one child and earned income of $24,500 for the year.</li>
			<li>George has received an unrestricted grant of $4,000, 
			used to pay for his $4,000 tuition and $500 for books.</li>
		</ul>
	</div>
	<ul>
		<li>Without optimizing, the entire grant is used to pay for the tuition, they owe no tax
		and they will receive a refundable $200 for AOC, $1500 for ACTC and $3,733 earned income credit.
		Sounds pretty good, right?</li>
		<li>But if you optimize, using $4,000 as living expenses,
		you will find that they will now have to pay a little tax by declaring $1,794 taxable, 
		but will gain an additional $828 by receiving $830 in AOC and $39 education credit, which offsets
		the resulting tax and the decrease (-$2) in the earned income credit.
		To see what&apos;s happening, <button class="noPrint" onclick="ShowExample(true)">click here</button>.</li>
		<span id="exampleGraph" class="noPrint center">
				<button onclick="ShowExample(false)">Click to close graph</button>
				<br /><img src="Images/edexample.png" width="90%" alt="Example">
		</span>
	</ul>
	After using the calculator, consider printing a copy for the taxpayer&apos;s records.
	The "Print all" button will print all but the Instructions. If you want that as well, print from this page.
	<br />
	<br /><b>About security:</b> Although you are entering a lot of taxpayer information in this calculator,
	none of that data is going to the web - it&apos;s all being calculated on your desktop, is not saved,
	and disappears when you exit the calculator.
	If you print the form, use the same care as you would if you were printing the taxpayer&apos;s return.
	<br />
	<span class="noPrint">
		<hr />Please send email to <a href="mailto:tools@cotaxaide.org">tools@cotaxaide.org</a> with suggestions/corrections
		</span>
	<p style="page-break-before: always;"> </p> </div> 
<!-- ****************************************** FILING INFORMATION TABLE ****************************************** -->
<div class="doPrint" id="FilingDiv">
	<div><table id="FItable" onchange="ChangeInfo()">
		<tr>
			<td colspan="4" class="tblHeader">Taxpayer Information:</td></tr> 
		<tr>
			<td>Taxpayer&apos;s Name:</td>
			<td colspan="3"><input id="TPName"
				title="Enter the taxpayer's name. Consider printing the results for the taxpayer's record" /></td></tr>
		<tr title="Select the tax year being prepared and the location of the taxpayer's home.">
			<td>Tax Year:</td>
			<td><select id="TaxYear" onchange="ChangeInfo(this.id);"></select></td>
			<td colspan="2"><span id="FilingIn">Filing in:
				<input name="Region" id="RegionUS" type="radio" value="US" checked="checked" />48 states&nbsp;&nbsp;
				<input name="Region" id="RegionAK" type="radio" value="AK" />Alaska&nbsp;&nbsp;
				<input name="Region" id="RegionHI" type="radio" value="HI" />Hawaii</span></td></tr>
		<tr title="Select the taxpayer's filing status.">
			<td>Filing Status:</td>
			<td><select id="FilingStatus">
				<option value="SNG">Single</option>
				<option value="MFJ" selected>MFJ</option>
				<option value="MFS">MFS</option>
				<option value="HOH">HOH</option>
				<option value="WID"><span id="TPWIDQSS">Widow(er)</span></option>
				</select>
				<br />
				<span id="MFJRefundShow"
				title="FIling MFJ only for return of withholding or estimated tax payments.">
				<input id="MFJRefund" type="checkbox" /> Only for return of WH
				</span></td>
			<td colspan="2" class="left">
				TP is: <input id="TP65" type="checkbox" title="Taxpayer is 65 or older"
					onchange="ChangeInfo(this.id)" /> 65 or older&nbsp;&nbsp;
				<input id="TPBlind" type="checkbox" title="Taxpayer is blind"/> Blind&nbsp;&nbsp;
				<input id="TPNRA" type="checkbox" title="Taxpayer is a non-resident alien for tax purposes" /> Non-res Alien
				<br />
				SP is: <input id="SP65" type="checkbox" title="Spouse is 65 or older"
					onchange="ChangeInfo(this.id)" /> 65 or older&nbsp;&nbsp;
				<input id="SPBlind" type="checkbox" title="Spouse is blind"/> Blind&nbsp;&nbsp;
				<input id="SPNRA" type="checkbox" title="Taxpayer is a non-resident alien for tax purposes" /> Non-res Alien </td></tr>
		<tr title="Number of dependents in the tax family. Do not include those you could claim but did not claim.">
			<td>Total dependents claimed:</td>
			<td><input id="Dependents" value="0" type="number" onkeyup="ChangeInfo(this.id)" /></td><td></td><td></td></tr>
		<tr title="Number of dependents who qualify for Child Tax Credit.">
		<tr title="Number of dependents who qualify for Earned Income Credit.">
			<td>Dependents qualified for EIC:</td>
			<td><input id="EICDependents" value="0" type="number" onkeyup="ChangeInfo(this.id)" /></td><td></td><td></td></tr>
		<tr title="Number of dependents who qualify for Child Tax Credit (including those under age 6).">
			<td>Dependents qualified for CTC:</td>
			<td><input id="CTCDependents" value="0" type="number" onkeyup="ChangeInfo(this.id)" /></td><td></td><td></td></tr>
		<tr id="Dependents0Row" title="Number of dependents who are under age 6 and are eligible for CTC.">
			<td>&nbsp;&nbsp;&nbsp;Dependents under age 6:</td>
			<td colspan="2"><input id="Dependents0" value="0" type="number" onkeyup="ChangeInfo(this.id)" /> (if qualified for CTC)</td><td></td></tr>
</table></div>
	<br />
	<hr />
	<div><table id="SItable" onchange="ChangeInfo(0)">
		<tr><td class="tblHeader">Student Information:</td><td></td></tr> 
		<tr><td colspan="2">(Hover the mouse over the questions for a more detailed explanation.)<br />&nbsp;</td></tr>
		<tr title="If the student is the dependent of this taxpayer, any scholarship funds not applied to qualified expenses will be the student's income. If the taxpayer or spouse is the student, those unapplied funds would be income to the taxpayer. This also affects other tax calculations used by the optimizer.">
			<td>Is the student the TP, SP or a dependent claimed by this TP?</td>
			<td>
				<input name="Dependent" id="DependentYes" type="radio" checked onclick="ChangeInfo(this.id)" /> Dependent 
				<input name="Dependent" id="DependentNo" type="radio" onclick="ChangeInfo(this.id)" /> TP or SP </td> </tr>
		<tr title="Is the TP or SP a parent of this dependent.">
			<td><span class="DependentQuestion">&nbsp;&nbsp;Is the TP or SP a parent of this dependent?</span></td>
			<td><span id="TPisParentRow" class="DependentQuestion">
				<input name="TPisParent" id="TPisParentYes" type="radio" checked /> Yes 
				<input name="TPisParent" id="TPisParentNo" type="radio" /> No</span></td></tr>
		<tr title="Was at least one of the dependent's parents alive at the end of the tax year.">
			<td><span class="NoParentQuestion">&nbsp;&nbsp;&nbsp;&nbsp;Was at least one parent alive at the end of the tax year?</span></td>
			<td><span id="ParentAlive2Row" class="NoParentQuestion">
				<input name="ParentAlive2" id="ParentAlive2Yes" type="radio" checked /> Yes 
				<input name="ParentAlive2" id="ParentAlive2No" type="radio" /> No</span></td></tr>
		<tr title="What was the student's age at the end of the tax year.">
			<td>&nbsp;&nbsp;What was the student&apos;s age at the end of the tax year?</td>
			<td>
				<input name="StudentAge" id="StudentAge16" type="radio" /> 16-
				<input name="StudentAge" id="StudentAge17" type="radio" /> 17
				<input name="StudentAge" id="StudentAge18" type="radio" /> 18 
				<input name="StudentAge" id="StudentAge19" type="radio" checked /> 19-23 
				<input name="StudentAge" id="StudentAge24" type="radio" > 24
				<input name="StudentAge" id="StudentAge25" type="radio" > 25+
				<input id="Disabled" type="checkbox" /> Disabled </td> </tr>
		<tr title="If the student files a return, what would be the the student's filing status?">
			<td><span class="DependentQuestion">&nbsp;&nbsp;What is the dependent student&apos;s filing status?</span></td>
			<td><span class="DependentQuestion">
				<select id="StudentFilingStatus" title="Select the taxpayer's filing status.">
					<option value="SNG">Single</option>
					<option value="MFJ">MFJ</option>
					<option value="MFS">MFS</option>
					<option value="WID"><span id="STWIDQSS">Widow(er)</span></option>
					</select>
					<span id="StudentMFJRefundShow"
						title="FIling MFJ only for return of withholding or estimated tax payments.">
					<input id="StudentMFJRefund" type="checkbox" checked /> Only for return of WH</span>
					<span id="StudentMFSItemizeShow"
						title="FIling MFJ only for return of withholding or estimated tax payments.">
					<input id="StudentMFSItemize" type="checkbox" /> Spouse is itemizing deductions</span>
					<br />
					Student: <input id="StudentTP65" type="checkbox" title="Student is 65 or older"/> 65 or older
					<input id="StudentTPBlind" type="checkbox" title="Student is blind"/> Blind
					<input id="StudentTPNRA" type="checkbox" title="Student is a non-resident alien for tax purposes"/> Non-res Alien
					<br />
					Spouse: <input id="StudentSP65" type="checkbox" title="Student's spouse is 65 or older"/> 65 or older
					<input id="StudentSPBlind" type="checkbox" title="Student's spouse is blind"/> Blind
					<input id="StudentSPNRA" type="checkbox" title="Student's spouse is a non-resident alien for tax purposes"/> Non-res Alien</span></td></tr>
		<tr title="Is the TP or SP claimed on another person's return. If yes, you are not qualified for education credits.">
			<td><span class="ClaimedQuestion">&nbsp;&nbsp;Is the TP or SP claimed on another person&apos;s return?</span></td>
			<td><span class="ClaimedQuestion">
				<input name="Claimed" id="ClaimedYes" type="radio" /> Yes 
				<input name="Claimed" id="ClaimedNo" type="radio" checked="checked" /> No</span></td></tr>
		<tr title="Check &quot;No&quot; if the student&apos;s earned income was one-half or more of their support. (Note: the earned income may not have been used for their support but added to savings, etc.)">
			<td><span class="AOCRefundQuestions">&nbsp;&nbsp;&nbsp;&nbsp;Was the student&apos;s earned income less than one-half of their support?</span></td>
			<td><span class="AOCRefundQuestions">
				<input name="IncomeLess" id="IncomeLessYes" type="radio" checked /> Yes 
				<input name="IncomeLess" id="IncomeLessNo" type="radio" /> No <i>(Scholarships are not considered support)</i></span></td></tr>
		<tr id="ParentAliveRow"
			title="Was at least one of the taxpayer&apos;s or spouse's parents alive at the end of the tax year.">
			<td><span class="AOCRefundQuestions">&nbsp;&nbsp;&nbsp;&nbsp;Was at least one parent alive at the end of the tax year?</span></td>
			<td><span class="AOCRefundQuestions">
				<input name="ParentAlive" id="ParentAliveYes" type="radio" checked /> Yes 
				<input name="ParentAlive" id="ParentAliveNo" type="radio" /> No</span></td></tr>
		<tr title="Enrolled in a program leading to a degree, certificate, or other recognized educational credential for a least one academic period beginning during the tax year (or the first 3 months of the next tax year if the qualified expenses were paid in this tax year).">
			<td>Is the student a degree or other credential candidate?</td>
			<td>
				<input name="Degree" id="DegreeNo" type="radio" /> No 
				<input name="Degree" id="DegreeYes" type="radio" checked /> Degree
				<input name="Degree" id="DegreeOther" type="radio" /> Other credential</td></tr>
		<tr title="Enrolled as a part-time (less than half-time), half-time, or full-time student?">
			<td>At what level of time is the student enrolled?</td>
			<td>
				<input name="Time" id="TimeFull" type="radio" checked /> Full-time
				<input name="Time" id="TimeHalf" type="radio" /> Half-time 
				<input name="Time" id="TimePart" type="radio" /> Less than half-time</td></tr>
		<tr title="The course(s) taken must be either part of a postsecondary degree program or taken by the student to acquire or improve job skills.">
			<td><span class="JobSkills">&nbsp;&nbsp;Are course(s) taken to acquire or improve job skills?</span></td>
			<td><span class="JobSkills">
				<input name="Skills" id="SkillsYes" type="radio" checked /> Yes
				<input name="Skills" id="SkillsNo" type="radio" /> No</span></td></tr>
		<tr title="Has, as of the beginning of the tax year, the student completed the first 4 years of postsecondary education, as determined by the eligible educational institutions. Do not include academic credit awarded based on proficiancy examinations.">
			<td>At the beginning of the tax year, had the student completed the first 4 years of postsecondary ed?</td>
			<td>
				<input name="FourYears" id="FourYearsYes" type="radio" /> Yes 
				<input name="FourYears" id="FourYearsNo" type="radio" checked /> No </td> </tr>
		<tr title="Has the American opportunity credit or the Hope scholarship credit already been claimed (by anyone) for this student for any 4 tax years.">
			<td>Has the student used American Opportunity Credit for 4 years?</td>
			<td>
				<input name="FourYearsAOC" id="FourYearsAOCYes" type="radio" /> Yes 
				<input name="FourYearsAOC" id="FourYearsAOCNo" type="radio" checked /> No </td> </tr>
		<tr title="As of the end of the tax year, has the student had been convicted of a felony for possessing or distributing a controlled substance">
			<td>Was the student ever convicted of a drug felony?</td>
			<td>
				<input name="Felony" id="FelonyYes" type="radio" /> Yes 
				<input name="Felony" id="FelonyNo" type="radio" checked /> No </td> </tr>
</table></div>

	<hr />

	<div id="SQdiv">
		<table id="SQtable">
			<tr>
				<td class="bold">The taxpayer is qualified for:</td>
				<td>&nbsp;&nbsp;American opportunity credit:</td>
				<td id="StudentAOC"></td></tr>
			<tr>
				<td></td>
				<td class="SQindent">- refundable part:</td>
				<td id="StudentAOCR"></td></tr>
			<tr>
				<td></td>
				<td>&nbsp;&nbsp;Lifetime learning credit:</td>
				<td id="StudentLLC"></td></tr>
		</table>

		<div id="KTdiv">
			<hr />
			<b>The student</b>
			is subject to the &quot;Kiddie Tax&quot; if the
			student&apos;s unearned income is greater than
			$<span id="KTui"></span> and the student is required to file a return
			other than to recover estimated or withheld taxes.
		</div>
	</div>

</div>

<!-- ****************************************** SCHOLARSHIP INFORMATION ***************************************** -->
<p style="page-break-before: always;"> </p>

<div class="doPrint" id="ScholarshipDiv">
	<span class="tblHeader">Funding sources:</span>
	<ul>
		<li>Enter below all sources of funds, other than personal, used to pay for education expenses .</li>
		<li>Hover over each starred source to view what expenses that each source can be spent on tax-free.</li>
		<li>Early distribution of IRA funds is considered as personal funds and not included in the calculations.
		However, a warning message is displayed if all the funds cannot be used.</li>
		<li>Savings bond amounts are not included in the calculations because they do not affect the outcome.
		However, a warning message is displayed if the bond amount exeeds the education expenses (for tuition and fees) after other sources have been used.</li>
		<li>CARES act emergency financial aid grants (which may be reported on form 1098-T) are non-taxable and may be used for nonqualified expenses like living expenses. Do not include this amount when using this calculator. Do not reduce expenses paid by these grants.</li>
		<li id="KiddieWarn">IMPORTANT: Go to the Optimizer tab and enter income information, if any, on the Student&apos;s tax return.</li>
	</ul>

	<hr />

	<table id="FStable" onchange="BudgetChange()">
		<tr>
			<td colspan="4" class="tblHeader">Scholarships:</td></tr>
			<tr title="Unrestricted grants can be used for tuition, fees, books, supplies and equipment, and if at least half-time, living expenses regardless of the qualification for any other particular tax credit.">
			<td colspan="2" >&#x2605; Unrestricted grants and scholarships that can be used for living expenses:</td>
			<td><input id="Nonrestricted" type="number" onkeyup="BudgetChange(this.id)" /></td>
			<td></td> </tr>
		<tr title="Scholarships can be used for tuition, fees, books, supplies and equipment regardless of the qualification for any other particular tax credit. Some part of the scholarship may include taxable teaching or research funds or some part may be specified for other non-taxable uses than those listed.">
			<td colspan="2">&#x2605; Other scholarships/fellowships:</td>
			<td><input id="Restricted" type="number" onkeyup="BudgetChange(this.id)" /></td>
			<td></td></tr>
		<tr title="Amount that was for teaching, research, or any other services required as a condition for receiving the scholarship.">
			<td class="FSindent">- Amount used for teaching, research, etc.  (not including
				<abbr title="National Health Service Corps Scholarship Program">NHSCSP</abbr> or
				<abbr title="Armed Forces Health Professions Scholarship and Financial Assistance Program">AFHPSFAP</abbr>):</td>
			<td><input id="ScholarTeaching" type="number" onkeyup="BudgetChange(this.id)" /></td>
			<td></td>
			<td></td></tr>
		<tr>
			<td class="FSindentw2">Was a W-2 issued for this income?</td>
			<td>
				<input id="ScholarW2Yes" name="ScholarW2" type="radio" />Yes
				<input id="ScholarW2No" name="ScholarW2" type="radio" />No<br />&nbsp; </td>
			<td></td>
			<td></td></tr>
		<tr title="Amount that you were required under the conditions of the scholarship to use for other than qualified education expenses. The expenese covered by this should not be included in the education expenses in the Expense Information tab.">
			<td class="FSindent">- Amount restricted (<u>required</u> to be spent on anything other than qualified education expenses):
			<td><input id="ScholarRestricted" type="number" onchange="BudgetChange(this.id)" /> </td>
			<td></td>
			<td></td></tr>
		<tr>
			<td class="FSindent">- Amount (up to <span id="ScholarTaxableMax"></span>) that you wish to use for nonqualified expenses for possible larger tax benefit:
				<span id="taxInfo" class="help"
					onmouseover="taxInfoText.style.display='block';"
					onmouseout="taxInfoText.style.display='none';">&nbsp;?&nbsp;
				</span>
				<span id="taxInfoText" class="helpText"
					onmouseover="taxInfoText.style.display='block';"
					onmouseout="taxInfoText.style.display='none';">
					No need to enter anything here but you can manually change this amount to see how the funds are distributed
					in the Expense Information tab. It is initially set to 0 to allow all funds to be used for qualified expenses.
					<br /><br />The Optimizer tab changes this amount as it seeks the best amount to be taxable based on
					interactions with other tax benefits.  You may limit the amount tested if you wish to do so in the next entry...
				</span>
			</td>
			<td><input id="ScholarTaxable" type="number" onchange="BudgetChange(this.id)"
				title="Amount that you wish to make taxable and thus increase income.
This may increase the education benefits and overall tax results, depending on the TP's situation.
The optimizer adjusts this field also if it is run." /></td> </tr>
		<tr title="Amount to limit the taxable amount using the optimizer">
			<td colspan="3" class="FSindent">- - -<input id="ScholarTaxableLimitYes" type="checkbox" />
				Limit the taxable amount tested by the optimizer tab to:
				<input id="ScholarTaxableLimit" type="number" /></td></tr>
		<tr title="Amount available for qualified education expenses.">
			<td colspan="2">Amount available tax-free for education expenses:</td>
			<td><span class="CalculatedEntry" id="ScholarTaxFree"></span></td></tr>
		<tr><td colspan="3" class="tblHeader"><br />Supplemental Funding:</td></tr>
		<tr title="Distribution from Coverdell ESA's can be used for tuition, fees, books, supplies and equipment, special needs services, room & board if at least a half-time student, but investment interest on unused funds is taxable. It can also be used for K-12 expenses, but not considered in this tool.">
			<td>&#x2605; Distributions from Coverdell Education Savings Accounts (ESA):</td>
			<td></td>
			<td><input id="ScholarESA" type="number" /></td></tr>
		<tr title="Distribution from Qualified Tuition Programs (QTP/529 plans) can be used for tuition, fees, books, supplies and equipment, special needs services, room & board if at least a half-time student, but investment interest on unused funds is taxable.">
			<td>&#x2605; Distributions from Qualified Tuition Plans (529 plans):</td>
			<td></td>
			<td><input id="ScholarQTP" type="number" /></td></tr>
		<tr title="Early distribution from IRAs can be used for tuition, fees, books, supplies and equipment, special needs services, room & board if at least a half-time student, but an early distribution penalty is applied to unused funds.">
			<td>&#x2605; Early distributions from IRAs (for education, with no early distribution penalty):</td>
			<td><input id="ScholarIRA" type="number" /></td>
			<td></td></tr>
		<tr title="Distribution from Savings bonds can be used for tuition and fees after all other tax-free funds have been expended, and any interest on unused funds is taxable.">
			<td>&#x2605; Savings bonds used for tuition and required enrollment fees (with tax-free interest):</td>
			<td><input id="ScholarSAV" type="number" /></td>
			<td></td>
			<td></td></tr>
		<tr><td colspan="3"><hr /></td></tr>
		<tr>
			<td class="bold">Amount of non-personal funds to be allocated to education expenses:</td>
			<td></td>
			<td id="ScholarAvailableTotal" class="CalculatedEntry"></td> </tr>
	</table>
	<br />
	<span id="ScholarshipTaxableMsg" class="warning">The entire scholarship is taxable because the student is not a degree/certification candidate.</span>
	<br />
	<span id="SupplementalTaxable" class="warning">Coverdell ESA and 529 Plan funds are taxable with additional 10% penalty because the student is not at least a half-time degree/certification candidate.</span>
</div>

<!-- ****************************************** EDUCATION EXPENSES ****************************************** -->
<p style="page-break-before: always;"> </p>

<div class="doPrint" id="ExpenseDiv">
	<span class="tblHeader">Education Expenses:</span>
	<ul>
		<li>Enter expenses as you wish to claim them below, regardless of how the institution granting a scholarship
	  actually used the funds.</li>
		<li>Do not include the part of the scholarship that was required to be used for non-qualifed education expenses nor the expenses covered by those funds.</li>
		<li>Tax credits are based on qualified education expenses payed for the taxpayer, spouse, or a dependent who is claimed as an exemption on the tax return.</li>
		<li>The credit is allowed for qualified education expenses paid in the current tax year for an academic period beginning in that year or in the first 3 months of the following year.</li>
		<li>Include any required computer and internet expenses in the required supplies and equipment fees category. If not required, include it in living expenses.</li>
		<li>Funding amounts in excess of allowed expenses for that type of funding (check marks below) is taxable income to the student.</li>
		<li>If the funds available exceed the limit for the tax credit, it may be advantageous to only use the amount of funds to "cover the difference" and allow the rest to be taxable and thus qualify for the tax credit.</li>
	</ul>

	<hr />

	<span id="ExpenseAllowedFlag">&nbsp;&#x2714;&nbsp;<i>Check marks indicate expenses allowed for scholarships or other funds.</i></span>
	<table id="EItable" onchange="BudgetChange()">
		<tr>	<td><center><b>&darr;</b></center></td>
			<td><i>Check the box if the scholarship or other funds <u>can</u> be used to pay for the expenses:</i></td></tr>
		<tr>
			<th></th>
			<th>Expense category</th>
			<th>Amount</th>
			<th>American Opportunity</th>
			<th>Lifetime Learning</th></tr>
		<tr>
			<td><span id="TuitionAllowed"></span></td>
			<td>Tuition:</td>
			<td><input id="Tuition" type="number" /></td>
			<td class="AOCClass" id="TuitionAOC"></td>
			<td class="LLCClass" id="TuitionLLC"></td>
			<td class="SCHClass" id="TuitionSCH"></td></tr>
		<tr>
			<td><span id="FeesAllowed"></span></td>
			<td>Student activity fees if required for enrollment:</td>
			<td><input id="Fees" type="number" /></td>
			<td class="AOCClass" id="FeesAOC"></td>
			<td class="LLCClass" id="FeesLLC"></td>
			<td class="SCHClass" id="FeesSCH"></td></tr>
		<tr title="Amounts required to be paid to the institution for course-related books.">
			<td><span id="InstBooksAllowed"></span></td>
			<td>Required books which must be purchased from the institution:</td>
			<td><input id="InstBooks" type="number" /></td>
			<td class="AOCClass" id="InstBooksAOC"></td>
			<td class="LLCClass" id="InstBooksLLC"></td>
			<td class="SCHClass" id="InstBooksSCH"></td></tr>
		<tr>
			<td><span id="SecondBooksAllowed"></span></td>
			<td>Required books purchased from a bookstore or second hand:</td>
			<td><input id="SecondBooks" type="number" /></td>
			<td class="AOCClass" id="SecondBooksAOC"></td>
			<td class="LLCClass" id="SecondBooksLLC"></td>
			<td class="SCHClass" id="SecondBooksSCH"></td></tr>
		<tr title="amounts required to be paid to the institution for course-related supplies, and equipment">
			<td><span id="SuppliesAllowed"></span></td>
			<td>Required supplies and equipment fees which must paid to the institution:</td>
			<td><input id="Supplies" type="number" /></td>
			<td class="AOCClass" id="SuppliesAOC"></td>
			<td class="LLCClass" id="SuppliesLLC"></td>
			<td class="SCHClass" id="SuppliesSCH"></td></tr>
		<tr>
			<td><span id="OtherStuffAllowed"></span></td>
			<td>Required supplies and equipment fees NOT paid to the institution:</td>
			<td><input id="OtherStuff" type="number" /></td>
			<td class="AOCClass" id="OtherStuffAOC"></td>
			<td class="LLCClass" id="OtherStuffLLC"></td>
			<td class="SCHClass" id="OtherStuffSCH"></td></tr>
		<tr>
			<td><input id="LivingOption" type="checkbox" /><span id="LivingAllowed"></span></td>
			<td>Living Expenses:</td>
			<td><input id="Living" type="number" /></td>
			<td class="AOCClass" id="LivingAOC"></td>
			<td class="LLCClass" id="LivingLLC"></td>
			<td class="SCHClass" id="LivingSCH"></td></tr>
		<tr>
			<td><input id="InsuranceOption" type="checkbox" /><span id="InsuranceAllowed"></span></td>
			<td>Insurance or student health fees:</td>
			<td><input id="Insurance" type="number" /></td>
			<td class="AOCClass" id="InsuranceAOC"></td>
			<td class="LLCClass" id="InsuranceLLC"></td>
			<td class="SCHClass" id="InsuranceSCH"></td></tr>
		<tr>
			<td><input id="ServicesOption" type="checkbox" /><span id="ServicesAllowed"></span></td>
			<td>Expenses for special needs services:</td>
			<td><input id="Services" type="number" /></td>
			<td class="AOCClass" id="ServicesAOC"></td>
			<td class="LLCClass" id="ServicesLLC"></td>
			<td class="SCHClass" id="ServicesSCH"></td></tr>
		<tr>
			<td><input id="TransportOption" type="checkbox" /><span id="TransportAllowed"></span></td>
			<td>Transportation or parking fees:</td>
			<td><input id="Transport" type="number" /></td>
			<td class="AOCClass" id="TransportAOC"></td>
			<td class="LLCClass" id="TransportLLC"></td>
			<td class="SCHClass" id="TransportSCH"></td></tr>
		<tr>
			<td><input id="SportsOption" type="checkbox" /><span id="SportsAllowed"></span></td>
			<td>Sports:</td>
			<td><input id="Sports" type="number" /></td>
			<td class="AOCClass" id="SportsAOC"></td>
			<td class="LLCClass" id="SportsLLC"></td>
			<td class="SCHClass" id="SportsSCH"></td></tr>
		<tr>
			<td><input id="NonCreditOption" type="checkbox" /><span id="NonCreditAllowed"></span></td>
			<td>Games, hobbies, non-credit courses:</td>
			<td><input id="NonCredit" type="number" /></td>
			<td class="AOCClass" id="NonCreditAOC"></td>
			<td class="LLCClass" id="NonCreditLLC"></td>
			<td class="SCHClass" id="NonCreditSCH"></td></tr>
		<tr>
			<td><input id="ClericalOption" type="checkbox" /><span id="ClericalAllowed"></span></td>
			<td>Clerical or research fees or expenses:</td>
			<td><input id="Clerical" type="number" /></td>
			<td class="AOCClass" id="ClericalAOC"></td>
			<td class="LLCClass" id="ClericalLLC"></td>
			<td class="SCHClass" id="ClericalSCH"></td></tr>

		<tr><td colspan="7"><hr /></td></tr>

		<tr>
			<td></td>
			<td>Total education expenses not allowed for the credit:</td>
			<td id="NQTotal"></td>
			<td class="AOCClass nqexpense" id="NQTotalAOC"></td>
			<td class="LLCClass nqexpense" id="NQTotalLLC"></td></tr>
		<tr>
			<td></td>
			<td>Nonqualified education expenses that are not taxable:</td>
			<td id="NQAvail"></td>
			<td class="AOCClass nqexpense" id="NQNTAOC"></td>
			<td class="LLCClass nqexpense" id="NQNTLLC"></td></tr>
		<tr>
			<td></td>
			<td>Funds that can be used for nonqualified expenses:</td>
			<td id="NQAvail"></td>
			<td class="AOCClass nqexpense" id="NQAvailAOC"></td>
			<td class="LLCClass nqexpense" id="NQAvailLLC"></td></tr>
		<tr>
			<td></td>
			<td>Amount from funds used:</td>
			<td id="NQUsed"></td>
			<td class="AOCClass" id="NQUsedAOC"></td>
			<td class="LLCClass" id="NQUsedLLC"></td></tr>

		<tr><td colspan="7"><hr /></td></tr>

		<tr>
			<td></td>
			<td>Total education expenses allowed for the credit:</td>
			<td id="Expenses"></td>
			<td class="AOCClass qexpense" id="ExpensesAOC"></td>
			<td class="LLCClass qexpense" id="ExpensesLLC"></td></tr>
		<tr>
			<td></td>
			<td colspan="2" onchange="ClearScholarTaxable();">Amount from funds used: 
				(<input type="radio" name="Gap" id="GapAll" checked />Use all funds 
				<input type="radio" name="Gap" id="GapGap" />Maximize expenses)
				<span id="gapInfo" class="help"
					onmouseover="gapInfoText.style.display='block';"
					onmouseout="gapInfoText.style.display='none';">&nbsp;?&nbsp;
				</span>
				<span id="gapInfoText" class="helpText"
					onmouseover="gapInfoText.style.display='block';"
					onmouseout="gapInfoText.style.display='none';">
					<u>Use all</u> allocates all scholarship(s) available,
					after any designated as taxable in the funding sources tab,
					to qualified expenses before diverting allowed amounts to nonqualified expenses.
					The optimizer uses this option as it cycles through taxable amounts.
					<br /><br /><u>Maximize expenses</u>
					is a single test case that diverts allowed amounts to nonqualified
					expenses in an amount to bring qualified expenses up to that allowed by law
					before allocating the remainder to qualified expenses. Due to interactions with
					other tax benefits, this may not be the best solution but often is.
				</span>
				</td>
			<td class="AOCClass" id="QUsedAOC"></td>
			<td class="LLCClass" id="QUsedLLC"></td></tr>

		<tr><td colspan="7"><hr /></td></tr>

		<tr>
			<td></td>
			<td>Maximum qualified expenses allowed for the credit by tax law:</td>
			<td id="Max"></td>
			<td class="AOCClass" id="MaxAOC"></td>
			<td class="LLCClass" id="MaxLLC"></td></tr>
		<tr>
			<td></td>
			<td>Amount used for IRS qualified expenses but not allowed for credit:
			<span id="ntnqInfo" class="help"
					onmouseover="ntnqInfoText.style.display='block';"
					onmouseout="ntnqInfoText.style.display='none';">&nbsp;?&nbsp;
				</span>
				<span id="ntnqInfoText" class="helpText"
					onmouseover="ntnqInfoText.style.display='block';"
					onmouseout="ntnqInfoText.style.display='none';">
					Although not allowed for a benefit, some items may still
					be an IRS qualifed expense that can be paid without being taxed.
				</span>
			</td>
			<td></td>
			<td class="AOCClass" id="NontaxableAOC">0</td>
			<td class="LLCClass" id="NontaxableLLC">0</td></tr>
		<tr>
			<td></td>
			<td class="bold">Amount of education expenses for TP&apos;s tax return:</td>
			<td></td>
			<td class="AOCClass" id="QualExpensesAOC"></td>
			<td class="LLCClass" id="QualExpensesLLC"></td></tr>
		<tr>
			<td></td>
			<td class="bold">Additional taxable income for the student:</td>
			<td></td>
			<td class="AOCClass" id="IncomeAOC"></td>
			<td class="LLCClass" id="IncomeLLC"></td></tr>

		<tr><td colspan="7"><hr /></td></tr>
	
	</table>
	
	<span class="warning" id="ExpensesWarning">&nbsp;</span>

<br />

	<div class="noPrint">
		<span class="tblHeader">Is it worth trying to use the Optimizer tab?</span>
		<ul>
		<span id="messagePerhaps">Perhaps.</span>
		<span id="messageDependent">If the dependent student had any other income,
			you must use the Optimizer tab to enter that income to avoid any possible kiddie tax.</span>
		<span id="messageAllMaxedOut">Because expenses exceed scholarships,
			there is no point in optimizing however,
			you can still use the optimizer to view the tax return details</span>
		<span id="messageNoUnqualified">Because there are no unqualified expenses,
			there is no point in optimizing however,
			you can still use the optimizer to view the tax return details</span>
		<span id="messageNoScholar">Although there are no scholarships that can be diverted to certain nonqualified expenses,
			you can still use the optimizer to view the tax return details</span>
		<span id="messageAOCMaxedOut">Expenses exceed scholarships by more than the limit
			for American Opportunity Credit.
			There is no point in optimizing if that is your best choice.</span>
		<span id="messageLLCMaxedOut">Expenses exceed scholarships by more than the limit
			for Lifetime Learning Credit.
			There is no point in optimizing if that is your best choice.</span>
		<span id="messageOver65">Because one or both of the taxpayers is over age 65,
			the results of the optimizer may not be exact if there are interactions with
			untaxed social security benefits.</span>
		</ul>
	</div>
</div>

<p style="page-break-before: always;"> </p>

<!-- ****************************************** MANUAL WORKSHEET ****************************************** -->

<div class="doPrint" id="ManualDiv">
	<span class="tblHeader">Education Option Worksheet 1 - manual comparison</span>

	<div class="noPrint">
		<br />This worksheet provides a place for comparing the various education options.
		<br />You can also use the Optimizer tab's Worksheet although it has limitations.
		<br />
		<br />
		Education credits are entered in TaxSlayer at: Federal Section &gt; Deductions &gt; Credits Menu &gt; Education Credits (Form 1098-T)
		<br />
		Taxable scholarships are entered in TaxSlayer at: Federal Section &gt; Income &gt; Other Income &gt; Other Compensation &gt; Scholarships and Grants
		<ol>
			<li>Check the taxpayer&apos;s AGI against the credit limit table below to see for which, if any, the taxpayer qualifies.</li>
			<li>Enter the current Refund Monitor amounts in the Tax return amount column (prior to these education expenses).</li>
			<li>For each education option, enter the amounts into TaxSlayer, record the Refund Monitor amounts.</li>
		</ol>
		<ul>
			<li>For the American opportunity credit:
			<ul>
				<li>Use qualified expenses of <span id="ManualQETextAOC">0</span> for TP's tax return.</li>
				<span class="liClaimedQuestion">and enter the Additional taxable income of
					<span id="liClaimedQuestionAOC">0</span>.</span>
				<li>record the Refund Monitor amount and remove the above entries.</li>
			</ul></li>

			<li>For the Lifetime Learning credit:
			<ul>
				<li>Use qualified expenses of <span id="ManualQETextLLC">0</span> for TP's tax return.</li>
				<span class="liClaimedQuestion">enter the Additional taxable income of
					<span id="liClaimedQuestionLLC">0</span>.</span>
				<li>record the Refund Monitor amount and remove the above entries.</li>
			</ul></li>
		</ul>
	<hr />
	</div>

	<table id="MCtable" onchange="ManualChange()">
		<tr>
			<th></th>
			<th>Tax return amount</th>
			<th>American Opportunity</th>
			<th>Lifetime Learning</th></tr>
		<tr>
			<td>TaxSlayer Federal Refund:</td>
			<td><input id="ManualTax" type="number" /></td>
			<td><input id="ManualAOC" type="number" /></td>
			<td><input id="ManualLLC" type="number" /></td>
		<tr>
			<td>TaxSlayer State Refund:</td>
			<td><input id="ManualStateTax" type="number" /></td>
			<td><input id="ManualStateAOC" type="number" /></td>
			<td><input id="ManualStateLLC" type="number" /></td></tr>

		<tr><td colspan="5"><hr /></td></tr>

		<tr>
			<td>Change in total refund amount:</td>
			<td id="ManualDiffTax"></td>
			<td id="ManualDiffAOC"></td>
			<td id="ManualDiffLLC"></td></tr>
		<tr>
			<td></td>
			<td colspan="4">Choose the green option, or choose none if the original amount is green.</td></tr>
	</table>

	<hr />

	<div id="AGIdiv" class="center">
		<span class="bold center">Benefit limits</span>

		<hr />

		<table id="AGItable">
			<tr class="ul">
				<th>Benefit</th>
				<th colspan="3">AGI Range</th>
				<th>Amount</th></tr>
			<tr><td colspan="5"><hr /></td></tr>
			<tr>
				<td>American opportunity credit</td>
				<td>0</td>
				<td>&nbsp;-&nbsp;</td>
				<td id="LimitTableAOC1b"></td>
				<td>4,000</td></tr>
			<tr>
				<td></td>
				<td id="LimitTableAOC2a"></td>
				<td>&nbsp;-&nbsp;</td>
				<td id="LimitTableAOC2b"></td>
				<td>decreases&nbsp;to&nbsp;0</td></tr>
			<tr>
				<td></td>
				<td id="LimitTableAOC3a"></td>
				<td>&nbsp;-&nbsp;</td>
				<td></td>
				<td>0</td></tr>
			<tr><td colspan="5"><hr /></td></tr>
			<tr>
				<td>Lifetime learning credit</td>
				<td>0</td>
				<td>&nbsp;-&nbsp;</td>
				<td id="LimitTableLLC1b"></td>
				<td>10,000</td></tr>
			<tr>
				<td></td>
				<td id="LimitTableLLC2a"></td>
				<td>&nbsp;-&nbsp;</td>
				<td id="LimitTableLLC2b"></td>
				<td>decreases&nbsp;to&nbsp;0</td></tr>
			<tr>
				<td></td>
				<td id="LimitTableLLC3a"></td>
				<td>&nbsp;-&nbsp;</td>
				<td></td>
				<td>0</td></tr>
			<tr><td colspan="5"><hr /></td></tr>
			<tr>
				<td>Earned income tax credit</td>
				<td>0</td>
				<td>&nbsp;-&nbsp;</td>
				<td id="LimitTableEIC1b"></td>
				<td>increases&nbsp;to&nbsp;<span id="LimitTableEIC1c"></span></td></tr>
			<tr>
				<td></td>
				<td id="LimitTableEIC2a">?</td>
				<td>&nbsp;-&nbsp;</td>
				<td id="LimitTableEIC2b">?</td>
				<td id="LimitTableEIC2c">?</td></tr>
			<tr>
				<td></td>
				<td id="LimitTableEIC3a">?</td>
				<td>&nbsp;-&nbsp;</td>
				<td id="LimitTableEIC3b">?</td>
				<td>decreases&nbsp;to&nbsp;0</td></tr>
			<tr>
				<td></td>
				<td id="LimitTableEIC4a">?</td>
				<td>&nbsp;-&nbsp;</td>
				<td></td>
				<td>0</td></tr>
		</table>
	</div>
</div>

<!-- ****************************************** OPTIMIZATION WORKSHEET ****************************************** -->
<p style="page-break-before: always;"> </p>

<div class="doPrint" id="OptimizeDiv">
	<span class="tblHeader">Education Option Worksheet 2 - calculated comparison</span>

	<br />

	<div class="noPrint">
	NOTE: <span class="note">
	This worksheet must be used in conjunction with TaxSlayer because it relies on TaxSlayer to do many of the calculations.
	Simply adjusting input numbers at random will produce nonsensical results.
	This worksheet will not give reliable results if the taxpayer has any of the items listed in the Instruction tab.
	<br />
	Education credits are entered in TaxSlayer at: Federal Section &gt; Deductions &gt; Credits Menu &gt; Education Credits (Form 1098-T)
	<br />
	Taxable scholarships are entered in TaxSlayer at: Federal Section &gt; Income &gt; Other Compensation &gt; Scholarships and Grants
	</span>
	<ul>
		<li>Complete the taxpayer&apos;s tax return except for the education credits.</li>
		<li>Enter the information from the taxpayer&apos;s tax return below.</li>
		<li>If the student is a dependent:</li>
			<ul>
				<li>Begin a tax return for the student if they have any income.</li>
				<li>Enter data from their tax return in the student&apos;s section below.
					Do not include scholarships or grants as income &ndash; that will be calculated.
				</li>
			</ul>
		<li>Estimated values for each option will then be shown in the columns on the right.</li>
		<li>Finally, click the optimize button at the bottom to see if taxing part of the scholarship gives better results.</li>
		<li>Add the scholarship information into the tax returns.</li>
		<li>For additional students, change all taxpayer entries to reflect inclusion of previous students&apos; education choice(s)
			and repeat the above process.</li>
	</ul>
	</div>

	<div id="TPTaxFormDiv">
		<hr /><div class="TaxReturnHeader">Taxpayer&apos;s return:</div>
	<table id="TPTaxForm" onchange="BudgetChange()">
		<tr>
			<th>Tax return field</th>
			<th>Form and line<br />number</th>
			<th>Tax return<br />amount</th>
			<th>American<br />Opportunity</th>
			<th>Lifetime<br />Learning</th></tr>
		<tr id="TPScholarIncome">
			<td>Calculated scholarship income</td>
			<td>TS Schol &amp; Grants</td>
			<td></td>
			<td class="AOCClass" id="ScholarAOC"> </td>
			<td class="LLCClass" id="ScholarLLC"> </td></tr>
		<tr id="SalaryRow">
			<td>Wages, Salary and Tips</td>
			<td>1040 line <span id="SalaryLineNoA">7</span></td>
			<td><input class="taxreturn" id="SalaryTax" type="number" /></td>
			<td class="AOCClass" id="SalaryAOC"> </td>
			<td class="LLCClass" id="SalaryLLC"> </td></tr>
		<tr id="BusinessRow">
			<td>Business Income</td>
			<td>1040 line <span id="BusinessLineNoA">12</span></td>
			<td><input class="taxreturn" id="BusinessTax" type="number" /></td>
			<td class="AOCClass" id="BusinessAOC"> </td>
			<td class="LLCClass" id="BusinessLLC"> </td></tr>
		<tr id="SEHIRow">
			<td>Self employed health insurance</td>
			<td>1040 line <span id="SEHILineNoA">??</span></td>
			<td><input class="taxreturn" id="SEHITax" type="number" /></td>
			<td class="AOCClass" id="SEHIAOC"> </td>
			<td class="LLCClass" id="SEHILLC"> </td></tr>
		<tr id="EarnedRow">
			<td>Earned Income</td>
			<td>1040 lines <span id="EarnedLineNoA">7+12</span></td>
			<td><input class="taxreturn" id="EarnedTax" type="number" /></td>
			<td class="AOCClass" id="EarnedAOC"> </td>
			<td class="LLCClass" id="EarnedLLC"> </td></tr>
		<tr>
			<td>AGI</td>
			<td>1040 line <span id="AGILineNoA">7</span></td>
			<td><input class="taxreturn" id="AGITax" type="number" /></td>
			<td class="AOCClass" id="AGIAOC"></td>
			<td class="LLCClass" id="AGILLC"></td></tr>
		<tr>
			<td>Unreimbursed medical expenses <span id="MedicalSpouse">(<input type="checkbox" id="Medical65" /> SP 65+)</span></td>
			<td>Sched A line 1</td>
			<td><input class="taxreturn" id="MedicalTax" type="number" /></td>
			<td class="AOCClass" id="MedicalAOC"></td>
			<td class="LLCClass" id="MedicalLLC"></td></tr>
		<tr>
			<td>Itemized deduction amount (used or not)</td>
			<td>Sched A line <span id="ItemDedLineNoA">29</span></td>
			<td><input class="taxreturn" id="ItemizedTax" type="number" /></td>
			<td class="AOCClass" id="ItemizedAOC"></td>
			<td class="LLCClass" id="ItemizedLLC"></td></tr>
		<tr>
			<td>Qual Div &amp; Cap Gn Wkt pg 1 line <span id="CapGainsLineNoA">??</span></td>
			<td>QD&amp;CG Wkt line <span id="CapGainsLineNoB">??</span></td>
			<td><input class="taxreturn" id="CapGainsTax" type="number" /></td>
			<td class="AOCClass" id="CapGainsAOC"></td>
			<td class="LLCClass" id="CapGainsLLC"></td></tr>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;Deduction amount</td>
			<td>1040 line <span id="DeductionsLineNoB">40</span></td>
			<td class="calculatedEntry" id="DeductionTax"></td>
			<td class="AOCClass" id="DeductionAOC"></td>
			<td class="LLCClass" id="DeductionLLC"></td></tr>
		<tr id="QBIRow">
			<td>QBI deduction amount</td>
			<td>1040 line <span id="QBILineNoA">??</span></td>
			<td class="calculatedEntry" id="QBITax"></td>
			<td class="AOCClass" id="QBIAOC"></td>
			<td class="LLCClass" id="QBILLC"></td></tr>
		<tr>
			<td class="bold">Tax amount:</td>
			<td>1040 line <span id="TaxAmountLineNoB">44</span></td>
			<td class="calculatedEntry" id="TaxTax"></td>
			<td class="AOCClass" id="TaxAOC"></td>
			<td class="LLCClass" id="TaxLLC"></td></tr>
		<tr>
			<td>Form 8962 line <span id="F8962ALineNoA">10A</span>
				(<select id="ACAMonths" onchange="BudgetChange(this.id)">
					<option>12</option>
					<option>11</option>
					<option>10</option>
					<option>9</option>
					<option>8</option>
					<option>7</option>
					<option>6</option>
					<option>5</option>
					<option>4</option>
					<option>3</option>
					<option>2</option>
					<option>1</option>
				</select> months)</td>
			<td>8962 line <span id="F8962ALineNoB">??</span></td>
			<td><input class="taxreturn" id="F8962ATax" type="number" /></td>
			<td class="AOCClass" id="F8962AAOC"></td>
			<td class="LLCClass" id="F8962ALLC"></td></tr>
		<tr>
			<td>Form 8962 line <span id="F8962BLineNoA">10B</span></td>
			<td>8962 line <span id="F8962BLineNoB">??</span></td>
			<td><input class="taxreturn" id="F8962BTax" type="number" /></td>
			<td class="AOCClass" id="F8962BAOC"></td>
			<td class="LLCClass" id="F8962BLLC"></td></tr>
		<tr>
			<td>Form 8962 line <span id="F8962FLineNoA">10F</span></td>
			<td>8962 line <span id="F8962FLineNoB">??</span></td>
			<td><input class="taxreturn" id="F8962FTax" type="number" /></td>
			<td class="AOCClass" id="F8962FAOC"></td>
			<td class="LLCClass" id="F8962FLLC"></td></tr>
<!--
		<tr>
			<td>Form 8962 Household MAGI</td>
			<td>8962 line <span id="F8962MAGILineNoB">??</span></td>
			<td><input class="taxreturn" id="F8962MAGITax" type="number" /></td>
			<td class="AOCClass" id="F8962MAGIAOC"></td>
			<td class="LLCClass" id="F8962MAGILLC"></td></tr>
-->
		<tr>
			<td>Excess advance premium tax credit repayment</td>
			<td>1040 line <span id="ExcessAPTCLineNoB">??</span></td>
			<td class="calculatedEntry" id="ExcessAPTCTax"></td>
			<td class="AOCClass" id="ExcessAPTCAOC"></td>
			<td class="LLCClass" id="ExcessAPTCLLC"></td></tr>
		<tr>
			<td><b>Nonrefundable credits:</b>
			<td></td>
			<td></td>
			<td class="AOCClass"></td>
			<td class="LLCClass"></td></tr>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;Actual foreign tax paid</td>
			<td>1116 top</td>
			<td><input class="taxreturn" id="FTCTax" type="number" /></td>
			<td class="AOCClass" id="FTCAOC"></td>
			<td class="LLCClass" id="FTCLLC"></td></tr>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Foreign tax credit</td>
			<td>TS Foreign Tax Credit</td>
			<td class="calculatedEntry taxreturn" id="ForeignTax"></td>
			<td class="AOCClass" id="ForeignAOC"></td>
			<td class="LLCClass" id="ForeignLLC"></td></tr>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;Allowed child and dependent care expenses</td>
			<td>2441 line &nbsp;6</td>
			<td><input class="taxreturn" id="AllowedCareTax" type="number" /></td>
			<td class="AOCClass" id="AllowedCareAOC"></td>
			<td class="LLCClass" id="AllowedCareLLC"></td></tr>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Credit for child and dependent care expenses</td>
			<td>1040 line <span id="CareLineNoB">??</span></td>
			<td class="calculatedEntry" id="CareTax"></td>
			<td class="AOCClass" id="CareAOC"></td>
			<td class="LLCClass" id="CareLLC"></td></tr>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;Education credits</td>
			<td>1040 line <span id="LLCLineNoB">??</span></td>
			<td><input class="taxreturn" id="LLCTax" type="number" /></td>
			<td class="AOCClass" id="LLCAOC"></td>
			<td class="LLCClass" id="LLCLLC"></td></tr>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;Allowed retirement saving contribution</td>
			<td>8880 line 10</td>
			<td><input class="taxreturn" id="MaxRetireTax" type="number" /></td>
			<td class="AOCClass" id="MaxRetireAOC"></td>
			<td class="LLCClass" id="MaxRetireLLC"></td></tr>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Retirement saving contribution credit</td>
			<td>1040 line <span id="RetireLineNoB">??</span></td>
			<td class="calculatedEntry" id="RetireTax"></td>
			<td class="AOCClass" id="RetireAOC"></td>
			<td class="LLCClass" id="RetireLLC"></td></tr>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;Child and other dependents</span> Tax Credit</td>
			<td>1040 line <span id="CTCLineNoB">??</span></td>
			<td class="calculatedEntry" id="CTCTax"></td>
			<td class="AOCClass" id="CTCAOC"></td>
			<td class="LLCClass" id="CTCLLC"></td></tr>
		<tr>
			<td>Total Nonrefundable Credits</td>
			<td>1040 line <span id="NRCreditLineNoB">??</span></td>
			<td><input class="taxreturn" id="NRCreditTax" type="number" /></td>
			<td class="AOCClass" id="NRCreditAOC"></td>
			<td class="LLCClass" id="NRCreditLLC"></td></tr>
<!--
		<tr>
			<td>Health care: Individual responsibility</td>
			<td>1040 line <span id="IRPLineNoB">??</span></td>
			<td><input class="taxreturn" id="IRPTax" disabled type="number" /></td>
			<td class="AOCClass" id="IRPAOC"></td>
			<td class="LLCClass" id="IRPLLC"></td></tr>
-->
		<tr>
			<td><b>Refundable credits:</b>
			<td></td>
			<td></td>
			<td class="AOCClass"></td>
			<td class="LLCClass"></td></tr>
		<tr>
			<td>Earned income credit (check "No" if not qualfied
				<span id="EICInfo" class="help"
					onmouseover="EICInfoText.style.display='block';"
					onmouseout="EICInfoText.style.display='none';">&nbsp;?&nbsp;
				</span>)
				<span id="EICInfoText" class="helpText"
					onmouseover="EICInfoText.style.display='block';"
					onmouseout="EICInfoText.style.display='none';">
					Not qualified if any of the following:
					<ul>
						<li>TP is student and age less than <span id="EICLower">25</span> <span id="EICUpper">or greater than 64</span> and no children</li>
						<li>Investment income (Interest + Tax-free interest + Dividends + Capital gains) more than $<span id="EICInvest">limit</span></li>
						<li>Married filing seperately</li>
						<li>TP or SP not have a SSN that allows to work and valid for EIC</li>
						<li>TP or SP is a nonresident alien any part of the year</li>
					</ul>
				</span></td>
			<td>No:<input id="NoEIC" type="checkbox"> 1040 line <span id="EICLineNoB">??</span></td>
			<td class="calculatedEntry" id="EICTax"></td>
			<td class="AOCClass" id="EICAOC"></td>
			<td class="LLCClass" id="EICLLC"></td></tr>
		<tr>
			<td id="ACTCLabel">Additional Child Tax Credit</td>
			<td>1040 line <span id="ACTCLineNoB">??</span></td>
			<td class="calculatedEntry" id="ACTCTax"></td>
			<td class="AOCClass" id="ACTCAOC"></td>
			<td class="LLCClass" id="ACTCLLC"></td></tr>
		<tr id="RefCareLine">
			<td>Refundable Child and Dependent Care Credit</td>
			<td>1040 line <span id="RefCareLineNoB">??</span></td>
			<td class="calculatedEntry" id="RefCareTax"></td>
			<td class="AOCClass" id="RefCareAOC"></td>
			<td class="LLCClass" id="RefCareLLC"></td></tr>
		<tr>
			<td>Refundable american opportunity credit</td>
			<td>1040 line <span id="AOCLineNoB">??</span></td>
			<td><input class="taxreturn" id="AOCTax" type="number" /></td>
			<td class="AOCClass" id="AOCAOC"></td>
			<td class="LLCClass" id="AOCLLC"></td></tr>
		<tr>
			<td>Net premium tax credit</td>
			<td>1040 line <span id="NetPTCLineNoB">??</span></td>
			<td class="calculatedEntry" id="NetPTCTax"></td>
			<td class="AOCClass" id="NetPTCAOC"></td>
			<td class="LLCClass" id="NetPTCLLC"></td></tr>
		<tr>
			<td>
				<span class="STRefund STRefund0">Tax refund change on the taxpayer&apos;s return:</span></td>
			<td></td>
			<td></td>
			<td><span class="AOCClass STRefund STRefund1" id="TaxpayerRefundAOC0">0</span></td>
			<td><span class="LLCClass STRefund STRefund1" id="TaxpayerRefundLLC0">0</span></td></tr>
	</table>

	</div> <!-- TPTaxFormDiv -->

	<div id="StudentTaxFormDiv">
		<p style="page-break-before: always;"></p>
		<hr /><div class="TaxReturnHeader">Student&apos;s return:</div>
	    <table id="StudentTaxForm" onchange="BudgetChange()">
		<tr>
			<th>Tax return field</th>
			<th>Form and line<br />number</th>
			<th>Tax return<br />amount</th>
			<th>American<br />Opportunity</th>
			<th>Lifetime<br />Learning</th></tr>
		<tr>
			<td>Calculated scholarship income</td>
			<td>TS Schol & Grants</td>
			<td></td>
			<td class="AOCClass" id="StudScholarAOC"> </td>
			<td class="LLCClass" id="StudScholarLLC"> </td></tr>
		<tr id="StudSalaryRow">
			<td>Wages, Salary and Tips</td>
			<td>1040 line <span id="SalaryLineNoB">7</span></td>
			<td><input class="taxreturn" id="StudSalaryTax" type="number" /></td>
			<td class="AOCClass" id="StudSalaryAOC"> </td>
			<td class="LLCClass" id="StudSalaryLLC"> </td></tr>
		<tr id="StudBusinessRow">
			<td>Business Income</td>
			<td>1040 line <span id="BusinessLineNoB">12</span></td>
			<td><input class="taxreturn" id="StudBusinessTax" type="number" /></td>
			<td class="AOCClass" id="StudBusinessAOC"> </td>
			<td class="LLCClass" id="StudBusinessLLC"> </td></tr>
		<tr id="StudSEHIRow">
			<td>Self employed health insurance</td>
			<td>1040 line <span id="SEHILineNoB">??</span></td>
			<td><input class="taxreturn" id="StudSEHITax" type="number" /></td>
			<td class="AOCClass" id="StudSEHIAOC"> </td>
			<td class="LLCClass" id="StudSEHILLC"> </td></tr>
		<tr id="StudEarnedRow">
			<td>Earned Income (not Total Income)</td>
			<td>1040 lines <span id="EarnedLineNoB">7+12</span></td>
			<td><input class="taxreturn" id="StudEarnedTax" type="number" /></td>
			<td class="AOCClass" id="StudEarnedAOC"> </td>
			<td class="LLCClass" id="StudEarnedLLC"> </td></tr>
		<tr>
			<td>AGI</td>
			<td>1040 line <span id="AGILineNoB">7</span></td>
			<td><input class="taxreturn" id="StudAGITax" type="number" /></td>
			<td class="AOCClass" id="StudAGIAOC"></td>
			<td class="LLCClass" id="StudAGILLC"></td></tr>
		<tr>
			<td>Itemized deduction amount (used or not)</td>
			<td>Sched A line <span id="ItemDedLineNoB">29</span></td>
			<td><input class="taxreturn" id="StudItemizedTax" type="number" /></td>
			<td class="AOCClass" id="StudItemizedAOC"></td>
			<td class="LLCClass" id="StudItemizedLLC"></td></tr>
		<tr>
			<td>Qual Div &amp; Cap Gn Wkt pg 1 line <span id="StudCapGainsLineNoA">??</span></td>
			<td>QD&amp;CG Wkt line <span id="StudCapGainsLineNoB">??</span></td>
			<td><input class="taxreturn" id="StudCapGainsTax" type="number" /></td>
			<td class="AOCClass" id="StudCapGainsAOC"></td>
			<td class="LLCClass" id="StudCapGainsLLC"></td></tr>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;Deduction amount</td>
			<td>1040 line <span id="DeductionsLineNoA">40</span></td>
			<td class="calculatedEntry" id="StudDeductionTax"></td>
			<td class="AOCClass" id="StudDeductionAOC"></td>
			<td class="LLCClass" id="StudDeductionLLC"></td></tr>
		<tr id="StudQBIRow">
			<td>QBI deduction amount</td>
			<td>1040 line <span id="QBILineNoB">??</span></td>
			<td class="calculatedEntry" id="StudQBITax"></td>
			<td class="AOCClass" id="StudQBIAOC"></td>
			<td class="LLCClass" id="StudQBILLC"></td></tr>
		<tr>
			<td class="bold">Tax amount:</td>
			<td>1040 line <span id="TaxAmountLineNoA">44</span></td>
			<td class="calculatedEntry" id="StudTaxTax"></td>
			<td class="AOCClass" id="StudTaxAOC"></td>
			<td class="LLCClass" id="StudTaxLLC"></td></tr>
		<tr>
			<td><b>Nonrefundable credits:</b>
			<td></td>
			<td></td>
			<td class="AOCClass"></td>
			<td class="LLCClass"></td></tr>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;Total foreign tax paid</td>
			<td>1116 top</td>
			<td><input class="taxreturn" id="StudFTCTax" type="number" /></td>
			<td class="AOCClass" id="StudFTCAOC"></td>
			<td class="LLCClass" id="StudFTCLLC"></td></tr>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Foreign tax credit</td>
			<td>TS Foreign Tax Credit</td>
			<td class="calculatedEntry taxreturn" id="StudForeignTax"></td>
			<td class="AOCClass" id="StudForeignAOC"></td>
			<td class="LLCClass" id="StudForeignLLC"></td></tr>
		<tr>
			<td>Total Nonrefundable Credits</td>
			<td>1040 line <span id="StudNRCreditLineNoB">??</span></td>
			<td class="calculatedEntry taxreturn" id="StudNRCreditTax">0</td>
			<td class="AOCClass" id="StudNRCreditAOC">0</td>
			<td class="LLCClass" id="StudNRCreditLLC">0</td></tr>
		<tr>
			<td><span class="STRefund STRefund0">Tax refund change on the student&apos;s return:</span></td>
			<td></td>
			<td></td>
			<td><span class="AOCClass STRefund STRefund1" id="StudentRefundAOC0">0</span></td>
			<td><span class="LLCClass STRefund STRefund1" id="StudentRefundLLC0">0</span></td></tr>
	    </table>
	</div> <!-- StudentTaxForm -->

	<div id="TaxFormResultsDiv">
		<hr /><div class="TaxReturnHeader">Optimization results:
			<span id="testPrint" onclick="DataPrint();">&hearts;</span>
		</div>
	<table id="TaxFormResults">
		<tr>
			<td><span class="STRefund">Tax refund change on the taxpayer&apos;s return:</span></td>
			<td></td>
			<td></td>
			<td><span class="AOCClass STRefund" id="TaxpayerRefundAOC">0</span></td>
			<td><span class="LLCClass STRefund" id="TaxpayerRefundLLC">0</span></td></tr>
		<tr>
			<td><span class="STRefund">Tax refund change on the student&apos;s return:</span></td>
			<td></td>
			<td></td>
			<td><span class="AOCClass STRefund" id="StudentRefundAOC">0</span></td>
			<td><span class="LLCClass STRefund" id="StudentRefundLLC">0</span></td></tr>
		<tr>
			<td colspan="3" class="bold">Tax refund change due to the education option:</td>
			<td class="AOCClass bold" id="RefundAOC"></td>
			<td class="LLCClass bold" id="RefundLLC"></td></tr>
	
		<tr><td colspan="6">Pink options are poor choices. Choose the green option if there is one.<span id="Refund65Warning"></span></td></tr>
	
		<tr><td colspan="6"><hr /></td></tr>

		<tr>
			<td class="bold" colspan="2">Additional taxable income for the student:</td>
			<td></td>
			<td class="AOCClass" id="IncomeAOC2"></td>
			<td class="LLCClass" id="IncomeLLC2"></td></tr>
		<tr>
			<td class="bold" colspan="2">Qualified education expenses for TP's tax return:</td>
			<td></td>
			<td class="AOCClass" id="QualExpensesAOC2"></td>
			<td class="LLCClass" id="QualExpensesLLC2"></td></tr>

		<tr><td colspan="6"><hr /></td></tr>
	</table>
	</div>

	<table id="OptimizeButtons">
		<tr class="noPrint">
			<td>Click the OPTIMIZE button to optimize using some scholarship funds as income for this tax return;
				<br />&nbsp;&nbsp;this adjusts the amount taxed in the Funding Sources tab.</td>
			<td><input id="OptimizeButton" type="button" value="OPTIMIZE" onclick="Optimize();" />
				<br /><input id="DataButton" type="button" value="Plot Data" onclick="DataPlot();" />
				<br /><br /><input id="Pbutton2" type="button" value="Print all tabs" onclick="PrintAll();" />
		</td></tr>
	</table>

	<div id="NoOptimize1">
		Cannot optimize. There are no nonqualified education expenses to which scholarship funds can be diverted.
		<br />
	</div>
	<div id="NoOptimize2">
		Cannot optimize. There are no scholarships that can be used to pay for nonqualified expenses.
		<br />
	</div>
	<div id="NoOptimize3">
		Cannot optimize. The student&apos;s AGI is too high to be a qualified dependent.
		<br />
	</div>
	<div id="NoOptimize4">
		Cannot optimize. The student&apos;s unearned income is too high and the kiddie tax applies.
		<br />
	</div>

	<div id="optDiv" class="center">

		<table class="optResult">
			<tr>
				<th>On taxpayer&apos;s return:</th><th></th></tr>
			<tr>
				<td>&nbsp;&nbsp;- Most advantageous option:</td>
				<td id="TaxpayerResultOption"></td></tr>
			<tr>
				<td>&nbsp;&nbsp;- Other income &gt; Other Compensation &gt; Scholarships amount<sup>1</sup>:</td>
				<td id="TaxpayerResultIncome"></td></tr>
			<tr id="TaxpayerResultTuitionRow">
				<td>&nbsp;&nbsp;- Education tuition amount:</td>
				<td id="TaxpayerResultTuition"></td></tr>
			<tr id="TaxpayerResultScholarRow">
				<td>&nbsp;&nbsp;- Education scholarship amount<sup>2</sup>:</td>
				<td id="TaxpayerResultScholar"></td></tr>
			<tr>
				<td>&nbsp;&nbsp;- Education expense amount<sup>3</sup>:</td>
				<td id="TaxpayerResultExpense"></td></tr>
		</table>
	
		<div id="StudentInput">
			<hr />
			<table class="optResult">
				<tr>
					<th>On student&apos;s return:</th></tr>
				<tr>
					<td>&nbsp;&nbsp;- Other income &gt; Other Compensation &gt; Scholarships amount<sup>1</sup>:</td>
					<td id="ScholarResultIncome"></td></tr>
			</table>
		</div>

		<sup>1</sup> Amount of scholarship that is being taxed.
		<br /><sup>2</sup> Amount of scholarship that is being used for qualified expenses.
		<br /><sup>3</sup> Total qualified expenses (<span id="SupResultExpenses"></span>) less tuition (<span id="SupTuition"></span>).
		<span class="warning" id="OptimizerWarning" style="text-align:left;">&nbsp;</span>
	</div>
	
</div>

</body>

<script type="text/javascript"> _GetIRSData(_StartYear, _StopYear); </script>

</html>
