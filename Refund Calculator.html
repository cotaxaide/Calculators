<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="author" content="Jeff Bogart, CO1/D18 Longmont TC">
	<title>Refund Calculator</title>

<style type="text/css">
	html {
		background-color: #cccccc;
	}

	body {
		background-color: #cccccc;
		font-family: sans-serif;
		padding: 0 2.5% 0 2.5%;
	}

	button {
		cursor: pointer;
		background-color: lightgreen;
	}

	table {
		background-color: #eeeeee;
		border-collapse: collapse;
		width: 100%
	}

	h1 {
		text-align: center;
		font-size: 110%;
		text-decoration: underline;
	}

	h2 {
		font-weight: bold;
		background-color: lightgreen;
		text-align: left;
		font-size: 90%;
		padding: 0;
		margin: 0;
	}

	tr {
		vertical-align: top;
	}

	input {
		text-align: left;
		cursor: pointer;
	}
	input, select {
		background-color: white;
	}
	input[type="myinput"] {
		width: 7em;
		cursor: text;
		text-align: right;
	}
	input[type="myinput"]:disabled,
	select:disabled {
		width: 7em;
		background-color: lightgrey;
		font-weight: bold;
		cursor: not-allowed;
	}

	.center {
		text-align: center;
	}
	.underline {
		text-decoration: underline;
	}
	.hidden {
		display: none;
	}
	.title {
		font-size: 125%;
		font-weight: bold;
	}
	.instruction {
		font-style: italic;
	}
	.comment {
		font-style: italic;
	}
	.inputTitle {
		font-weight: bold;
	}
	.noPrint {
		width: 100%;
		float: left;
	}
	.question {
		border: 1px solid green;
		background-color: lightgreen;
		border-radius: 0.5em;
		cursor: help;
	}
	.new_block {
		background-color: #eeeeee;
		padding: 5px;
		border: 1px solid black;
		margin-top: 10px;
		width: 99%;
	}
	.data_entry {
		width: 100%;
	}
	.data_entry tr:nth-child(odd) {
		background-color: #e0e0e0;
	}
	.data_entry tr td {
		vertical-align: middle;
	}
	.data_entry tr td:first-child {
		min-width: 15em;
		width: 15em;
	}
	.data_entry tr td:nth-child(2) {
		width: 7em;
	}
	#instructions {
		display: none;
	}
	#taxpayer_table {
		max-width: 55em;
	}
	#taxpayer_table td:first-child {
		width: 15em;
	}
	#taxpayer_table td:nth-child(2) {
		width: 9em;
	}
	#taxpayer_table td:nth-child(3) {
		width: 7em;
	}
	#instruction_label {
		cursor: help;
	}
	#RefundableDiv,
	#AllocaitonDiv,
	#ResultsDiv {
		page-break-before: auto;
		page-break-inside: avoid;
	}
	#CTCRow {
		border-bottom: 2px solid #eeeeee;
	}
	#ClearAndPrint {
		width: 16em; 
		text-align: center; 
		border: 0;
	       	background-color: transparent;
		z-index: 2;
		position: absolute;
		top: 0em;
		right: 0em;
	}
	#ClearAndPrint button {
		margin: 2px;
	}
	#TPName {
		text-align: left;
		width: auto;
		margin-top: 0;
		font-size: 120%;
		width: 21em;
	}
	#TPNameDiv {
		width: 99%;
	}
	@media print {
		.doPrint {
			display: inline;
		}
		.noPrint {
			display: none;
		}
		html {
			background-color: white;
			font-size: 0.8em;
		}
		body {
			font-size: 0.8em;
			background-color: white;
			padding: 0;
			margin: 0;
		}
		input,
		select,
		option {
			font-size: 0.8em;
		}
		table {
			width: 100%;
			background-color: white;
		}
		#InstructionDiv {
			display: none;
		}
	}
</style>

<script src="Tax_Data/IRS_2000.js"></script>
<script src="Tax_Data/IRS_2015.js"></script>
<script src="Tax_Data/IRS_2016.js"></script>
<script src="Tax_Data/IRS_2017.js"></script>
<script src="Tax_Data/IRS_2018.js"></script>
<script src="Tax_Data/IRS_2019.js"></script>
<script src="CommonRoutines.js"></script>
<script type="text/javascript">
	var VERSION;
	// --------------------------------------------------------------------------------
	// CHANGE HISTORY:
	VERSION = "(Version 2.03a, 8/9/2019)";
	//	Corrected comment on SALT line to show MFS value
	//VERSION = "(Version 2.03, 7/2/2019)";
	//	Remove negative taxable income warning message if box is checked
	//	Added SALT limit amount in comment part of SALT total line
	//VERSION = "(Version 2.02, 6/12/2019)";
	//	Added fields for property and personal tax and calculate total state taxes
	//	Added a checkbox for state taxability of property tax refund/rebate
	//	Added a checkbox for states without sales taxes and alert message for 0 entry
	//	Corrected education credit line number
	//	Re-ordered nonrefundable credits in correct exclusion order
	//VERSION = "(Version 2.01, 5/8/2019)";
	//	Display positive taxable income in negative taxable income test
	//	Added message to check the negative taxable income test box if positive
	//VERSION = "(Version 2.00, 5/7/2019)";
	//	Restructured as a linear set of entries, unhidden as needed
	//	Changes to accomodate the new limit on state tax deductions
	//	Added additional Schedule A possible refunds/rebates
	//	Added non-refundable entry table
	// --------------------------------------------------------------------------------

	//Contributors:
	//	Keith Gillen
	//	Wells Johnson
	//	Ronald Schmaeman
	//	Sam Kaplan
	//	Steve Conory
	//	Fred Petranka
	//	Bob Crews
	//	Kenny Hayes
	//	Leland Honda
	//	Anne Hoffman
	//	Milus Campbell
	//	Peter Steefel
	//	Deb Fisher

	//----------------------------------------------------------------------------------------
	//	GLOBAL VARIABLES
	//----------------------------------------------------------------------------------------
	var StateTaxRefundTaxable = 0;
	var SalesTaxRefundTaxable = 0;
	var PropertyTaxRefundTaxable = 0;
	var MedicalRefundTaxable = 0;
	var TotalTaxable = 0;
	var StateTaxRefundAlert = false;
	var SalesTaxRefundAlert = false;
	var PropertyTaxRefundAlert = false;
	var MedicalRefundAlert = false;
	var ComputationComplete = false;
	var ComputationCompleteAlert = false;
	var MyinputList = [];
	var PY = 0;
	var CY = 0;
	var NY = 0;

	//----------------------------------------------------------------------------------------
	function Initialize() {
	// This function adds tax year options to the Filing Information section
	//----------------------------------------------------------------------------------------
		// Add tax year options
		TaxYear.length = 0;
		var tyOptIndex = 0;
		for (var ty = _StartYear; ty <= _StopYear; ty++) {
			var tyopti = document.createElement("option");
			tyopti.text = tyopti.value = ty;
			TaxYear.add(tyopti,tyOptIndex++);
		}
		TaxYear.value = 2019; //_DefaultYear;
		FilingStatus.value = "MFJ";
		MFSItemize.style.display = "none";
		SNGDependent.style.display = "none";
		MustItemize.checked = false;
		Dependent.checked = false;
		StateWHBox.checked = false;
		SalesTaxBox.checked = false;
		NoSalesTaxBox.checked = false;
		MyinputList = document.getElementsByTagName("myinput");
		Recalculate();
	}

	//----------------------------------------------------------------------------------------
	function Do_Instructions() {	
	// This function shows or hides the instructions
	//----------------------------------------------------------------------------------------
		instructions.style.display = (instructions.style.display == "block") ? "none" : "block" ;
		instruction_label.innerHTML = "Click to " + ((instructions.style.display == "block") ? "hide instructions" : "show instructions") ;
	}

	//----------------------------------------------------------------------------------------
	function ChangeTaxBox(id) {
	// Called when the tax deduction source choice is updated
	//----------------------------------------------------------------------------------------
		// Toggle the other box(s)
		switch (id) {
			case "SalesTaxUsedBox":
				SalesTaxBox.checked = SalesTaxUsedBox.checked;
				StateWHBox.checked = (! SalesTaxUsedBox.checked);
			case "StateWHBox":
				SalesTaxUsedBox.checked = 
				SalesTaxBox.checked = (! StateWHBox.checked);
				break;
			case "SalesTaxBox":
				SalesTaxUsedBox.checked = SalesTaxBox.checked;
				StateWHBox.checked = (! SalesTaxBox.checked);
				break;
		}
	}

	//----------------------------------------------------------------------------------------
	function Recalculate() {	
	// This function readjusts settings when filing status information is changed
	//----------------------------------------------------------------------------------------

		// Initialize filing status to single, under 65, no dependents
		TPBlind.disabled = TP65.disabled = false;
		SPBlind.disabled = SP65.disabled = false;
		MFSItemize.style.display = "none";
		SNGDependent.style.display = "none";

		switch (FilingStatus.value) {
			case "MFJ":
				SPBlind.disabled = SP65.disabled = false;
				MustItemize.checked = false;
				Dependent.checked = false;
				break;
			case "MFS":
				SPBlind.disabled = SP65.disabled = true;
				SPBlind.checked = SP65.checked = false;
				MFSItemize.style.display = "table-row";
				Dependent.checked = false;
				break;
			case "SNG":
				SPBlind.disabled = SP65.disabled = true;
				SPBlind.checked = SP65.checked = false;
				SNGDependent.style.display = "table-row";
				MustItemize.checked = false;
				break;
			case "HOH":
			case "WID":
				SPBlind.disabled = SP65.disabled = true;
				SPBlind.checked = SP65.checked = false;
				MustItemize.checked = false;
				Dependent.checked = false;
			}
	
		// Update lines containing dates
		NY = +TaxYear.value;
		CY = NY - 1;
		PY = NY - 2;

		if (NY >= 2018) {
			TaxableStateLabel.innerHTML = "Schedule 1 line 10";
			TaxableSalesLabel.innerHTML = "Schedule 1 line 21";
		}
		else {
			TaxableStateLabel.innerHTML = "1040 line 10";
			TaxableSalesLabel.innerHTML = "1040 line 21";
		}

		if (CY >= 2018) {
			PostCreditLineNo.innerHTML = "1040 line 13";
			SalesTaxText.style.display = "none";
			ExemptionLabel.innerHTML = "Potential QBI deduction";
			Exemption.disabled = "true";
			ODC.style.display = "inline";
			EnergyRow.style.display = "none";
			StateWHLabel.innerHTML = "5a."
			StateWHBox.style.display = "none";
			StateWHRow.style.display = "table-row";
			StateWHText.innerHTML = "to indicate sales tax used";
			SalesTaxUsedBox.style.display = "inline";
			PropertyLineNo.innerHTML = "5b";
			PersonalRow.style.display = "table-row";
			PropertyRow.style.display = "table-row";
			SALTRow.style.display = "table-row";
			ExemptionText.innerHTML = "From business income of: ";
			QBIIncome.style.display = "inline";
		}
		else {
			PostCreditLineNo.innerHTML = "1040 line 56";
			SalesTaxText.style.display = "inline";
			ExemptionLabel.innerHTML = "Exemption amount:";
			Exemption.disabled = false;
			Exemption.value = "";
			ODC.style.display = "none";
			ODCCount.value = 0;
			EnergyRow.style.display = "table-row";
			StateWHLabel.innerHTML = "5a.<br />5b."
			StateWHBox.style.display = "inline";
			StateWHRow.style.display = (+StateWH.value + +SalesTax.value) ? "table-row" : "none" ;
			PropertyLineNo.innerHTML = "6";
			PropertyRow.style.display = (PropertyTaxRefund.value) ? "table-row" : "none" ;
			PersonalRow.style.display = "none";
			SALTRow.style.display = "none";
			SalesTaxUsedBox.style.display = "none";
			StateWHText.innerHTML = "";
			ExemptionText.innerHTML = "From Form 1040 line " + (_LineNo[CY + ":TaxAmount"] - 2);
			QBIIncome.style.display = "none";
			QBIIncome.value = "";
		}

		TPNameHeader.innerHTML = CY + " Taxpayer Information";
		RefundHeader.innerHTML = "Refunds received in " + NY + " for the return filed in " + CY;
		SchedAHeader.innerHTML = CY + " Schedule A Test Information";
		TaxableHeader.innerHTML = "<hr />" + CY + " Negative Taxable Income Test Information";
		RefundableHeader.innerHTML = "<hr />" + CY + " Unused Refundable Tax Credits Test Information";
		StandardHeader.innerHTML = "<hr />" + CY + " Standard Deduction Calculation for Dependent Taxpayer";
		AllocationHeader.innerHTML = "<hr />" + CY + " state tax payments";
		PYEstimatesQ.innerHTML = "State tax payments for " + PY + ", paid in " + CY;
		EstPY4QLabel.innerHTML = "&nbsp;&nbsp;" + PY + " 4Q estimated payment:";
		DuePY4QLabel.innerHTML = "&nbsp;&nbsp;" + PY + " state tax due payment:";
		CYEstimatesQ.innerHTML = "State tax payments for " + CY;
		PaidCYLabel.innerHTML = "&nbsp;&nbsp;" + CY + " withholding and Q1-3 estimated payments total:";
		PaidCYText.innerHTML = "(Calculated) Should include Q4 estimated payment if paid prior to 12/31/" + CY + " and a payment with an extension to file";
		EstPY4QText.innerHTML = "Typically paid in March. Also, include any other payments for " + CY + " or earlier";
		NYEstimatesQ.innerHTML = "State tax payment for " + CY + ", made in " + NY;
		EstNY4QLabel.innerHTML = "&nbsp;&nbsp;" + CY + " 4Q estimated payment:";
		Est4Q.innerHTML = "Check if there were ANY state income tax payments made in " + CY + " other than withholding";
		EstQ4Questions.style.display = (StateTaxRefund.value) ? "inline" : "none" ;
		CYAllocLabel.innerHTML = "&nbsp;&nbsp;" + CY;
		NYAllocLabel.innerHTML = "&nbsp;&nbsp;" + NY;
		NYAllocText.innerHTML = "This will reduce the " + CY + " Q4 deduction &ndash; part has already been refunded!";
		SALTLineNo.innerHTML = _LineNo[CY + ":SALT"];
		SALTLimit.innerHTML = _SALT[CY] / ((FilingStatus.value == "MFS") ? 2 : 1);
		ItemizedLineNo.innerHTML = _LineNo[CY + ":ItemDed"];
		UseSchedALineNo.innerHTML = _LineNo[CY + ":UseSchedA"];
		CTCAGIText.innerHTML = AGILineNo.innerHTML = _LineNo[CY + ":AGI"];
		SalaryText.innerHTML = "From Form 1040 line " + _LineNo[CY + ":Salary"];
		BusinessText.innerHTML = "From Form 1040 " + _LineNo[CY + ":Business"];
		OldNRCreditsLineNo.innerHTML = _LineNo[CY + ":NRCredit"];
		DedNY4QYear.innerHTML = CY;

		StateTaxRefundAlert = false;
		SalesTaxRefundAlert = false;
		PropertyTaxRefundAlert = false;
		MedicalRefundAlert = false;
		ComputationCompleteAlert = false;
		ComputationComplete = false;

		// What results lines to display
		var ShowStatePT = (PropertyTaxRefundBox.checked) ? 0 : Math.round(+PropertyTaxRefund.value) ;
		var ShowSalesPT = (PropertyTaxRefundBox.checked) ? Math.round(+PropertyTaxRefund.value) : 0 ;
		TaxableStateHeader.style.display =
		TaxableStateRow.style.display = (+StateTaxRefund.value + ShowStatePT) ? "table-row" : "none" ;
		TaxableSalesHeader.style.display =
		TaxableSalesRow.style.display = (+SalesTaxRefund.value + +MedicalRefund.value + ShowSalesPT) ? "table-row" : "none" ;
		DedNY4QRow.style.display =
		DedNY4QHeader.style.display = (DedNY4Q.value) ? "table-row" : "none" ;
	
		Tax_Calc();
	}

	//----------------------------------------------------------------------------------------
	function Tax_Calc() {
	// Calculates the taxable amounts
	// See Pub 525, worksheet 2 for detailed explanation
	//----------------------------------------------------------------------------------------
		
		// Clear the Taxable amounts figures
		TaxableState.value = TaxableSales.value = "";
		ComputationComplete = false;
		ResultsDiv.style.backgroundColor = "";

		// Verify that data is legitimate
		if (isNaN(StateTaxRefund.value) || (+StateTaxRefund.value < 0)) StateTaxRefund.value = "";
		StateTaxRefundTaxable = StateTaxRefund.value;
		if (isNaN(SalesTaxRefund.value) || (+SalesTaxRefund.value < 0)) SalesTaxRefund.value = "";
		SalesTaxRefundTaxable = SalesTaxRefund.value;
		if (isNaN(PropertyTaxRefund.value) || (+PropertyTaxRefund.value < 0)) PropertyTaxRefund.value = "";
		PropertyTaxRefundTaxable = PropertyTaxRefund.value;
		if (isNaN(MedicalRefund.value) || (+MedicalRefund.value < 0)) MedicalRefund.value = "";
		MedicalRefundTaxable = MedicalRefund.value;

		if (NoSalesTaxBox.checked) {
			SalesTaxBox.checked = false;
			SalesTaxUsedBox.checked = false;
			SalesTax.value = 0;
		}

		if (isNaN(Medical.value) || (+Medical.value < 0)) Medical.value = "";
		Medical.style.backgroundColor = "white";
		if (isNaN(StateWH.value) || (+StateWH.value < 0)) StateWH.value = "";
		StateWH.style.backgroundColor = "white";
		if (isNaN(SalesTax.value) || (+SalesTax.value < 0)) SalesTax.value = "";
		SalesTax.style.backgroundColor = "white";
		if (isNaN(Property.value) || (+Property.value < 0)) Property.value = "";
		Property.style.backgroundColor = "white";
		if (isNaN(Property.value) || (+Personal.value < 0)) Personal.value = "";
		Personal.style.backgroundColor = "white";
		if (isNaN(Itemized.value) || (+Itemized.value < 0)) Itemized.value = "";
		Itemized.style.backgroundColor = "white";
		if (isNaN(Salary.value) || (+Salary.value < 0)) Salary.value = "";
		Salary.style.backgroundColor = "white";
		if (isNaN(Business.value) || (+Business.value < 0)) Business.value = "";
		Business.style.backgroundColor = "white";
		if (isNaN(AGI.value) || (+AGI.value < 0)) AGI.value = "";
		AGI.style.backgroundColor = "white";
		if (isNaN(Exemption.value) || (+Exemption.value < 0)) Exemption.value = "";
		Exemption.style.backgroundColor = (Exemption.disabled) ? "lightgrey" : "white" ;
		if (isNaN(QBIIncome.value) || (+QBIIncome.value < 0)) QBIIncome.value = "";
		QBIIncome.style.backgroundColor = (QBIIncome.disabled) ? "lightgrey" : "white" ;
		if (isNaN(EstPY4Q.value) || (+EstPY4Q.value < 0)) EstPY4Q.value = "";
		EstPY4Q.style.backgroundColor = "white";
		if (isNaN(DuePY4Q.value) || (+DuePY4Q.value < 0)) DuePY4Q.value = "";
		DuePY4Q.style.backgroundColor = "white";
		if (isNaN(EstNY4Q.value) || (+EstNY4Q.value < 0)) EstNY4Q.value = "";
		EstNY4Q.style.backgroundColor = "white";
		if (isNaN(OldCredits.value) || (+OldCredits.value < 0)) OldCredits.value = "";
		OldCredits.style.backgroundColor = "white";
		if (isNaN(ForeignTax.value) || (+ForeignTax.value < 0)) ForeignTax.value = "";
		ForeignTax.style.backgroundColor = "white";
		if (isNaN(ChildCare.value) || (+ChildCare.value < 0)) ChildCare.value = "";
		ChildCare.style.backgroundColor = "white";
		if (isNaN(Education.value) || (+Education.value < 0)) Education.value = "";
		Education.style.backgroundColor = "white";
		if (isNaN(Retirement.value) || (+Retirement.value < 0)) Retirement.value = "";
		Retirement.style.backgroundColor = "white";
		if (isNaN(CTCAGI.value) || (+CTCAGI.value < 0)) CTCAGI.value = "";
		CTCAGI.style.backgroundColor = "white";
		if (isNaN(CTCCount.value) || (+CTCCount.value < 0)) CTCCount.value = "";
		CTCCount.style.backgroundColor = "white";
		if (isNaN(ODCCount.value) || (+ODCCount.value < 0)) ODCCount.value = "";
		ODCCount.style.backgroundColor = "white";
		if (isNaN(Energy.value) || (+Energy.value < 0)) Energy.value = "";
		Energy.style.backgroundColor = "white";
		if (isNaN(Elderly.value) || (+Elderly.value < 0)) Elderly.value = "";
		Elderly.style.backgroundColor = "white";

		// See if we have all we need to do a calculation
		var NeedData = 0;
		TestingSchedAFor.innerHTML = "";
		TestingStandardFor.innerHTML = "";
		TestingTaxableFor.innerHTML = "";
		TestingRefundableFor.innerHTML = "";
		TestingAllocationFor.innerHTML = "";

		// Miscellaneous calculations for aethetics
		var SStax = (SalesTaxUsedBox.checked) ? +SalesTax.value : +StateWH.value ;
		SALT.value = SStax + +Property.value + +Personal.value;

		// Are any credits entered
		if ((StateTaxRefund.value == "") && (SalesTaxRefund.value == "")
			&& (PropertyTaxRefund.value == "") && (MedicalRefund.value == "")) return;

	//----------------------------------------------------------------------------------------
		// Determine the taxable amount of the medical refund
		if (+MedicalRefund.value) {
			MedicalRow.style.display = "table-row";
			TestingSchedAFor.innerHTML = "Testing for medical refund taxability";
			SchedAButton.style.display = "inline";
			RefundsButton.style.display = "none";

			// Check the input data
			if (Medical.value == "") {
				NeedData++;
				Medical.style.backgroundColor = "yellow";
				Medical.focus();
			}
			if (NeedData) return;

			// OK to calculate
			TotalTaxable =
			MedicalRefundTaxable = Math.min(+Medical.value, +MedicalRefund.value);
		}
		else {
			MedicalRow.style.display = "none";
			Medical.value = "";
		}
		TestingSchedAFor.innerHTML = "";
			SchedAButton.style.display = "none";

		if (Status_Test()) return;

	//----------------------------------------------------------------------------------------
		// Determine amount of state tax or sales tax refund is taxable

		if ((+StateTaxRefund.value + +SalesTaxRefund.value) || (TaxYear.value > 2018)) {
			TestingSchedAFor.innerHTML = "Testing for sales tax and state income tax withholding difference";
			RefundsButton.style.display = "none";
			SchedAButton.style.display = "inline";
			StateWHRow.style.display = "table-row";

			if (+StateTaxRefund.value && SalesTaxUsedBox.checked) StateTaxRefundTaxable = 0;
			if (+SalesTaxRefund.value && (! SalesTaxUsedBox.checked)) SalesTaxRefundTaxable = 0;
			if (Status_Test()) return;

			if (+StateTaxRefundTaxable + +SalesTaxRefundTaxable) {
				TestingSchedAFor.innerHTML = "Testing for sales tax and state income tax withholding difference";
				// Check the input data
				if (StateWH.value == "") {
					NeedData++;
					StateWH.style.backgroundColor = "yellow";
					StateWH.focus();
				}
				else if (SalesTax.value == 0) {
					if (NoSalesTaxBox.checked) {
						SalesTax.value = 0;
						}
					else {
						if (SalesTax.value === "0") {
							alert("Entering the sales tax amount is required.");
						}
						NeedData++;
						SalesTax.style.backgroundColor = "yellow";
						SalesTax.focus();
					}
				}
				if (NeedData) return;

				// OK to calculate

				// Find the effect of the refund
				StateTaxRefundTaxable = Math.min(StateTaxRefundTaxable, StateWH.value);
				SalesTaxRefundTaxable = Math.min(SalesTaxRefundTaxable, SalesTax.value);

				if (! (+StateTaxRefundTaxable + +SalesTaxRefundTaxable)) {
					StateWH.style.backgroundColor = "white";
					SalesTax.style.backgroundColor = "white";
				}

				if (SalesTaxUsedBox.checked) {
					SalesTaxRefundTaxable = Math.max(0, Math.min(SalesTaxRefundTaxable,
						+SalesTax.value - +StateWH.value));
					StateTaxRefundTaxable = 0;
				}
				else {
					StateTaxRefundTaxable = Math.max(0, Math.min(StateTaxRefundTaxable,
						+StateWH.value - +SalesTax.value));
					SalesTaxRefundTaxable = 0;
				}

				TotalTaxable += StateTaxRefundTaxable + SalesTaxRefundTaxable;
			}
		}
		else {
			StateWHRow.style.display = "none";
			SalesTax.value = "";
			StateWH.value = "";
		}
		TestingSchedAFor.innerHTML = "";
		SchedAButton.style.display = "none";

		if (Status_Test()) return;

	//----------------------------------------------------------------------------------------
		// Determine if property tax refund is limited
		if ((PropertyTaxRefund.value) || (TaxYear.value > 2018)) {
			PropertyRow.style.display = "table-row";

			// Check the input data
			if (PropertyTaxRefund.value) {
				TestingSchedAFor.innerHTML = "Testing for real estate tax refund taxability";
			}
			else {
				TestingSchedAFor.innerHTML = "Testing for state and local tax (&quot;SALT&quot;) limitation";
			}

			if (Property.value == "") {
				NeedData++;
				Property.style.backgroundColor = "yellow";
				Property.focus();
			}
			if (NeedData) return;

			// OK to calculate
			PropertyTaxRefundTaxable = Math.min(PropertyTaxRefundTaxable, +Property.value);
		}
		else {
			PropertyRow.style.display = "none" ;
			Property.value = "";
		}
		TestingSchedAFor.innerHTML = "";
		SchedAButton.style.display = "none";

		if (Status_Test()) return;

	//----------------------------------------------------------------------------------------
		// Determine if deduction for taxes paid is limited
		var SALTRefund = +SalesTaxRefundTaxable + +StateTaxRefundTaxable + +PropertyTaxRefundTaxable;
		var SALTdiff = 0;
		if (_SALT[CY] && SALTRefund) {
			TestingSchedAFor.innerHTML = "Testing for state and local tax (&quot;SALT&quot;) limitation";
			RefundsButton.style.display = "none";
			SchedAButton.style.display = "inline";
			SALTRow.style.display = "table-row";

			if (Personal.value == "") {
				NeedData++;
				Personal.style.backgroundColor = "yellow";
				Personal.focus();
			}
			if (NeedData) return;

			// OK to calculate
			NewSALT = SALT.value - SALTRefund;
			SALTlimit = _SALT[CY] / ((FilingStatus.value == "MFS") ? 2 : 1);
			SALTdiff = Math.max(0, SALTlimit - NewSALT);

			// Determine amount attributable to each tax refund
			StateWHPct = StateTaxRefundTaxable / SALTRefund;
			SalesTaxPct = SalesTaxRefundTaxable / SALTRefund;
			PropertyPct = PropertyTaxRefundTaxable / SALTRefund;
			SalesTaxRefundTaxable = Math.min(SalesTaxRefundTaxable, SALTdiff * SalesTaxPct);
			StateTaxRefundTaxable = Math.min(StateTaxRefundTaxable, SALTdiff * StateWHPct);
			PropertyTaxRefundTaxable = Math.min(PropertyTaxRefundTaxable, SALTdiff * PropertyPct);

		}
		else {
			SALTRow.style.display = "none";
			}
		TestingSchedAFor.innerHTML = "";
		SchedAButton.style.display = "none";

		if (Status_Test()) return;

	//----------------------------------------------------------------------------------------
		// Determine the standard deduction if taxpayer is a dependent
		var EarnedIncome = 0;
		if (Dependent.checked) {
			TestingStandardFor.innerHTML = "Determining standard deduction for a dependent";
			StandardDiv.style.display = "block";
			StandardButton.style.display = "inline";

			// Check the input data
			if (Salary.value == "") {
				NeedData++;
				Salary.style.backgroundColor = "yellow";
				Salary.focus();
			}
			Itemized.style.display = "table-row";
			if (Business.value == "") {
				NeedData++;
				Business.style.backgroundColor = "yellow";
				Business.focus();
			}

			// OK to calculate
			EarnedIncome = +Salary.value + +Business.value;
		}
		else {
			StandardDiv.style.display = "none";
			Salary.value = "";
			Business.value = "";
		}

		// Determine the standard deduction
		if (MustItemize.checked || UseSchedA.checked) {
			StandardDeduction.value =
			PYStandard.innerHTML = "";
		}
		else {
			StandardDeduction.value = _StandardDeduction(CY, FilingStatus.value,
				TP65.checked, TPBlind.checked, SP65.checked, SPBlind.checked,
				Dependent.checked, EarnedIncome);
			PYStandard.innerHTML = "(Standard deduction = " + StandardDeduction.value + ")";
		}
		TestingStandardFor.innerHTML = "";
		StandardButton.style.display = "none";

		if (NeedData) return;

	//----------------------------------------------------------------------------------------
		// Compare itemized and standard deduction
		OriginalItemized.value = Itemized.value;
		if (TotalTaxable) {
			// Determine the new Schedule A total to be used for testing
			TestingSchedAFor.innerHTML = "Comparing itemized and standard deductions";
			RefundsButton.style.display = "none";
			SchedAButton.style.display = "inline";
			ItemizedRow.style.display = "table-row";

			if (! UseSchedA.checked) {
				// Check the input data
				if (Itemized.value == "") {
					NeedData++;
					Itemized.style.backgroundColor = "yellow";
					Itemized.focus();
				}
				if (NeedData) return;
	
				if (Itemized.value < (+SALT.value + +Medical.value)) {
					NeedData++;
					Itemized.style.backgroundColor = "hotpink";
					alert("Itemized deduction total seems too low.");
				}
				if (NeedData) return;
		
				// OK to calculate
				ItemizedDiff = Math.max(0, Itemized.value - StandardDeduction.value);
				NewTotalTaxable = Math.min(ItemizedDiff, TotalTaxable);
				NewTotalPct = NewTotalTaxable / TotalTaxable;

				// Determine amount attributable to each tax refund
				SalesTaxRefundTaxable = SalesTaxRefundTaxable * NewTotalPct;
				StateTaxRefundTaxable = StateTaxRefundTaxable * NewTotalPct;
				PropertyTaxRefundTaxable = PropertyTaxRefundTaxable * NewTotalPct;
				MedicalRefundTaxable = MedicalRefundTaxable * NewTotalPct;
			}
		}
		else {
			ItemizedRow.style.display = "none";
			Itemized.value = "";
		}
		TestingSchedAFor.innerHTML = "";
		SchedAButton.style.display = "none";
		
		Status_Test();

	//----------------------------------------------------------------------------------------
		// Test for negative taxable income
		if (TotalTaxable) {
			TaxableDiv.style.display = "block";
			if (! PositiveTaxable.checked) {
				TestingTaxableFor.innerHTML = "Testing for negative taxable income";
				TaxableButton.style.display = "inline";
				TaxablePositive.style.display = "none";
				TaxableTable.style.display = "inline-table";
				RefundableDiv.style.display = "none";
				Taxable.value = "";

				// Check the input data
				if (AGI.value == "") {
					NeedData++;
					AGI.style.backgroundColor = "yellow";
					AGI.focus();
				}
				else if (CY >= 2018) {
					if (Business.value != "") QBIIncome.value = Business.value;
					Exemption.value = _QBICalc(CY, FilingStatus.value, QBIIncome.value,
						0, 0, (+Salary.value + +QBIIncome.value));
					if (QBIIncome.value == "") {
						NeedData++;
						QBIIncome.style.backgroundColor = "yellow";
						QBIIncome.focus();
					}
				}
				else if (Exemption.value == "") {
					NeedData++;
					Exemption.style.backgroundColor = "yellow";
					Exemption.focus();
				}
				if (NeedData) return;

				// OK to calculate
				CTCAGI.value = AGI.value;
				Taxable.value = +AGI.value - +Exemption.value - +Itemized.value;
				if (Taxable.value == 0) Taxable.value = " 0"; // prevents recusion
				if (Taxable.value > 0) {
					Message = "Check your entries.";
					Message += " The taxable amount will be positive if these numbers are used!";
					Message += "\n\nIf your entries are correct,";
					Message += " check the box on this section to skip this test.";
					alert(Message);
					AGI.style.backgroundColor = "hotpink";
					Exemption.style.backgroundColor = "hotpink";
					TaxablePositive.style.display = "inline";
					return;
				}

				NewTotalTaxable = TotalTaxable - Math.min(-Taxable.value, TotalTaxable);
				NewTotalPct = NewTotalTaxable / TotalTaxable;

				// Determine amount attributable to each tax refund
				SalesTaxRefundTaxable = SalesTaxRefundTaxable * NewTotalPct;
				StateTaxRefundTaxable = StateTaxRefundTaxable * NewTotalPct;
				PropertyTaxRefundTaxable = PropertyTaxRefundTaxable * NewTotalPct;
				MedicalRefundTaxable = MedicalRefundTaxable * NewTotalPct;
			}
			else { // Taxable is positive
				TaxableTable.style.display = "none";
				TaxablePositive.style.display = "none";
				AGI.value = "";
				Exemption.value = "";
				QBIIncome.value = "";
				Taxable.value = "";
			}
		}
		else {
			TaxableDiv.style.display = "none";
			AGI.value = "";
			Exemption.value = "";
			Taxable.value = "";
		}
		TestingTaxableFor.innerHTML = "";
		TaxableButton.style.display = "none";

		Status_Test();

	//----------------------------------------------------------------------------------------
		// Test for non-refundable credits
		if (TotalTaxable) {
			RefundableTable.style.display = "none";
			RefundableAmendedTable.style.display = "none";
			RefundableDiv.style.display = "block";
			TestingRefundableFor.innerHTML = "Testing for reduction due to unused refundable credits";
			RefundableButton.style.display = "inline";
			NewCredits.value = "";
			TaxBracketGain.value = "";

			NeedData++;
			if (! NoRefundables.checked) {
				NeedData = 0;

				RefundableTable.style.display = "inline-table";

				if (OldCredits.value == "") {
					NeedData++;
					OldCredits.style.backgroundColor = "yellow";
					OldCredits.focus();
				}
				if (NeedData) return;

				RefundableAmendedTable.style.display = "inline-table";
				TestingRefundableFor.innerHTML = "Testing for reduction due to unused refundable credits";
				RefundableButton.style.display = "inline";

				// Calculate the CTC if the data is available
				CTCCalc = (CTCAGI.value != "") && (CTCCount.value != "") && (ODCCount.value != "");
				if (CTCCalc) {
					CTCReturn = _CTCLookup(CY, FilingStatus.value,
							CTCCount.value, (+CTCCount.value + +ODCCount.value),
							0, CTCAGI.value, 0);
					CTC.value = +CTCReturn[0] + +CTCReturn[1];
				}
				else CTC.value = "";

				if (CTC.value == "") {
					CTCTable.style.display = "inline";
					if (AGI.value != "") CTCAGI.value = AGI.value;
					if (CTCAGI.value == "") {
						CTC.value = "";
						NeedData++;
						CTCAGI.style.backgroundColor = "yellow";
						CTCAGI.focus();
					}
					if (NeedData) return;
					else if (CTCCount.value == "") {
						CTC.value = "";
						NeedData++;
						CTCCount.style.backgroundColor = "yellow";
						CTCCount.focus();
					}
					if (NeedData) return;
					else if (ODCCount.value == "") {
						CTC.value = "";
						NeedData++;
						ODCCount.style.backgroundColor = "yellow";
						ODCCount.focus();
					}
					if (NeedData) return;
				}
				else if (ForeignTax.value == "") {
					ForeignTax.style.backgroundColor = "yellow";
					NeedData++;
					ForeignTax.focus();
					}
				else if (ChildCare.value == "") {
					ChildCare.style.backgroundColor = "yellow";
					NeedData++;
					ChildCare.focus();
					}
				else if (Elderly.value == "") {
					Elderly.style.backgroundColor = "yellow";
					NeedData++;
					Elderly.focus();
					}
				else if (Education.value == "") {
					Education.style.backgroundColor = "yellow";
					NeedData++;
					Education.focus();
					}
				else if (Retirement.value == "") {
					Retirement.style.backgroundColor = "yellow";
					NeedData++;
					Retirement.focus();
					}
				else if ((NY <= 2018) && (Energy.value == "")) {
					Energy.style.backgroundColor = "yellow";
					NeedData++;
					Energy.focus();
					}

				NewCredits.value = +ForeignTax.value + +ChildCare.value + +Education.value
					+ +Retirement.value + +CTC.value + +Energy.value + +Elderly.value;

				// Is at least the old data entered
				if ((NeedData == 0) && (+NewCredits.value < +OldCredits.value)) {
					Message = "The maximum values do not, but should, total";
					Message += " to at least the current total credits.";
					Message += "\n\nPlease check the amounts you have entered.";
					alert(Message);
					return;
				}


				// OK to calculate

				// OldCredits bring the tax to 0, so NewCredits is the tax on the new taxable amount
				TaxBracketGain.value = creditDiff = Math.max(0, NewCredits.value - OldCredits.value);

				// Figure the tax bracket and taxable amount increase allowed
				var additionalForCredits = +Brackets(OldCredits.value, NewCredits.value);

				NewTotalTaxable = Math.max(0, +TotalTaxable - +additionalForCredits);
				NewTotalPct = +NewTotalTaxable / +TotalTaxable;

				// Determine amount attributable to each tax refund
				SalesTaxRefundTaxable = +SalesTaxRefundTaxable * +NewTotalPct;
				StateTaxRefundTaxable = +StateTaxRefundTaxable * +NewTotalPct;
				PropertyTaxRefundTaxable = +PropertyTaxRefundTaxable * +NewTotalPct;
				MedicalRefundTaxable = +MedicalRefundTaxable * +NewTotalPct;

				if (Status_Test()) {
					AllocationDiv.style.display = "none"; // close if previously open
					return;
				}
				if (NeedData) return;
			}
			else {
				OldCredits.value = "";
				ForeignTax.value = "";
				ChildCare.value = "";
				Education.value = "";
				Retirement.value = "";
				CTCAGI.value = "";
				CTCCount.value = "";
				ODCCount.value = "";
				CTC.value = "";
				Energy.value = "";
				Elderly.value = "";
				NewCredits.value = "";
				NeedData = 0;
				TestingRefundableFor.innerHTML = "";
				RefundableButton.style.display = "none";
			}
		}
		else {
			RefundableDiv.style.display = "none";
		}

		if (NeedData == 0) {
			TestingRefundableFor.innerHTML = "";
			RefundableButton.style.display = "none";
		}

		if (Status_Test()) {
			AllocationDiv.style.display = "none"; // close if previously open
			return;
		}

	//----------------------------------------------------------------------------------------
		// Allocate state tax refund if it bridges multiple years
		CYAlloc.value = Math.round(StateTaxRefundTaxable);
		NYAlloc.value = 0;
		DedNY4Q.value = "";
		if (StateTaxRefundTaxable && Est4QYes.checked) {
			AllocationDiv.style.display = "block";
			AllocationTable.style.display = (NoAllocation.checked) ? "none" : "table" ;

			if (! NoAllocation.checked) {
				TestingAllocationFor.innerHTML = "Allocating refund based on year paid";
				AllocationButton.style.display = "inline";
				AllocationTable.style.display = "table";
				PaidCY.value = +StateWH.value - +EstPY4Q.value - +DuePY4Q.value;

				// Check inputs
				if (EstPY4Q.value == "") {
					NeedData++;
					EstPY4Q.style.backgroundColor = "yellow";
				}
				if (DuePY4Q.value == "") {
					NeedData++;
					DuePY4Q.style.backgroundColor = "yellow";
				}
				if (NeedData) return;

				if (PaidCY.value < 0) {
					EstPY4Q.style.backgroundColor = "hotpink";
					DuePY4Q.style.backgroundColor = "hotpink";
					Message = "Please check the pink entries.";
					Message += "\n\nThe amount paid in " + CY;
					Message += " should not be negative!";
					Message += "\n\nWas it included as a deduction?"; 
					alert(Message);
					return;
				}

				if (EstNY4Q.value == "") {
					NeedData++;
					EstNY4Q.style.backgroundColor = "yellow";
				}
				if (NeedData) return;

				// OK to calculate
				PYTotal = (+PaidCY.value + +EstNY4Q.value);
				if (PYTotal == 0) CYAlloc.value = 0;
				else CYAlloc.value = Math.round((+StateTaxRefundTaxable * +PaidCY.value) / PYTotal);
				NYAlloc.value = Math.round(+StateTaxRefundTaxable - +CYAlloc.value);
				StateTaxRefundTaxable = +CYAlloc.value; // update to the new taxable amount
				DedNY4Q.value = Math.round(Math.max(0, +EstNY4Q.value - +NYAlloc.value));
			}
		}
		else {
			AllocationDiv.style.display = "none";
		}

		DedNY4QRow.style.display =
		DedNY4QHeader.style.display = (DedNY4Q.value) ? "table-row" : "none" ;
		if (NeedData == 0) ComputationComplete = true;

		Status_Test();

		TestingAllocationFor.innerHTML = "";
		AllocationButton.style.display = "none";
	}

	//----------------------------------------------------------------------------------------
	function Brackets(tax0, tax1) {
	// Calculates the bracket(s) for the credits 
	//----------------------------------------------------------------------------------------
		var rateList = _TaxRates[CY + ":PCT"].split(",");
		var sizeList = _TaxRates[CY + ":" + FilingStatus.value].split(","); // maximum for the rate

		// Compare the starting tax with the tax resulting from each tax bracket taxable income
		var taxBracket = 0;
		while ( (taxBracket < rateList.length)
			&& (+tax0 > (bracketMaxTax = +sizeList[taxBracket] * +rateList[taxBracket]))
		      ) { taxBracket++; }

		// credits may span tax brackets...

		// How much in the tax0 bracket?
		var tax1a = Math.max(0, (Math.min(+tax1, bracketMaxTax) - +tax0));
		var cE1a = Math.round(tax1a / rateList[taxBracket]);

		// How much in the next bracket (unlikely to jump 2 brackets)
		var tax1b = Math.max(0, +tax1 - +tax0 - tax1a);
		var cE1b = Math.round(tax1b / rateList[taxBracket+1]);

		creditExclusion = cE1a + cE1b;
		var tbmsg = "At " + (100 * rateList[taxBracket]) + "% tax rate, exclusion = " + cE1a;
		if (cE1b > 0) tbmsg += "<br />At " + (100 * rateList[taxBracket+1]) + "% tax rate, exclusion = " + cE1b;
		TaxBracket.innerHTML = tbmsg;
		return creditExclusion;
	}

	//----------------------------------------------------------------------------------------
	function Status_Test() {
	// Alert message if a conclusion is reached
	//----------------------------------------------------------------------------------------
		var Message = "";
		TestingSchedAFor.innerHTML = "";
		TestingStandardFor.innerHTML = "";
		TestingTaxableFor.innerHTML = "";
		TotalRefund = +StateTaxRefund.value + +SalesTaxRefund.value
			+ +PropertyTaxRefund.value + +MedicalRefund.value
		if (TotalRefund	 == 0) return;
		SummaryA.innerHTML = "";
		SummaryB.innerHTML = "";

		var StateRT = Math.round(StateTaxRefundTaxable);
		if (StateTaxRefund.value) {
			SummaryA.innerHTML += "<br />State Tax portion = " + StateRT;
		}
		var TotalNotStateTaxable = StateRT;

		var SalesRT = Math.round(SalesTaxRefundTaxable);
		if (SalesTaxRefund.value) {
			SummaryB.innerHTML += "<br />Sales Tax portion = " + SalesRT;
		}

		var MedicRT = Math.round(MedicalRefundTaxable);
		if (MedicalRefund.value) {
			SummaryB.innerHTML += "<br />Medical portion = " + MedicRT;
		}
		var TotalStateTaxable = SalesRT + MedicRT;

		var PropyRT = Math.round(PropertyTaxRefundTaxable);
		if (PropertyTaxRefundBox.checked) {
			if (PropertyTaxRefund.value) {
				SummaryB.innerHTML += "<br />Property Tax portion = " + PropyRT;
			}
			TotalStateTaxable += PropyRT;
		}
		else {
			if (PropertyTaxRefund.value) {
				SummaryA.innerHTML += "<br />Property Tax portion = " + PropyRT;
			}
			TotalNotStateTaxable += PropyRT;
		}

		TaxableState.value = TotalNotStateTaxable;
		TaxableSales.value = TotalStateTaxable;

		TotalTaxable = TotalStateTaxable + TotalNotStateTaxable;
		if ((TotalTaxable == 0) || ComputationComplete) {
			TestingRefundableFor.innerHTML = "";
			RefundableButton.style.display = "none";
			ResultsDiv.style.backgroundColor = "lightgreen";
			RefundsButton.style.display = "none";
		}

		if ((StateTaxRefund.value > 0) && (StateTaxRefundTaxable == 0) && (! StateTaxRefundAlert)) {
			Message = "Your state income tax refund is not taxable.";
			StateTaxRefundAlert = true;
		}

		if ((SalesTaxRefund.value > 0) && (SalesTaxRefundTaxable == 0) && (! SalesTaxRefundAlert)) { 
			Message += "\nYour sales tax refund is not taxable.";
			SalesTaxRefundAlert = true;
		}

		if ((PropertyTaxRefund.value > 0) && (PropertyTaxRefundTaxable == 0) && (! PropertyTaxRefundAlert)) {
			Message += "\nYour property tax refund is not taxable.";
			PropertyTaxRefundAlert = true;
		}

		if ((MedicalRefund.value > 0) && (MedicalRefundTaxable == 0) && (! MedicalRefundAlert)) {
			Message += "\nYour medical refund is not taxable.";
			MedicalRefundAlert = true;
		}

		if (TotalTaxable == 0) {
			if (! ComputationCompleteAlert) {
				Message += "\nComputation complete";
				ComputationCompleteAlert = true;
			}
			ComputationComplete = true;
			ResultsDiv.style.backgroundColor = "lightgreen";
			for (j = 0; j < MyinputList.length; j++) {
				if (! MyinputList[j].disabled) MyinputList[j].style.backgroundColor = "white";
			}
		}

		if (Message) alert(Message);
		return (TotalTaxable == 0);
	}

</script>

</head>

<!-- ******************************************************************************************************** -->
<!-- **************************************** START OF HTML ************************************************* -->
<!-- ******************************************************************************************************** -->

<body onload="Initialize()">

<center>
	<span class="title">Taxable Refund and Recovery Calculator</span>
	<br><span id="Version"></span>
	<script>Version.innerHTML = VERSION;</script>
	<br />&nbsp;

	<div id="ClearAndPrint" class="new_block noPrint">
		<button onclick="window.open(window.location, '_self');">Clear and reset calculator</button>
		<br /><button onclick="window.print()">Print a taxpayer copy</button>
	</div>

	<div class="new_block" id="TPNameDiv" onchange="Recalculate();">
		<h1 id="TPNameHeader"></h1>
		<center>
		<table id="taxpayer_table">
			<tr>	<td><span class="inputTitle">This Tax Year: </span>
					<select style="width:6em;" id="TaxYear" title="Select the tax year being prepared."></select></td>
				<td class="inputTitle">Taxpayer&apos;s Name: </td>
				<td colspan="3"><input id="TPName" title="Enter the taxpayer's name. Consider printing the results for the taxpayer's record" /></td></tr>
			<tr>	<td></td>
				<td class="inputTitle">Filing Status:</td>
				<td><select id="FilingStatus" title="Select the taxpayer's filing status.">
					<option value="SNG">Single</option>
					<option value="MFJ">MFJ</option>
					<option value="MFS">MFS</option>
					<option value="HOH">HOH</option>
					<option value="WID">Widow(er)</option></select></td>
				<td><input id="TP65" type="checkbox" title="Taxpayer was 65 or older" /> TP was 65 or older,
				<input id="TPBlind" type="checkbox" title="Taxpayer was blind" /> TP was blind
				<br /><input id="SP65" type="checkbox" title="Spouse was 65 or older" /> SP was 65 or older,
				<input id="SPBlind" type="checkbox" title="Spouse was blind" /> SP was blind
				</td></tr>
			<tr>	<td colspan="3"></td>
				<td id="SNGDependent"><input id="Dependent" type="checkbox"> Dependent on another taxpayer&apos;s return</td></tr>
			<tr>	<td colspan="3"></td>
				<td id="MFSItemize"><input id="MustItemize" type="checkbox"> Must itemize because spouse itemized</td></tr>
		</table>
	</center>
	</div>
</center>
	
<div id="InstructionDiv" class="new_block">
	<span onclick="Do_Instructions();"><h1 id="instruction_label">Click to show instructions</h1></span>
	<div id="instructions">
		Data entry notes:
		<ul>
			<li>Values in the fields are not recognized until you tab or click out of the field.</li>
			<li>Boxes highlighted in yellow require an entry before the calculation is done.</li>
			<li>A blank field does not necessarily mean zero. Enter 0 if appropriate when an entry is required.</li>
		</ul>

		If the sales tax amount is not shown on the previous year return printout,
		use the <a href="https://apps.irs.gov/app/stdc/" target="_blank">IRS sales tax calculator</a> to determine the amount.

		<br /><br />Taxability on refund amounts are determined by entries on the previous year return which include:
		<ul>
			<li>The amount of the refund or the pro-rated amount of the refund if estimated taxes were paid after December 31st.</li>
			<li>The difference between Sales Tax and State Withholding used in Schedule A.</li>
			<li>The effect of the state and local tax (&quot;SALT&quot;) deduction limitation in tax year 2018 and later.</li>
			<li>The total itemized deductions which exceed the standard deduction.</li>
			<li>The extent to which itemized deductions are limited (Not considered due to high income required)</li>
			<li>The amount of a taxable amount that is negative (TaxSlayer does not consider this).</li>
			<li>Tax Credits that were available but not fully used to reduce tax (TaxSlayer does not consider this).</li>
			<li>Refunds for any but the one preceding year are not considered because they are out of scope.</li>
		</ul>
		Resulting taxable amounts are shown for the current year.
	</div>
</div>

<div id="DataEntryDiv" class="new_block" onchange="Recalculate();">
	<div id="Refunds">
		<h1 id="RefundHeader"></h1>
		<table class="data_entry">
			<tr>	<td>State income tax refund amount:</td>
				<td><input id="StateTaxRefund" type="myinput" /></td>
				<td>Refund due to overpayment of state income tax that was used as a deduction on Schedule A
					<span id="EstQ4Questions">
						<br /><input id="Est4QYes" type="checkbox" /> <span id="Est4Q"></span>
					</span>
					</td></tr>
			<tr>	<td>Sales tax refund amount:</td>
				<td><input id="SalesTaxRefund" type="myinput" /></td>
				<td>Refund due to a refund of sales tax paid on an item that was used to augment the state sales tax deduction on Schedule A
					(return of a car or boat, for example - very rare event)
					</td></tr>
			<tr>	<td>Real estate tax refund amount:</td>
				<td><input id="PropertyTaxRefund" type="myinput" /></td>
				<td>Refund or rebate of state real estate taxes used as a deduction on Schedule A
				<br /><input id="PropertyTaxRefundBox" type="checkbox">
				Check if this refund IS taxable to the state.</td></tr>
			<tr>	<td>Medical refund amount:
				<td><input id="MedicalRefund" type="myinput" /></td>
				<td>Repayment of expenses by insurance or other reimbursement for medical expenses used as a deduction on Schedule A</td></tr>
<!--
			<tr>	<td>Other recoverable amounts:
				<td><input id="OtherRefund" type="myinput" /></td>
				<td>Refund or recovery of other expenses that provided an adjustment or reduction of taxes</td></tr>
-->
		</table>
		<button id="RefundsButton">Next</button>
	</div> <!-- Refunds -->
</div> <!-- DataEntry -->

<div id="TaxCalcDiv" class="new_block" onchange="Tax_Calc();">
	<div id="SchedADiv">
		<h1 id="SchedAHeader"></h1>
		<h2 id="TestingSchedAFor"></h2>
		<table class="data_entry">
			<tr><td> </td><td> </td><td> </td></tr>
			<tr id="MedicalRow" class="hidden">
				<td>4. Medical deduction:</td>
				<td><input id="Medical" type="myinput" /></td>
				<td>Enter the medical deduction that was allowed on Schedule A</td></tr>
			<tr id="StateWHRow" class="hidden">
				<td>
					<table>
					<tr>
						<td id="StateWHLabel" style="min-width: auto; width: 1.5em; max-width: 1.5em;">5a.<br />5b.</td>
						<td style="min-width: auto; width: auto;">State&nbsp;&amp;&nbsp;Local&nbsp;Income&nbsp;taxes:
							<br />General&nbsp;Sales&nbsp;taxes:</td></tr>
					</table></td>
				<td>	<input id="StateWH" type="myinput" />
						<br /><input id="SalesTax" type="myinput" /></td>
				<td>	<input id="StateWHBox" type="checkbox" onchange="ChangeTaxBox(this.id)" />
					<input id="SalesTaxUsedBox" type="checkbox" onchange="ChangeTaxBox(this.id)" />
					Check if box 5a was checked <span id="StateWHText"></span>
					<br /><span id="SalesTaxText"><!-- pre 2018 -->
					<input id="SalesTaxBox" type="checkbox" onchange="ChangeTaxBox(this.id)" />
					Check if box 5b was checked</span>
					<a id="IRSbutton" href="https://apps.irs.gov/app/stdc/" target="_blank">
						<button> IRS Calc </button></a>
					<input id="NoSalesTaxBox" type="checkbox" onchange="ChangeTaxBox(this.id)" /> Check if your state has no sales tax</td></tr>
			<tr id="PropertyRow" class="xhidden">
				<td><span id="PropertyLineNo">6</span>. State/local real estate taxes:</td>
				<td><input id="Property" type="myinput" /></td>
				<td></td></tr>
			<tr id="PersonalRow" class="xhidden">
				<td>5c. Personal property taxes:</td>
				<td><input id="Personal" type="myinput" /></td>
				<td></td></tr>
			<tr id="SALTRow" class="hidden">
				<td><span id="SALTLineNo"></span>. State &amp; Local tax total:</td>
				<td><input id="SALT" type="myinput" disabled="true"/></td>
				<td>&quot;SALT&quot; total prior to <span id="SALTLimit"></span> limit</td></tr>
			<tr id="ItemizedRow"><td><span id="ItemizedLineNo"></span>. Total itemized deductions:</td>
				<td><input id="Itemized" type="myinput" /></td>
				<td><input id="UseSchedA" type="checkbox" />
					Check if the line <span id="UseSchedALineNo"></span> box was checked.
					<span id="PYStandard"></span></td></tr>
		</table>
		<button id="SchedAButton" class="hidden">Next</button>
	</div> <!-- SchedADiv -->

	<div id="StandardDiv" class="hidden">
		<h1 id="StandardHeader"></h1>
		<h2 id="TestingStandardFor"></h2>
		<table class="data_entry">
			<tr><td>Salary and wages:</td>
				<td><input id="Salary" type="myinput" /></td>
				<td id="SalaryText"></td></tr>
			<tr><td>Business income:</td>
				<td><input id="Business" type="myinput" /></td>
				<td id="BusinessText"></td></tr>
			<tr><td>Standard deduction:</td>
				<td><input id="StandardDeduction" type="myinput" disabled="true" /></td>
				<td>(Calculated)</td></tr>
		</table>
		<button id="StandardButton" class="hidden">Next</button>
	</div> <!-- StandardDiv -->

	<div id="TaxableDiv" class="hidden">
		<h1 id="TaxableHeader"></h1>
		<h2 id="TestingTaxableFor"></h2>
		<input id="PositiveTaxable" type="checkbox" />
		Check this box to skip this test if the taxable income is greater than zero
		<table id="TaxableTable" class="data_entry">
			<tr id="AGIRow"><td>Adjusted gross income:</td>
				<td><input id="AGI" type="myinput" /></td>
				<td>From Form 1040 line <span id="AGILineNo"></span></td></tr>
			<tr id="OriginalItemizedRow"><td>Itemized deductions:</td>
				<td><input id="OriginalItemized" type="myinput" disabled="true" /></td>
				<td>(Calculated)</td></tr>
			<tr id="ExemptionRow"><td id="ExemptionLabel"></td>
				<td><input id="Exemption" type="myinput" /></td>
				<td><span id="ExemptionText"></span>
					<input id="QBIIncome" type="myinput" /></td></tr>
			<tr id="TaxableRow"><td>Taxable income:</td>
				<td><input id="Taxable" type="myinput" disabled="true" /></td>
				<td>(Calculated)</td></tr>
		</table>
		<button id="TaxableButton" class="hidden">Next</button>
		<span id="TaxablePositive">Taxable income is positive. Please check the box above to skip this test.</span>
	</div> <!-- TaxableDiv -->

	<div id="RefundableDiv" class="hidden">
		<h1 id="RefundableHeader"></h1>
		<h2 id="TestingRefundableFor"></h2>
		<br /><input id="NoRefundables" type="checkbox" />
		Check this box to skip this test if:
		<ul>
			<li>all credits were used &mdash; the tax amount <u>after</u> non-refundable credits
			(<span id="PostCreditLineNo">1040 line 13</span>) is not zero</li>
			<li>you know that the taxpayer has no eligible non-refundable credits</li>
		</ul>
		<table id="RefundableTable" class="data_entry">
			<tr class="underline"><td colspan="3">Original amounts:</td></tr>
			<tr>	<td>&nbsp;&nbsp;Total nonrefundable credits:</td>
				<td><input id="OldCredits" type="myinput" /></td>
				<td>From 1040 line <span id="OldNRCreditsLineNo"></span></td></tr>
		</table>
		<table id="RefundableAmendedTable" class="data_entry">
			<tr>	<td colspan="3"><span class="comment">
					<br />Enter the maximum amount of non-refundable credits from
					the forms on which they are calculated.
					<br />HINT: If there is a credit shown, all credits prior to
					that one <u>are</u> the maximum - no need to hunt for them.</span></td></tr>
			<tr class="underline"><td colspan="3">Maximum amounts:</td></tr>
			<tr>	<td>&nbsp;&nbsp;Foreign tax credit:</td>
				<td><input id="ForeignTax" type="myinput" /></td>
				<td>Form 1116</td></tr>
			<tr>	<td>&nbsp;&nbsp;Credit for care expenses:</td>
				<td><input id="ChildCare" type="myinput" /></td>
				<td>From Form 2441 line 9</td></tr>
			<tr>	<td>&nbsp;&nbsp;Credit for the elderly:</td>
				<td><input id="Elderly" type="myinput" /></td>
				<td>From Schedule R line 20</td></tr>
			<tr>	<td>&nbsp;&nbsp;Education credits:</td>
				<td><input id="Education" type="myinput" /></td>
				<td>From Form 8863 lines 9 + 18</td></tr>
			<tr>	<td>&nbsp;&nbsp;Retirement savings credit:</td>
				<td><input id="Retirement" type="myinput" /></td>
				<td>From Form 8880 line 10</td></tr>
			<tr><td colspan="3"></td></tr>
			<tr id="EnergyRow"> <!-- not available after 2017 -->
				<td>&nbsp;&nbsp;Residential energy credit:</td>
				<td><input id="Energy" type="myinput" /></td>
				<td>From Form 5695 line 13</td></tr>
			<tr id="CTCRow">
				<td>&nbsp;&nbsp;Child/dependent tax credit:</td>
				<td><input id="CTC" type="myinput" disabled="true" /></td>
				<td><span id="CTCTable">
					AGI:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<input id="CTCAGI" type="myinput" />
					From Form 1040 line <span id="CTCAGIText"></span>
					<br />Dep &lt; 17:
					<input id="CTCCount" type="myinput" />
					Number of dependents aged 16 or less, or disabled
					<span id="ODC">
					<br />Dep &gt; 16:
					<input id="ODCCount" type="myinput" />
					Number of other dependents</span></span>
			<tr>	<td style="border-top:2px solid black;">
					New total nonrefundable credits:</td>
				<td style="border-top:2px solid black;">
					<input id="NewCredits" type="myinput" disabled="true" /></td>
				<td>(Calculated)</td></tr>
			<tr>	<td>Tax amount gained:</td>
				<td><input id="TaxBracketGain" type="myinput" disabled="true" /></td>
				<td id="TaxBracket"></td></tr>
		</table>
		<button id="RefundableButton" class="hidden">Next</button>
	</div> <!-- RefundableDiv -->

	<div id="AllocationDiv" class="hidden">
		<h1 id="AllocationHeader"></h1>
		<h2 id="TestingAllocationFor"></h2>
		<span class="instruction">State tax payments for a tax year may include payments
			for a previous year and payments may also be paid in the following year,
			both typically the fourth quarter estimated tax payments or,
			a payment with an automatic extension to file.
			This section allocates the state tax refund to just the payments
			for the tax year to which the refund applies.
			<br /><b>Only enter amounts if claimed as a deduction.</b></span>
			<br /><input id="NoAllocation" type="checkbox" />
			Check if you do not have the data (the taxable state tax refund will not be additionally reduced by allocation)
		<table id="AllocationTable" class="data_entry">
			<tr class="underline">
				<td colspan="3"><br \><span id="PYEstimatesQ"></span></td></tr>
			<tr id="EstPY4QRow"><td id="EstPY4QLabel"></td>
				<td><input id="EstPY4Q" type="myinput" /></td>
				<td id="EstPY4QText"></td></tr>
			<tr id="DuePY4QRow"><td id="DuePY4QLabel"></td>
				<td><input id="DuePY4Q" type="myinput" /></td>
				<td></td></tr>
			<tr class="underline">
				<td colspan="3"><br /><span id="CYEstimatesQ"></span></td></tr>
			<tr id="PaidCYRow"><td id="PaidCYLabel"></td>
				<td><input id="PaidCY" type="myinput" disabled="true"/></td>
				<td id="PaidCYText">(Calculated) May include Q4 estimated payment if paid prior to 12/31.</td></tr>
			<tr class="underline">
				<td colspan="3"><br /><span id="NYEstimatesQ"></span></td></tr>
			<tr id="EstNY4QRow"><td id="EstNY4QLabel"></td>
				<td><input id="EstNY4Q" type="myinput" /></td>
				<td id="EstNY4QText">Note: this may not be fully deductible. See results below.</td></tr>
			<tr class="underline">
				<td colspan="3"><br />State income tax refund allocation:</td></tr>
			<tr>	<td id="CYAllocLabel"></td>
				<td><input id="CYAlloc" type="myinput" disabled="true" /></td>
				<td></td></tr>
			<tr>	<td id="NYAllocLabel"></td>
				<td><input id="NYAlloc" type="myinput" disabled="true" /></td>
				<td id="NYAllocText"></td>
			</tr>
		</table>
		<button id="AllocationButton" class="hidden">Next</button>
	</div> <!-- AllocationDiv -->
</div>

<div id="ResultsDiv" class="new_block">
	<h1>Results for TaxSlayer Entry</h1>
	<table class="data_entry">
		<tr id="TaxableStateHeader">
			<td colspan="3" class="underline">Federal taxable amount of refunds NOT taxable to the state:</td></tr>
		<tr id="TaxableStateRow">
			<td><span id="TaxableStateLabel">1040 line 10</span></td>
			<td><input id="TaxableState" type="myinput" disabled="true"/></td>
			<td class="comment">(TS Income &gt; State and Local Refunds &gt;
				Bypass worksheet line)<span id="SummaryA"></span><br /> </td></tr>
		<tr id="TaxableSalesHeader">
			<td colspan="3" class="underline">Federal taxable amount of refunds taxable to the state:</td></tr>
		<tr id="TaxableSalesRow">
			<td><span id="TaxableSalesLabel">1040 line 21</span></td>
			<td><input id="TaxableSales" type="myinput" disabled="true" /></td>
			<td class="comment">(TS Income &gt; Other Income)<span id="SummaryB"></span></td></tr>
		<tr id="DedNY4QHeader">
			<td colspan="3" class="underline"><br /><span id="DedNY4QYear"></span> 4th quarter estimated payment:</td></tr>
		<tr id="DedNY4QRow">
			<td><span class="comment">Part of Sched A line 5a</span></td>
			<td><input id="DedNY4Q" type="myinput" disabled="true" /></td>
			<td>(Federal Section &gt; Deductions &amp; Itemized Deductions &gt;
				Taxes You Paid &gt; Prior Year 4th Quarter...)<span id="SummaryC"></span></td></tr>
	</table>

</div> <!-- CurrentYear -->

<div class="noPrint">
	  Please send corrections and suggestions to	<a href="mailto:jeff@bogarthome.net">jeff@bogarthome.net</a>
	  <span id="printbutton2" style="float: right;"><button onclick="window.print()">Print a taxpayer copy</button></span>
</div>
