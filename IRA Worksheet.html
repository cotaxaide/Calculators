<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="author" content="Jeff Bogart, CO1/D18 Longmont TC">
	<title>IRA Worksheet</title>

<style type="text/css">
	html {
		background-color: #ccccaa;
	}
	body {
		background-color: #ccccaa;
		font-family: sans-serif;
		font-size: 0.9em;
		padding: 0 2.5% 0 2.5%;
	}
	button {
		cursor: pointer;
		background-color:
		lightgreen;
	}
	table {
		background-color: #eeeeaa;
		border-collapse:collapse;
	}
	ul {
		margin-block-start: 0;
		margin-block-end: 0;
	}
	.datatable tr td:first-child {
		text-align: left;
		width: 3em;
	}
	.datatable tr td:nth-child(3),
	.datatable tr td:nth-child(4) {
		text-align: right;
		width: 1%;
	}
	.dotted {
		border-bottom: 1px dotted grey;
	}
	.result_top {
		background-color: lightgreen;
		border-color: darkgreen;
		border-style: solid;
		border-width: 2px 0 0 2px; }
	.result_middle {
		background-color: lightgreen;
		border-color: darkgreen;
		border-style: solid;
		border-width: 0 0 0 2px;
		border-bottom: 1px dotted tan; }
	div {
		background-color: #eeeeaa;
		padding: 5px;
		border:1px solid black;
	}
	h1 {
		text-align: left;
		font-size: 110%;
		text-decoration: underline;
	}
	tr {
		vertical-align: middle;
	}
	input[type="number"] {
		text-align: right;
		width: 6em;
	}
	input[type="comma"] {
		text-align: right;
		width: 7em;
	}
	input, select {
		background-color: white;
	}
	input:disabled,
	select:disabled {
		background-color: lightgrey;
		font-weight: bold;
	}
	#TaxYear {
		width: 6em;
	}
	#IRATotalRow {
		display: none;
	}
	#OptimizeLine {
		display: none;
		background-color: yellow;
		border: 1px solid green;
		vertical-align: middle;
	}
	#OptimizeButton {
		font-size: 120%;
		border-radius: 5px;
	}
	#QCDTable {
		display: none;
	}
	#QCDTable tr:nth-child(2),
	#F8606Table tr:nth-child(2),
	#P590BW11Table tr:nth-child(2) {
		border: 1px solid black;
	}
	#P590BW11Table tr td:nth-child(2) {
		border-bottom: 1px dotted grey;
	}
	#P590BW11DoNotUse {
		font-weight: bold; margin: auto;
	}
	#F8606Table tr td:nth-child(2) {
		border-bottom: 1px dotted grey;
	}
	#DistTable {
		width: 100%;
	}
	#DistTable tr:first-child {
		font-weight: bold;
	}
	#DistTable tr td:first-child {
		width: 8%;
		min-width: 3em;
		font-weight: bold;
	}
	#DistTable tr td:nth-child(2),
	#DistTable tr td:nth-child(3),
	#DistTable tr td:nth-child(4),
	#DistTable tr td:nth-child(5),
	#DistTable tr td:nth-child(6),
	#DistTable tr td:nth-child(7) {
		width: 15.3%;
		border: 1px solid grey;
		text-align: center;
	}
	#TaxableIRA1,
	#TaxableIRA2,
	#TaxableIRA3,
	#TaxableIRA4,
	#TaxableIRA5 {
		width: 3em;
		text-align: right;
		display: block;
		margin: auto;
	}

	.groupheader {
		font-weight: bold;
	}
	.title {
		font-size:125%;
		font-weight: bold;
	}
	.instruction {
		text-align: right;
		text-decoration: italic;
	}
	.comment {
		font-style:italic;
	}
	.calculated {
		text-align: right;
	}
	.TSentry {
		background-color: lightgreen;
	}
	#TPName { 
		width: 20em;
		text-align:left;
	}
	#CalcMethodQ {
		border: 1px solid black;
		padding-left: .3em;
		padding-right: .3em;
		border-radius: .6em;
		background-color: lightgreen;
		cursor: pointer;
		font-size: 80%;
	}
	#CalcMethodInfo {
		width: 19em;
		display: none;
		background-color: lightgrey;
		border: 1px solid black;
		padding: 3px;
	}
	#ClearAndPrint {
		width: 16em; 
		text-align: center; 
		border: 0;
	       	background-color: transparent;
		z-index: 2;
		position: absolute;
		top: 0;
		right: 1em;
	}
	#ClearAndPrint button {
		margin: 2px;
	}
	#CalcMethodDiv {
		border: 0;
	       	background-color: transparent;
		z-index: 2;
		position: absolute;
		top: 4.5em;
		right: 5em;
	}
	#IRA8606_Table,
	#F1099R_Table,
	#SchedA_Table {
		width: 100%;
	}
	#QCD70 {
		position: relative;
		left: -1.6em;
		font-weight: bold;
	}
	@media print {
		.doPrint {
			display: inline;
		}
		.noPrint {
			display: none;
		}
		html {
			background-color: white;
			font-size: 0.9em;
		}
		body {
			font-size: 0.9em;
			background-color: white;
			padding: 0;
			margin: 0;
		}
		input,
		select,
		option {
			font-size: 0.9em;
		}
		table {
			width: 100%;
			background-color: white;
		}
		div {
			page-break-inside: avoid;
		}
	}
</style>

<script src="CommonRoutines.js"></script>
<script src="Tax_Data/IRS_2000.js"></script>
<script src="Tax_Data/IRS_2018.js"></script>
<script src="Tax_Data/IRS_2019.js"></script>
<script src="Tax_Data/IRS_2020.js"></script>
<script src="Tax_Data/IRS_2021.js"></script>
<script src="Tax_Data/IRS_2022.js"></script>
<script type="text/javascript">
	// --------------------------------------------------------------------------------
	// Contributors:
	//	Barry Schwarz		Bob Crews 		Greg Wendling
	//	John Haim 		Jheroen Dorenbosch 	John Arenberg
	//	Larry Ellison 		Bob Fox 		Burt Loper
	//	Mark Mergenthaler	Margaret Matulis
	// --------------------------------------------------------------------------------

	// CHANGE HISTORY:
	var VERSION = "(Version 2.02a, 12/15/2022)";
	//	Added starting tax year comment for QCD reduced exclusion
	//var VERSION = "(Version 2.02, 11/7/2022)";
	//	Added total contribution line to calculate Nontaxable amount
	//	Minor wording changes
	//var VERSION = "(Version 2.01, 9/19/2022)";
	//	Added Pub 590B Worksheet 1-1, QCD Adjustment Worksheet and QCD exclusion calc
	//	Added ability to reconcile IRA adjustment with AGI changes due to IRA taxablility
	//var VERSION = "(Version 1.07a, 7/9/2021)";
	//	Added 2021 data
	//var VERSION = "(Version 1.07, 2/1/2020)";
	//	Restored the TS calculation option - not fixed (broke again?)
	//var VERSION = "(Version 1.06, 12/16/2020)";
	//	Commented out the TS calculation option since TS appears to have fixed it
	//var VERSION = "(Version 1.05, 3/31/2020)";
	//	Added a line to show the nontaxable amount
	//var VERSION = "(Version 1.04c, 3/22/2020)";
	//	Prevent negative number as new basis when using TaxSlayer rounding
	//var VERSION = "(Version 1.04b, 12/31/2019)";
	//	Added a reminder to return to 1099-R to change taxable amount
	//var VERSION = "(Version 1.04a, 11/18/2019)";
	//	Removed "onchange" and "onclick" actions from output table 
	//var VERSION = "(Version 1.04, 1/15/2019)";
	//	Corrected year list due to non-numeric line number
	//var VERSION = "(Version 1.03, 6/20/2018)";
	//	Changed year list creation
	//var VERSION = "(Version 1.02, 1/23/2018)";
	//	Check inputs for commas and delete them
	//	Minor instruction clarifications
	//var VERSION = "(Version 1.01, 1/1/2018)";
	//	Spelling errors corrected, ROTH CONVERSION column header change
	//	Corrected error where all basis used for no rounding option
	//var VERSION = "(Version 1.00, 12/31/2017)";
	// --------------------------------------------------------------------------------

	var Input = [];
	var Calc = [];
	var ActualMAGIbase = 0;
	var OptimizingFlag = false;
	var Iteration = 0;

	//----------------------------------------------------------------------------------------
	function Initialize() {
	// This function adds tax year options to the Filing Information section
	//----------------------------------------------------------------------------------------
		// Add tax year options
		var tyOptIndex = 0;
		for (var ty = _StartYear; ty <= _StopYear; ty++) {
			if (_LineNo[ty + ":CapGains"] != "") { // Prevent adding if no data file
				var tyopti = document.createElement("option");
				tyopti.text = tyopti.value = ty;
				TaxYear.add(tyopti,tyOptIndex++);
			}
		}

		// Set the default to the tax year
		TaxYear.value = _DefaultYear;
		FileChange();
	}

	//----------------------------------------------------------------------------------------
	function SplitOptimize() {
	// Optimize button has been clicked
	//----------------------------------------------------------------------------------------
		OptimizingFlag = true;
		FileChange();
	}

	//----------------------------------------------------------------------------------------
	function FileChange(iteration) {
	// Calculates the values for TaxSlayer inputs and 8606 results
	//----------------------------------------------------------------------------------------
		// Iteration is used for optimization recusion
		if (iteration == undefined) Iteration = 0;

		// Set tax years
		TaxYearInfo.innerHTML =
		TaxYearQCD1.innerHTML =
		TaxYearQCD2.innerHTML =
		TaxYearQCD3.innerHTML =
		TaxYearIRA1.innerHTML =
		TaxYearIRA2.innerHTML =
		TaxYearDIST.innerHTML =
		TaxYearContrib.innerHTML =
		TaxYearDist.innerHTML =
		TaxYearNew.innerHTML =
		TaxYearConvert.innerHTML = +TaxYear.value;
		TaxYearIRA2b.innerHTML =
		TaxYearContribb.innerHTML = +TaxYear.value + 1;

		// Part of contribution deductible
		if (Split_Yes.checked) {
			// TaxSlayer does not implement the Pub 590B worksheet 1.1
			P590BW11Table.style.display = (CalcMethod.value == "Accurate") ?  "inline" : "none";
			IRATotalRow.style.display = "table-row";
			IRADedRow.style.display = "table-row";
			NonDed_CTY.disabled = true;
			NonDed_CTY.value = Math.max(0, Total_CTY.value - Ded_CTY.value);
			if (FilingStatus.value != "MFJ") {
				SplitSP50.checked = false;
				SplitSPPlan.checked = false;
			}
			if (FilingStatus.value != "MFS") {
				SplitTogether.checked = false;
			}
		}
		else {
			P590BW11Table.style.display = "none";
			IRATotalRow.style.display = "none";
			IRADedRow.style.display = "none";
			NonDed_CTY.disabled = false;
			Total_CTY.value = "";
			Ded_CTY.value = "";
			SplitTP50.checked = false;
			SplitSP50.checked = false;
			SplitTPPlan.checked = false;
			SplitSPPlan.checked = false;
			SplitTogether.checked = false;
		}
		SplitDetailsRow.style.display = (Split_Yes.checked) ? "table-row" : "none" ;
		SplitMFJ50.style.display = (FilingStatus.value == "MFJ") ? "inline" : "none" ;
		SplitMFJPlan.style.display = (FilingStatus.value == "MFJ") ? "inline" : "none" ;
		SplitMFS.style.display = (FilingStatus.value == "MFS") ? "inline" : "none" ;

		// Disaster repayment
		DisasterRow.style.display = (TaxYear.value === "2020") ? "table-row" : "none" ;
		if (Disaster_YesMade.checked) {
			DisasterRepRow.style.display = "table-row";
			DisasterMade.style.display = "inline";
		}
		else {
			DisasterRepRow.style.display = "none";
			DisasterMade.style.display = "none" ;
			Disaster_Distrib.value = "";
		}
		if (Disaster_YesRep.checked) {
			DisasterRep.style.display = "inline";
		}
		else {
			DisasterRepRow.style.display = "none";
			DisasterRep.style.display = "none" ;
			Disaster_Repaid.value = "";
		}

		// Initialize total counts
		Calc.GrossTotal = 0;
		Calc.DistTotal = 0;
		Calc.DistTradTotal = 0;
		Calc.ValueTotal = 0;
		Calc.ValueTradTotal = 0;
		Calc.ROTHTotal = 0;
		Calc.ROTHTradTotal = 0;
		Calc.QCDTotal = 0;

		// Enough input to do anything?
		anyGross = GrossIRA1.value + GrossIRA2.value + GrossIRA3.value + GrossIRA4.value + GrossIRA5.value;
		anyValue = ValueIRA1.value + ValueIRA2.value + ValueIRA3.value + ValueIRA4.value + ValueIRA5.value;
		if ( (anyGross === "") || (anyValue === "") ) return; // not enough entered

		// Check inputs for errors and remove commas
		Input.Adjust_70 = +Get_Value("Adjust_70");
		Input.QCD_70 = +Get_Value("QCD_70");
		Input.SplitAGI = +Get_Value("SplitAGI");
		Input.Disaster_Distrib = +Get_Value("Disaster_Distrib");
		Input.Disaster_Repaid = +Get_Value("Disaster_Repaid");
		if (Input.Disaster_Repaid > Input.Disaster_Distrib) { // limit repaid to distribution amount
			Disaster_Repaid.value = Disaster_Distrib.value;
			Input.Disaster_Repaid = Input.Disaster_Distrib;
			alert("Disaster amount paid back cannot be more than what was distributed.");
		}
		Input.OldBasis = +Get_Value("OldBasis");
		Input.Ded_CTY = +Get_Value("Ded_CTY");
		Input.NonDed_CTY = +Get_Value("NonDed_CTY");
		Input.NonDed_NTY = +Get_Value("NonDed_NTY");
		Input.Total_CTY = +Get_Value("Total_CTY");
		Input.Rollover = +Get_Value("Rollover");
		for (ira = 1; ira < 6; ira++) {
			grossx = "GrossIRA" + ira;
			Input[grossx] = +Get_Value(grossx);
			rothx = "ROTHIRA" + ira;
			Input[rothx] = +Get_Value(rothx);
			qcdx = "QCDIRA" + ira;
			tradbox = document.getElementById("Trad" + ira, true);
			Input[qcdx] = +Get_Value(qcdx);
			valuex = "ValueIRA" + ira;
			Input[valuex] = +Get_Value(valuex);
			error = ((Input[rothx] + Input[qcdx]) > Input[grossx]);
			grossbox = document.getElementById(grossx);
			grossbox.style.backgroundColor = (error) ? "hotpink" : "" ;
			if (error) return;

			// Calculated totals
			Calc.GrossTotal += Input[grossx];
			distx = "DistIRA" + ira;
			Calc[distx] = Input[grossx] - Input[rothx] - Input[qcdx];
			Calc.DistTradTotal += ((tradbox.checked) ? Calc[distx] : 0 );
			Calc.DistTotal += Calc[distx];
			Calc.ValueTotal += Input[valuex];
			Calc.ValueTradTotal += ((tradbox.checked) ? Input[valuex] : 0 );
			Calc.ROTHTotal += Input[rothx];
			Calc.ROTHTradTotal += ((tradbox.checked) ? Input[rothx] : 0 );
			Calc.QCDTotal += Input[qcdx];
		}
		Calc.IRAContribTotal_CTY = Input.Ded_CTY + Input.NonDed_CTY;
		Calc.IRAContribTotal = Calc.IRAContribTotal_CTY + Input.NonDed_NTY;
		Calc.Disaster_Net = Input.Disaster_Distrib - Input.Disaster_Repaid;
		Calc.DistSEPTotal = Calc.DistTotal - Calc.DistTradTotal;
		OptimizeLine.style.display = ((Split_Yes.checked) && (Iteration == 0)) ? "table-row" : "none" ;

		// QCD Adjustment Worksheet
		if (Calc.QCDTotal) {
			QCD70.style.display = (+TaxYear.value > 2019) ? "inline" : "none" ;
			QCDTable.style.display = "block";
		}
		else {
			QCD70.style.display = "none" ;
			QCDTable.style.display = "none" ;
			TP70.checked = false;
		}

		if (TP70.checked) {
			QCDRow1.style.display =
			QCDRow2.style.display =
			QCDRow3.style.display =
			QCDRow4.style.display =
			QCDRow6.style.display =
			QCDRow7.style.display = "table-row";
		}
		else {
			QCDRow1.style.display =
			QCDRow2.style.display =
			QCDRow3.style.display =
			QCDRow4.style.display =
			QCDRow6.style.display =
			QCDRow7.style.display = "none" ;
			Adjust_70.value = "";
			QCD_70.value = "";
		}

		// QCD limit check
		error = (Calc.QCDTotal > 100000);
		QCD_CTY.style.backgroundColor = (error) ? "hotpink" : "" ;
		if (error) {
			alert("Total QCD cannot exceed $100,000.");
			return;
		}

		// Take QCD from taxable amount of IRAs
		var taxableAmount = Math.max(0, Calc.ValueTotal + Calc.GrossTotal - Input.OldBasis - Input.NonDed_CTY);
		QCD_CTY.innerHTML = Calc.QCDTotal;
		QCDExclusion = Math.max(0, Calc.QCDTotal - Math.max(0, Input.Adjust_70 - Input.QCD_70));
		QCD_Exclusion.innerHTML = QCDExclusion;
		QCDLimit = Math.min(QCDExclusion, taxableAmount);
		QCD_Limit.innerHTML = QCDLimit;
		QCDLimitRow.style.display = (QCDLimit < QCDExclusion) ? "table-row" : "none" ; // show if limited

		// Anything left can be deducted on Sched A
		schedAAmount = Calc.QCDTotal - QCDLimit;
		SchedA.innerHTML = schedAAmount;
		QCDBasisRow.style.display = (schedAAmount) ? "table-row" : "none";
		SchedADiv.style.display = (schedAAmount) ? "block" : "none" ;

		// Adjust inputs for Form 8606 to eliminate QCDs
		reducedBasis = Input.OldBasis - schedAAmount;
		Input.OldBasis = Math.max(0, reducedBasis);
		if (reducedBasis < 0) Input.NonDed_CTY = Math.max(0, Input.NonDed_CTY + reducedBasis);
		if (schedAAmount) QCD_Basis.innerHTML = Input.OldBasis + Input.NonDed_CTY;

		// Pub 90B Worksheet 1-1
		W11Note.style.display = "none";
		W11Line01Out.innerHTML = W11Line01 = Input.OldBasis;
		W11Line02Out.innerHTML = W11Line02 = Input.Ded_CTY + Input.NonDed_CTY + Input.NonDed_NTY;
		W11Line03Out.innerHTML = W11Line03 = W11Line01 + W11Line02;
		W11Line04Out.innerHTML = W11Line04 = Calc.ValueTradTotal + Input.Rollover - Input.Disaster_Repaid;
		W11Line05Out.innerHTML = W11Line05 = Calc.DistTradTotal + Calc.ROTHTradTotal + Input.Disaster_Repaid + Calc.QCDTotal;
		var DisasterPart = (W11Line05) ? (Calc.Disaster_Net / W11Line05) : 1 ;
		W11Line06Out.innerHTML = W11Line06 = W11Line04 + W11Line05;

		// Get the fraction that is basis at year end
		W11Line07 = (W11Line06) ? (Math.round(1000 * W11Line03 / W11Line06) / 1000) : 1 ; // TaxSlayer rounding
		W11Line07Out.innerHTML = Math.min(1, W11Line07);
		if (CalcMethod.value == "Accurate") W11Line07 = (W11Line06) ? (W11Line03 / W11Line06) : 1 ;
		W11Line07 = Math.min(1, W11Line07);

		W11Line08Out.innerHTML = W11Line08 = Math.round(W11Line05 * W11Line07); // Nontaxable portion
		W11Line09Out.innerHTML = W11Line09 = W11Line05 - W11Line08; // Taxable portion pre Roth conversion
		W11Line10Out.innerHTML = W11Line10 = Math.round(W11Line09 * ((W11Line05) ? Calc.ROTHTradTotal / W11Line05 : 1 )); // Roth portion
		W11Line11Out.innerHTML = W11Line11 = W11Line09 - W11Line10; // Taxable portion post Roth conversion

		// Form 8606 Lines
		StartValue_CTY.innerHTML = "";
		F8606Percent.innerHTML = "";
		NewBasis.innerHTML = "";

		line01 = Input.NonDed_CTY + Input.NonDed_NTY;
		line02 = Input.OldBasis;
		line03 = line01 + line02;
		line04 = Input.NonDed_NTY;
		line05 = line03 - line04;
		line06 = Math.max(0, Calc.ValueTotal + Input.Rollover - Input.Disaster_Repaid);
		
		need8606 = (Calc.DistTotal + Calc.ROTHTotal + Calc.QCDTotal + line03 > 0);
		if (! need8606) {
			line14 = line05;
			line03 = 0;
			line05 = "";
			line08 = 0;
			line09 = "";
			line10 = "";
			line13 = "";
			line15 = 0;
			line16 = line08;
			line17 = 0;
			line18 = 0;
		}
		else if ( (! Split_Yes.checked) || (line05 < W11Line08) || (CalcMethod.value == "TS") ) {
			line07 = Calc.DistTotal + Input.Disaster_Repaid;
			DisasterPart = (line07) ? (Calc.Disaster_Net / line07) : 0 ;
			line08 = Calc.ROTHTotal;
			line09 = TotalInitialValue = line06 + line07 + line08;
			StartValue_CTY.innerHTML = line09;

			// Get the fraction that is basis at year end
			line10 = (line09) ? (Math.round(1000 * line05 / line09) / 1000) : 1 ; // TaxSlayer rounding
			F8606Percent.innerHTML = Math.min(1, line10);
			if (CalcMethod.value == "Accurate") line10 = (line09) ? (line05 / line09) : 1 ;
			line10 = Math.min(1, line10);

			line11 = Math.round(line08 * line10); // nontaxable portion of converted distributions
			line12 = Math.round(line07 * line10); // nontaxable portion of nonconverted distributions
			line13 = line11 + line12; // nontaxable portion of all distributions
			line14 = Math.max(0, line03 - line13); // new total basis in traditional IRAs
			line15 = line07 - line12; // taxable amount in traditional IRAs
			line16 = line08;
			line17 = line11;
		}
		else {
			W11Note.style.display = "inline";
			line07 = "";
			line08 = "";
			line09 = "";
			line10 = ""
			line13 = W11Line08;
			line14 = Math.max(0, Math.round(line03 - line13)); // new total basis in traditional IRAs
			line15 = W11Line11;
			line16 = Calc.ROTHTotal; //line08
			line17 = W11Line08; //line11
		}
		P590BW11DoNotUse.style.display = (line05 > W11Line08) ? "none" : "inline" ;
		Contrib_CTY.innerHTML = line05;
		NonTaxable.innerHTML = line13;
		NewBasis.innerHTML = (need8606) ? (Math.min(line14, Calc.ValueTradTotal)) : line14 ;
		unusedBasis = Math.max(0, line14 - Calc.ValueTradTotal);
		DisasterReduction.innerHTML = dr = Math.round(line15 * DisasterPart);
		DisasterNote.style.display = (dr) ? "inline" : "none" ;
		TaxableI.innerHTML = (need8606) ? (line15 -= dr) : "" ; // Part I taxable amount
		// taxable amount of conversion to ROTH:
		line18 = ( (Split_Yes.checked) && (CalcMethod.value == "Accurate") ) ? W11Line10 : Math.max(0, line16 - line17);
		TaxableII.innerHTML = line18; // Part II taxable amount

		// Distribute nontaxable amounts to IRAs
		Calc.taxableAmount = line15 + line18;
		nontaxableAmount = Calc.GrossTotal - Calc.taxableAmount + unusedBasis;
		schedAdeductible = 0;
		ta = Input.GrossIRA1 - nontaxableAmount;
		nontaxableAmount = Math.max(0, -ta);
		TaxableIRA1.innerHTML = ta1 = Math.max(0, ta);
		ta = Input.GrossIRA2 - nontaxableAmount;
		nontaxableAmount = Math.max(0, -ta);
		TaxableIRA2.innerHTML = ta2 = Math.max(0, ta);
		ta = Input.GrossIRA3 - nontaxableAmount;
		nontaxableAmount = Math.max(0, -ta);
		TaxableIRA3.innerHTML = ta3 = Math.max(0, ta);
		ta = Input.GrossIRA4 - nontaxableAmount;
		nontaxableAmount = Math.max(0, -ta);
		TaxableIRA4.innerHTML = ta4 = Math.max(0, ta);
		ta = Input.GrossIRA5 - nontaxableAmount;
		nontaxableAmount = Math.max(0, -ta);
		TaxableIRA5.innerHTML = ta5 = Math.max(0, ta);

		// TaxSlayer input
		TSContrib.innerHTML = line04;
		TSBasis.innerHTML = line02;
		TSValue.innerHTML = line06 - Input.Rollover;
		TSRollover.innerHTML = Input.Rollover;
		TSDist.innerHTML = Calc.DistTradTotal
		TSConverted.innerHTML = Calc.ROTHTotal;

		// Form 1099-R entries
		F1099R_Taxable.innerHTML = Calc.taxableAmount;

		// QCD exclusion calc
		// Reduce each IRA's taxable amount util the QCD total has been exclued
		// or the taxable amount has been used up.

		nontaxableAmount = Calc.QCDTotal;
		F1099R_QCD.innerHTML = QCDLimit;
		F1099R_QCDNotice.style.display = (Calc.QCDTotal) ? "table-row" : "none" ;
		nontaxableAmount = schedAMax = Math.min(Calc.taxableAmount, QCDLimit);
		//F1099R_Total.innerHTML = Math.max(0, Calc.taxableAmount - QCDLimit);
		
		// Deductible comparison between TaxSlayer and what we expect it to be
		if (Split_Yes.checked) { // The IRA contribution was limited by AGI

			// ActualMAGIbase is the tax return MAGI for calculating the IRA adjustment to income
			// less the IRA gross distribution amount.
			// Iteration 0 is from the TaxSlayer input and assumes that all IRAs are
			// fully taxable.
			if (Iteration == 0) {
				ActualMAGIbase = Input.SplitAGI - Calc.GrossTotal + Input.Ded_CTY;
			}

			var testMAGI = ActualMAGIbase + Calc.taxableAmount;

			// Get maximum based on AGI
			IRALimits = _IRADeduction(TaxYear.value, FilingStatus.value, testMAGI, 1000000,
				SplitTPPlan.checked, SplitTP50.checked,
				SplitSPPlan.checked, SplitSP50.checked,
				SplitTogether.checked);

			// Limit to what was actually contributed or what is allowed for our taxable amount
			var myDedIRA = Math.min(Calc.IRAContribTotal_CTY, IRALimits.TPdeductible);

			// Is there a match?
			if (Input.Ded_CTY != myDedIRA) { // No

				if (OptimizingFlag) {
					// Set the new values
					Ded_CTY.value = myDedIRA;
					NonDed_CTY.value = Calc.IRAContribTotal_CTY - myDedIRA;

					// Prevent an infinite loop
					if (Iteration++ > 10) {
						OptimizingFlag = false;
						return; // Close enough!
					}

					// try again with the new estimates
					FileChange(Iteration);

					OptimizingFlag = false;
				}
			}
		}
	} // File_Change

	//----------------------------------------------------------------------------------------
	function Get_Value(input) {
	// Calculates the values for TaxSlayer inputs and 8606 results
	//----------------------------------------------------------------------------------------
		this_input = document.getElementById(input);
		this_input.disabled = false;
		this_input = document.getElementById(input);
		this_input.style.backgroundColor = "";
		amount = this_input.value;
		amount = amount.replace(/\,/g,"");
		if (isNaN(amount)) {
			this_input.style.backgroundColor = "red";
			alert ("Please enter only digits, commas or periods.");
			this_input.value = "";
			return (0);
		}
		return (Math.round(amount));
	}

</script>

</head>

<!-- ******************************************************************************************************** -->
<!-- **************************************** START OF HTML ************************************************* -->
<!-- ******************************************************************************************************** -->

<body onload="Initialize()">

<center>
	<span class="title">IRA Worksheet</span>
	<br><span id="Version"></span><script>Version.innerHTML = VERSION;</script>
	<br />&nbsp;
</center>

<div id="ClearAndPrint" class="noPrint">
	<button onclick="window.open(window.location,'_self');">Clear and reset calculator</button>
	<br /><button onclick="window.print()">Print a taxpayer copy</button>
</div>

<div id="CalcMethodDiv" class="noPrint">
	<span id="CalcMethodQ"
		onmouseover="CalcMethodInfo.style.display='inline-block';"
		onmouseout="CalcMethodInfo.style.display='none';">?
	</span>&nbsp;
	Calculation type: <select id="CalcMethod" onchange="FileChange();">
		<option value="Accurate">No rounding</option>
		<option value="TS" selected="selected">TaxSlayer rounding</option>
		</select>

	<br /><span id="CalcMethodInfo">
		TaxSlayer rounds the ratio of basis to IRA totals to 3 decimal places which
		can result in minor taxable amount and new basis amount errors. 
		<br /><br />The "No rounding" option does not round the ratio and is more accurate.
		But using this option will not match the Form 8606 produced by TaxSlayer.
	</span>
</div>
	
<!-- ****************************************** FILING INFORMATION TABLE ****************************************** -->

<div id="FilingInfo">
	<h1>Information for tax year <select id="TaxYear" onchange="FileChange();"></select></h1>
	<table id="OptionsTable" class="datatable" onchange="FileChange();">
		<tr><td></td>
			<td colspan="2">This worksheet is for <input id="TPName" type="text" placeholder="(TP or SP Name)" />
				<br /><br />Check the box if the following is true in <span id="TaxYearInfo">2020</span>:
				<br /><input id="Split_Yes" type="checkbox" />
				An IRA contribution was made but only part (or none) was deductible due to AGI limitation
				(See Schedule 1) AND a distribution was also made.</td></tr>
		<tr id="SplitDetailsRow"><td colspan="2"></td>
			<td>	<ul>
					<li>Taxable amounts of IRAs affect AGI which affects the IRA contribution deduction
					which, will change the taxable amount.
					This worksheet will do the iterations required to optimize this issue.</li>
					<li>First, make sure all IRAs entered show their gross distribution as fully taxable.</li>
					<li>Then, enter the following information:
					<br />Filing status: <select id="FilingStatus">
						<option>SNG</option>
						<option selected="true">MFJ</option>
						<option>MFS</option>
						<option>WID</option>
						<option>HOH</option>
					</select>,
					AGI: <input type="comma" id="SplitAGI" /><br />
					<input type="checkbox" id="SplitTP50" />this TP >= 50, 
					<input type="checkbox" id="SplitTPPlan" />this TP has ret plan, 
					<span id="SplitMFJ50"><input id="SplitSP50" type="checkbox" />other TP >= 50,</span> 
					<span id="SplitMFJPlan"><input id="SplitSPPlan" type="checkbox" />other TP has ret plan,</span> 
					<span id="SplitMFS"><input id="SplitTogether" type="checkbox" />living together</span> 
					</li>
				</ul></td></tr>
		<tr id="DisasterRow"><td></td>
			<td colspan="2"><input id="Disaster_YesMade" type="checkbox" />
				A qualified disaster distribution was made<span id="DisasterMade">,
				Amount: <input id="Disaster_Distrib" type="comma" /></td></tr>
		<tr id="DisasterRepRow"><td colspan="2"></td>
			<td><input id="Disaster_YesRep" type="checkbox" />
				Any amount of the distribution was repaid<span id="DisasterRep">,
				Amount: <input id="Disaster_Repaid" type="comma" /></span></td></tr>
	</table>
</div>

<br />

<div id="8606WorkDiv">
<!-- ****************************************** 8606 WORKSHEET ****************************************** -->
	<h1>Form 8606 Worksheet - Nondeductible IRAs:</h1>
	<table id="IRATable0" class="datatable" onchange="FileChange();">
		<tr><td colspan="4" >
			<ul>
				<li>Do not include inherited IRAs; they require their own 8606 if they have a basis.</li>
				<li>The year-end value of all IRAs must be entered.</li>
				<li>Uncheck the TRADITIONAL box if the IRA is a SEP or SIMPLE IRA</li>
				<li>List IRAs from which QCDs have been taken first followed by traditional IRAs.</li>
				<li>To simplify TaxSlayer entries, nontaxable amounts are taken from IRAs in the order listed.</li>
			</ul>
			</td></tr>
		<tr><td colspan="4" class="groupheader">BASIS:</td></tr>
		<tr>
			<td></td><td colspan="2" class="dotted">Total basis in traditional IRAs from previous years (from most recent Form 8606)</td>
			<td><input id="OldBasis" type="comma" /></td></tr>
		<tr><td colspan="4" class="groupheader">CONTRIBUTIONS TO IRA for <span id="TaxYearIRA1">2017</span></td></tr>
		<tr id="IRATotalRow">
			<td></td><td colspan="2" class="dotted">Total contribution made</td>
			<td><input id="Total_CTY" type="comma" /></td></tr>
		<tr id="IRADedRow">
			<td></td><td colspan="2" class="dotted">Deductible IRA contribution amount from Schedule 1</td>
			<td><input id="Ded_CTY" type="comma" /></td></tr>
		<tr>
			<td></td><td colspan="2" class="dotted">Nondeductible contributions made in <span id="TaxYearIRA2">2017</span></td>
			<td><input id="NonDed_CTY" type="comma" /></td></tr>
		<tr>
			<td></td><td colspan="2" class="dotted">Nondeductible contributions made in <span id="TaxYearIRA2b">2017</span>
			prior to filing deadline</td>
			<td><input id="NonDed_NTY" type="comma" /></td></tr>
		<tr><td colspan="4" class="groupheader"><hr />TRADITIONAL/SIMPLE/SEP IRAS: (Enter "0" where appropriate)</td></tr>
		<tr>	<td></td>
			<td>
				<table id="DistTable">
				<tr>
					<td></td>
					<td>CHECK&nbsp;IF<br />TRADITIONAL</td>
					<td>1099&#x2011;R&nbsp;GROSS</br/>DISTRIBUTION</td>
					<td>ROTH&nbsp;CONV<br />AMOUNT</td>
					<td>QCD<br />AMOUNT</td>
					<td>VALUE&nbsp;ON<br />12/31/<span id="TaxYearDIST"></span></td>
					<td>TAXABLE<br />AMOUNT</td></tr>
				<tr>
					<td>IRA 1</td>
					<td><input id="Trad1" type="checkbox" checked="true" /></td>
					<td><input id="GrossIRA1" type="comma" /></td>
					<td><input id="ROTHIRA1" type="comma" /></td>
					<td><input id="QCDIRA1" type="comma" /></td>
					<td><input id="ValueIRA1" type="comma" /></td>
					<td><span id="TaxableIRA1"></span></td></tr>
				<tr>
					<td>IRA 2</td>
					<td><input id="Trad2" type="checkbox" checked="true" /></td>
					<td><input id="GrossIRA2" type="comma" /></td>
					<td><input id="ROTHIRA2" type="comma" /></td>
					<td><input id="QCDIRA2" type="comma" /></td>
					<td><input id="ValueIRA2" type="comma" /></td>
					<td><span id="TaxableIRA2"></span></td></tr>
				<tr>
					<td>IRA 3</td>
					<td><input id="Trad3" type="checkbox" checked="true" /></td>
					<td><input id="GrossIRA3" type="comma" /></td>
					<td><input id="ROTHIRA3" type="comma" /></td>
					<td><input id="QCDIRA3" type="comma" /></td>
					<td><input id="ValueIRA3" type="comma" /></td>
					<td><span id="TaxableIRA3"></span></td></tr>
				<tr>
					<td>IRA 4</td>
					<td><input id="Trad4" type="checkbox" checked="true" /></td>
					<td><input id="GrossIRA4" type="comma" /></td>
					<td><input id="ROTHIRA4" type="comma" /></td>
					<td><input id="QCDIRA4" type="comma" /></td>
					<td><input id="ValueIRA4" type="comma" /></td>
					<td><span id="TaxableIRA4"></span></td></tr>
				<tr>
					<td>IRA 5</td>
					<td><input id="Trad5" type="checkbox" checked="true" /></td>
					<td><input id="GrossIRA5" type="comma" /></td>
					<td><input id="ROTHIRA5" type="comma" /></td>
					<td><input id="QCDIRA5" type="comma" /></td>
					<td><input id="ValueIRA5" type="comma" /></td>
					<td><span id="TaxableIRA5"></span></td></tr>
				<tr>
					<td colspan="5">Any outstanding rollover amount (process not complete)</td>
					<td><input id="Rollover" type="comma" /></td></tr>
					</table></td></tr>

				<tr>	<td></td>
					<td id="OptimizeLine" colspan="4">
						&nbsp;When all data has been entered, click 
						<button id="OptimizeButton" onclick="SplitOptimize();">OPTIMIZE</button>
						to adjust the contribution limited by AGI.&nbsp;
					</td></tr>
			<tr>	<td></td>	
				<td colspan="2">

				<table id="QCDTable">
					<tr><td colspan="4">&nbsp;</td></tr>
					<tr><td colspan="4" class="groupheader">&nbsp;Pub 590B QCD Adjustment Worksheet</td></tr>
					<tr><td id="QCD70Row" colspan="4">
						<ul>
							<li>QCDs cannot be more than $100,000 per TP/SP.</li>
							<li>QCDs are taken first from the part of IRA that would be taxable.
							The remainder is taken from the basis (nondeductible contributions) and
							while not an exclusion for the QCD distribution,
							can be used on Schedule A as a charitable contribution.</li>
							<li>QCDs can be taken from SIMPLE/SEP IRAs if they are no longer being
							contributed to.</li>
							<li>The exclusion amount of QCDs made after turning 70&#xbd;
							must be reduced by any IRA contributions made for which a
							deduction was taken.
							<span id="QCD70">
								<br /><input id="TP70" type="checkbox" onchange="FileChange()";/>
								Check if this taxpayer ever made deductible contributions to an IRA
								when age over 70&#xbd; and for tax years after 2019.
							</span></li>
						</ul></td></tr>
					<tr id="QCDRow1"><td colspan="4" class="groupheader">DEDUCTIBLE CONTRIBUTIONS TO IRA:</td></tr>
					<tr id="QCDRow2"><td></td>
						<td colspan="2" class="dotted">
							Total income adjustment credit amount due to IRA contributions
							since turning 70&#xbd;, including <span id="TaxYearQCD1">2020</span></td>
						<td><input id="Adjust_70" type="comma" /></td></tr>
					<tr id="QCDRow3"><td colspan="4" class="groupheader">QCD AMOUNTS:</td></tr>
					<tr id="QCDRow4"><td></td>
						<td colspan="2" class="dotted">
							Total QCD distribution amounts deducted in prior years since turning 70&#xbd;,
							<b>NOT</b> including <span id="TaxYearQCD2">2017</span></td>
						<td><input id="QCD_70" type="comma" /></td></tr>
					<tr id="QCDRow5"><td></td>
						<td colspan="2" class="dotted">QCD distribution amount for <span id="TaxYearQCD3">2017</span></td>
						<td id="QCD_CTY"></td></tr>
					<tr id="QCDRow6"><td colspan="4" class="groupheader">QCD ADJUSTMENT WORKSHEET RESULTS:</td></tr>
					<tr id="QCDRow7"><td></td>
						<td colspan="2" class="dotted">
							Maximum exclusion available for the QCD distribution</td>
						<td class="calculated"><span id="QCD_Exclusion"></span></td></tr>
					<tr id="QCDLimitRow"><td></td>
						<td colspan="2" class="dotted">
							Exclusion limitation due to taxable amount less than QCD</td>
						<td class="calculated"><span id="QCD_Limit"></span></td></tr>
					<tr id="QCDBasisRow"><td></td>
						<td colspan="2" class="dotted">
							Reduced basis & contributions due to use of nontaxable amount for QCD</td>
						<td class="calculated"><span id="QCD_Basis"></span></td></tr>
				</span>
				</table>

				<section id="P590BW11Div">

				<table id="P590BW11Table">
					<tr><td colspan="4">&nbsp;</td></tr>
					<tr><td colspan="4" class="groupheader">&nbsp;Pub 590B Worksheet 1-1</td></tr>
					<tr><td></td>
						<td> 1. Initial basis</td>
						<td id="W11Line01Out"</td></tr>
					<tr><td></td>
						<td> 2. Total contributions</td>
						<td id="W11Line02Out"</td></tr>
					<tr><td></td>
						<td> 3. (Basis + contributions)</td>
						<td id="W11Line03Out"</td></tr>
					<tr><td></td>
						<td> 4. Year end total value of traditional IRAs</td>
						<td id="W11Line04Out"</td></tr>
					<tr><td></td>
						<td> 5. Total distributions from traditional IRAs including QCDs</td>
						<td id="W11Line05Out"</td></tr>
					<tr><td></td>
						<td> 6. (Beginning of year value of traditional IRAs)</td>
						<td id="W11Line06Out"</td></tr>
					<tr><td></td>
						<td> 7. Nontaxable fraction</td>
						<td id="W11Line07Out"</td></tr>
					<tr><td></td>
						<td> 8. Nontaxable portion
							<span id="P590BW11DoNotUse">
								<br />Do not use this worksheet -
								Line 8 is greater than or equal to F8606 line 5 
							</span></td>
						<td id="W11Line08Out"</td></tr>
					<tr><td></td>
						<td> 9. Taxable portion before ROTH conversion(s)</td>
						<td id="W11Line09Out"</td></tr>
					<tr><td></td>
						<td>10. ROTH conversion taxable portion</td>
						<td id="W11Line10Out"</td></tr>
					<tr><td></td>
						<td>11. Taxable portion after ROTH conversion(s)</td>
						<td id="W11Line11Out"</td></tr>
			</table>


			</section> <!-- P590BW11Div -->
			<table id="F8606Table">
				<tr><td colspan="4">&nbsp;</td></tr>
				<tr><td colspan="4" class="groupheader">&nbsp;Form 8606 results:</td></tr>
				<tr> <td></td><td colspan="2">5. Traditional IRA basis + contributions in current tax year only</td>
					<td class="calculated" id="Contrib_CTY"></td></tr>
				<tr> <td></td><td colspan="2">9. IRA total amount subject to taxable reduction by basis</td>
					<td class="calculated" id="StartValue_CTY"></td></tr>
				<tr> <td></td><td colspan="2">10. Nontaxable fraction
					<td class="calculated" id="F8606Percent"></td></tr>
				<tr> <td></td><td colspan="2">13. Nontaxable portion of distributions
						<span id="W11Note">(From Pub 590B Worksheet 1-1)</span></td>
					<td class="calculated" id="NonTaxable"></span></td></tr>
				<tr> <td></td><td colspan="2">14. Total basis in traditional IRAs for
						<span id="TaxYearNew"></span> and prior years</td>
					<td class="calculated" id="NewBasis"></td></tr>
				<tr> <td></td><td colspan="2">15. PART I taxable amount
						<span id="DisasterNote">(Reduced by
						<span id="DisasterReduction"></span> for disaster distribution)</span></td>
					<td class="calculated" id="TaxableI"></td></tr>
				<tr> <td></td><td colspan="2">18. PART II (ROTH) taxable amount</td>
					<td class="calculated" id="TaxableII"></td></tr>
			</table></td></tr>
		</table>

</div> <!-- 8606WorkDiv -->

<br />

<div id="TaxSlayerInput">
	<h1>TaxSlayer Input</h1>

<div id="8606TSDiv" class="TSentry">
	<h1>Form 8606 input for TaxSlayer:</h1>
	<b>NOTE:</b> You <i>must</i> create a Form 8606 in TaxSlayer so that it&apos;s included in the tax return!
	<br />(Federal Section > Deductions > Adjustments > Nondeductible IRAs)
	<hr />
	<table id="IRA8606_Table" class="datatable TSentry">
		<tr><td></td><td></td><td></td><td></td></tr>
		<tr><td></td>
			<td colspan="2" class="dotted">Total basis in traditional IRAs</td>
			<td class="calculated"><span id="TSBasis"></span></td></tr>
		<tr><td></td>
			<td colspan="2" class="dotted">Contributions made from January 1 through filing deadline in <span id="TaxYearContribb">2018</span></td>
			<td class="calculated"><span id="TSContrib"></span></td></tr>
		<tr><td></td>
			<td colspan="2" class="dotted">Total value of all traditional, SEP and SIMPLE IRAs as of December 31, <span id="TaxYearContrib">2017</span></td>
			<td class="calculated"><span id="TSValue"></span></td></tr>
		<tr><td></td>
			<td colspan="2" class="dotted">Outstanding rollovers</td>
			<td class="calculated"><span id="TSRollover"></span></td></tr>
		<tr><td></td>
			<td colspan="2" class="dotted">Traditional IRA distributions (reported on form 1099-R) received during <span id="TaxYearDist">2017</span></td>
			<td class="calculated"><span id="TSDist"></span></td></tr>
		<tr><td></td>
			<td colspan="2" class="dotted">Net amount converted from traditional, SEP and SIMPLE IRAs to Roth IRAs in <span id="TaxYearConvert">2017</span></td>
			<td class="calculated"><span id="TSConverted"></span></td></tr>

	</table>
</div> <!-- 8606TSDiv -->
<br />
<div id="1099RDiv" class="TSentry">
	<h1>Form 1099-R taxable amounts for TaxSlayer:</h1>
	Return to the IRA distribution 1099-R forms and change the TAXABLE AMOUNT to that shown in the table above.
	<br />(You can actually distribute the total taxable amount to one (or more) of the 1099-R forms in any way you wish.)
	<hr />
	<table id="F1099R_Table" class="datatable TSentry">
		<tr><td></td><td></td><td></td><td></td></tr>
		<tr><td></td>
			<td class="dotted">Taxable amount from Form 8606</td>
			<td id="F1099R_Taxable"></td></tr>
		<tr><td></td>
			<td class="dotted">QCD exclusion amount</td>
			<td id="F1099R_QCD"></td></tr>
		<tr id=F1099R_QCDNotice><td></td>
			<td>Also, check the QCD box in Nontaxable Distributions
			<td id="F1099R_Total"></td></tr>
	</table>
	<hr />
	If an IRA contribution was made check Schedule 1 to see if it was limited by AGI.
	If so, re-run this worksheet with that option checked since it will affect the results.
	Then, click the Optimize button to get the optimal results.
</div> <!-- 1099RDiv -->

<span id="SchedADiv">
<br />
<div class="TSentry">
	<h1>Schedule A contribution input for TaxSlayer:</h1>
	The Qualified Charitable Contribution(QCD) amount exceeds the taxable amount total of your IRAs. This excess can be deducted as a cash charitable contribution on Schedule A.
	<hr />
	<table id="SchedA_Table" class="datatable TSentry">
		<tr><td></td><td></td><td></td><td></td></tr>
		<tr id="SchedARow"><td></td>
			<td>Remaining QCD amount - enter as a Schedule A cash contribution</td>
			<td id="SchedA"></td></tr>
	</table>
</div>
</span> <!-- SchedADiv -->

</div <!-- TaxSlayerInput -->

<br />

<div class="noPrint">
	Please send corrections and suggestions to
	<a href="mailto:jeff@bogarthome.net">jeff@bogarthome.net</a>
	<span id="printbutton2" style="float: right;"><button onclick="window.print()">Print a taxpayer copy</button></span>
</div>

</body>
</html>

